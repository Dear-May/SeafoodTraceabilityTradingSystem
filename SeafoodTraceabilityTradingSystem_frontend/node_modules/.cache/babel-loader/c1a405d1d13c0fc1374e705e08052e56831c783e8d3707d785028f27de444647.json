{"ast":null,"code":"import \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport router from \"@/router\";\nimport { onMounted } from \"vue\";\nimport { ElMessage } from \"element-plus\";\nimport axios from \"axios\";\nexport default {\n  __name: 'AdminSyncView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    let id = null;\n    async function checkUserPermission() {\n      id = new URLSearchParams(window.location.search).get('id');\n      if (!id) {\n        ElMessage.error('权限校验失败');\n        await router.replace('/');\n      } else {\n        try {\n          const response = await axios.post('/api/admin/checkUserPermission', {\n            id: id\n          }, {\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            withCredentials: true\n          });\n          if (response.data.code !== 200) {\n            ElMessage.error('无权限访问');\n            await router.replace('/');\n          }\n        } catch (error) {\n          ElMessage.error('获取权限失败');\n          await router.replace('/');\n        }\n      }\n    }\n    async function syncData() {\n      try {\n        const response = await axios.post('/api/admin/syncGoodData', {\n          token: id\n        }, {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          withCredentials: true\n        });\n        if (response.data.code === 200) {\n          ElMessage.success('同步成功');\n        } else {\n          ElMessage.error('同步失败1');\n        }\n      } catch (error) {\n        ElMessage.error('同步失败');\n      }\n    }\n    onMounted(async () => {\n      await checkUserPermission();\n    });\n    const __returned__ = {\n      get id() {\n        return id;\n      },\n      set id(v) {\n        id = v;\n      },\n      checkUserPermission,\n      syncData,\n      get router() {\n        return router;\n      },\n      onMounted,\n      get ElMessage() {\n        return ElMessage;\n      },\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["router","onMounted","ElMessage","axios","id","checkUserPermission","URLSearchParams","window","location","search","get","error","replace","response","post","headers","withCredentials","data","code","syncData","token","success"],"sources":["D:/Cache/Java/shopping/shoppping_c_frontend/src/views/Admin/AdminSyncView.vue"],"sourcesContent":["<template>\r\n  <div class=\"d-flex\" style=\"height: 100vh; overflow: hidden;\">\r\n    <aside class=\"bg-dark text-light\" style=\"width: 200px; padding-top: 20px;\">\r\n      <div class=\"text-center mb-4\">\r\n        <a style=\"font-size: 16px; font-weight: bold\">后台管理</a>\r\n      </div>\r\n      <el-menu\r\n          :default-openeds=\"['1']\"\r\n          :default-active=\"'1-2'\"\r\n          class=\"border-0\"\r\n          text-color=\"#fff\"\r\n          active-text-color=\"#ffd04b\"\r\n          background-color=\"#333\"\r\n      >\r\n        <el-sub-menu index=\"1\">\r\n          <template #title>首页</template>\r\n          <el-menu-item index=\"1-1\" @click=\"router.push('/admin/index?id='+id)\">首页</el-menu-item>\r\n          <el-menu-item index=\"1-2\">搜索引擎商品数据同步</el-menu-item>\r\n        </el-sub-menu>\r\n      </el-menu>\r\n    </aside>\r\n\r\n    <div class=\"flex-grow-1 overflow-auto\" style=\"background: #f5f7fa;\">\r\n      <nav class=\"navbar navbar-light bg-white border-bottom shadow-sm\">\r\n        <div class=\"container-fluid\">\r\n          <span class=\"navbar-brand mb-0 h1\">数据同步</span>\r\n        </div>\r\n      </nav>\r\n\r\n      <div class=\"p-4\">\r\n        <div class=\"text-center mb-4\">\r\n          <h2>搜索引擎商品数据同步</h2>\r\n          <el-button type=\"primary\" @click=\"syncData\"> 同步数据</el-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport router from \"@/router\";\r\nimport {onMounted} from \"vue\";\r\nimport {ElMessage} from \"element-plus\";\r\nimport axios from \"axios\";\r\n\r\nlet id = null;\r\n\r\nasync function checkUserPermission() {\r\n  id = new URLSearchParams(window.location.search).get('id');\r\n  if (!id) {\r\n    ElMessage.error('权限校验失败');\r\n    await router.replace('/')\r\n  } else {\r\n    try {\r\n      const response = await axios.post('/api/admin/checkUserPermission', {\r\n        id: id,\r\n      }, {\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        withCredentials: true\r\n      });\r\n      if (response.data.code !== 200) {\r\n        ElMessage.error('无权限访问')\r\n        await router.replace('/')\r\n      }\r\n    } catch (error) {\r\n      ElMessage.error('获取权限失败')\r\n      await router.replace('/')\r\n    }\r\n  }\r\n}\r\n\r\nasync function syncData() {\r\n  try {\r\n    const response = await axios.post('/api/admin/syncGoodData', {\r\n      token: id,\r\n    }, {\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.code === 200) {\r\n      ElMessage.success('同步成功')\r\n    } else {\r\n      ElMessage.error('同步失败1')\r\n    }\r\n  } catch (error) {\r\n    ElMessage.error('同步失败')\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  await checkUserPermission();\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n\r\n</style>"],"mappings":";;;AAwCA,OAAOA,MAAM,MAAM,UAAU;AAC7B,SAAQC,SAAS,QAAO,KAAK;AAC7B,SAAQC,SAAS,QAAO,cAAc;AACtC,OAAOC,KAAK,MAAM,OAAO;;;;;;;IAEzB,IAAIC,EAAE,GAAG,IAAI;IAEb,eAAeC,mBAAmBA,CAAA,EAAG;MACnCD,EAAE,GAAG,IAAIE,eAAe,CAACC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAACC,GAAG,CAAC,IAAI,CAAC;MAC1D,IAAI,CAACN,EAAE,EAAE;QACPF,SAAS,CAACS,KAAK,CAAC,QAAQ,CAAC;QACzB,MAAMX,MAAM,CAACY,OAAO,CAAC,GAAG,CAAC;MAC3B,CAAC,MAAM;QACL,IAAI;UACF,MAAMC,QAAQ,GAAG,MAAMV,KAAK,CAACW,IAAI,CAAC,gCAAgC,EAAE;YAClEV,EAAE,EAAEA;UACN,CAAC,EAAE;YACDW,OAAO,EAAE;cACP,cAAc,EAAE;YAClB,CAAC;YACDC,eAAe,EAAE;UACnB,CAAC,CAAC;UACF,IAAIH,QAAQ,CAACI,IAAI,CAACC,IAAI,KAAK,GAAG,EAAE;YAC9BhB,SAAS,CAACS,KAAK,CAAC,OAAO,CAAC;YACxB,MAAMX,MAAM,CAACY,OAAO,CAAC,GAAG,CAAC;UAC3B;QACF,CAAC,CAAC,OAAOD,KAAK,EAAE;UACdT,SAAS,CAACS,KAAK,CAAC,QAAQ,CAAC;UACzB,MAAMX,MAAM,CAACY,OAAO,CAAC,GAAG,CAAC;QAC3B;MACF;IACF;IAEA,eAAeO,QAAQA,CAAA,EAAG;MACxB,IAAI;QACF,MAAMN,QAAQ,GAAG,MAAMV,KAAK,CAACW,IAAI,CAAC,yBAAyB,EAAE;UAC3DM,KAAK,EAAEhB;QACT,CAAC,EAAE;UACDW,OAAO,EAAE;YACP,cAAc,EAAE;UAClB,CAAC;UACDC,eAAe,EAAE;QACnB,CAAC,CAAC;QACF,IAAIH,QAAQ,CAACI,IAAI,CAACC,IAAI,KAAK,GAAG,EAAE;UAC9BhB,SAAS,CAACmB,OAAO,CAAC,MAAM,CAAC;QAC3B,CAAC,MAAM;UACLnB,SAAS,CAACS,KAAK,CAAC,OAAO,CAAC;QAC1B;MACF,CAAC,CAAC,OAAOA,KAAK,EAAE;QACdT,SAAS,CAACS,KAAK,CAAC,MAAM,CAAC;MACzB;IACF;IAEAV,SAAS,CAAC,YAAY;MACpB,MAAMI,mBAAmB,CAAC,CAAC;IAC7B,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}