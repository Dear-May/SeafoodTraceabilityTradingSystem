{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport ShopSliderComponent from \"@/components/ShopSliderComponent.vue\";\nimport { onMounted, ref } from \"vue\";\nimport { useUserShop } from \"@/composables/useShopUser\";\nimport { Plus, Search } from \"@element-plus/icons-vue\";\nimport { ElMessage } from \"element-plus\";\nimport axios from \"axios\";\nimport StoreHeaderView from \"@/components/StoreHeaderView.vue\";\nexport default {\n  __name: 'StoreGoodView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const shopSlider = ref(null);\n    const storeHeader = ref(null);\n    const {\n      shopForm,\n      initUserSession,\n      initShopInfo,\n      UserForm\n    } = useUserShop();\n    const activeName = ref(\"first\");\n    const products = ref();\n    const loading = ref();\n    function isMerchant() {\n      if (UserForm.value.role !== \"merchant\") {\n        ElMessage.error(\"您没有权限访问该页面\");\n        setTimeout(() => {\n          window.location.href = \"/store/index\";\n        }, 1000);\n        return false;\n      }\n      return true;\n    }\n    async function initProducts() {\n      try {\n        const response = await axios.post('/api/shop/getAllGoodInfo', {\n          shopID: shopForm.value.shopID\n        }, {\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true\n        });\n        if (response.data != null) {\n          products.value = response.data;\n          filteredProducts.value = products.value;\n        }\n      } catch (err) {\n        ElMessage.error(\"获取商品信息失败\");\n      }\n    }\n    const filteredProducts = ref([]);\n    // 搜索框内容\n    const searchQuery = ref(\"\");\n\n    // 过滤后的商品列表\n    function searchProducts() {\n      if (searchQuery.value === \"\") {\n        filteredProducts.value = products.value;\n      } else {\n        filteredProducts.value = products.value.filter(item => item.name.toLowerCase().includes(searchQuery.value.toLowerCase()) || item.goodID.toLowerCase().includes(searchQuery.value.toLowerCase())).map(item => ({\n          ...item,\n          specs: item.specs.map(spec => ({\n            ...spec,\n            imageUrl: spec.imageUrl.replace(\"@\", \"\")\n          }))\n        }));\n      }\n    }\n\n    // 下架商品\n    async function removeProduct(product) {\n      try {\n        const response = await axios.post('/api/shop/updateGoodInfo', {\n          name: product.name,\n          goodID: product.goodID,\n          updateStatus: !product.status,\n          shopID: shopForm.value.shopID,\n          origin: product.origin,\n          imageUrl: product.imageUrl,\n          type: \"goodStatus\"\n        }, {\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true\n        });\n        if (response.data.code === 200) {\n          ElMessage.success(\"更改状态成功\");\n          await initProducts();\n        } else if (response.data.code === 400) {\n          ElMessage.error(\"更改状态失败\");\n        }\n      } catch (err) {\n        ElMessage.error(\"更改状态失败\");\n      }\n    }\n\n    // 修改商品\n    const originalProductInfo = ref();\n    function editProduct(product) {\n      originalProductInfo.value = {\n        ...product\n      };\n      product.isEdited = true;\n    }\n    const selectedGoodFile = ref(null);\n    function handleImageChangeMain(file, productIndex) {\n      const reader = new FileReader();\n      selectedGoodFile.value = file.raw;\n      reader.readAsDataURL(file.raw);\n      reader.onload = () => {\n        products.value[productIndex].imageUrl = reader.result;\n      };\n    }\n    async function uploadProductImage(product) {\n      const formData = new FormData();\n      formData.append(\"image\", selectedGoodFile.value);\n      formData.append(\"goodID\", product.goodID);\n      try {\n        const response = await axios.post(\"/api/shop/updateGoodImage\", formData, {\n          headers: {\n            \"Content-Type\": \"multipart/form-data\"\n          },\n          withCredentials: true\n        });\n        if (response.data.code === 200) {\n          ElMessage.success(\"上传图片成功\");\n        } else if (response.data.code === 400) {\n          ElMessage.error(\"上传图片失败\");\n        }\n      } catch (err) {\n        ElMessage.error(\"上传图片失败\");\n      }\n    }\n    async function saveProduct(product) {\n      if (product.name === \"\" || product.origin === \"\") {\n        ElMessage.error(\"请填写完整商品信息\");\n        return;\n      }\n      const isChanged = product.imageUrl !== originalProductInfo.value.imageUrl;\n      try {\n        const response = await axios.post('/api/shop/updateGoodInfo', {\n          name: product.name,\n          goodID: product.goodID,\n          shopID: shopForm.value.shopID,\n          origin: product.origin,\n          imageUrl: product.imageUrl,\n          type: \"goodInfo\"\n        }, {\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true\n        });\n        if (response.data.code === 200) {\n          ElMessage.success(\"修改商品信息成功\");\n          if (isChanged) await uploadProductImage(product);\n          window.location.reload();\n        } else if (response.data.code === 400) {\n          ElMessage.error(\"修改商品信息失败\");\n        }\n      } catch (err) {\n        ElMessage.error(\"修改商品信息失败\");\n      }\n    }\n    function cancelEdit(product) {\n      product.isEdited = false;\n      // 重置商品信息\n      product.name = originalProductInfo.value.name;\n      product.origin = originalProductInfo.value.origin;\n      product.imageUrl = originalProductInfo.value.imageUrl;\n      product.specs = originalProductInfo.value.specs;\n      originalProductInfo.value = null;\n    }\n\n    // 下架规格\n    async function removeSpec(product, spec) {\n      try {\n        const response = await axios.post('/api/shop/updateSpecInfo', {\n          goodID: product.goodID,\n          specID: spec.specID,\n          updateStatus: !spec.status,\n          specName: spec.name,\n          specPrice: spec.price,\n          specStock: spec.stock,\n          imageUrl: spec.imageUrl,\n          type: \"specStatus\"\n        }, {\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true\n        });\n        if (response.data.code === 200) {\n          ElMessage.success(\"更改规格状态成功\");\n          await initProducts();\n          spec.isEdited = false;\n        } else if (response.data.code === 400) {\n          ElMessage.error(\"更改规格状态失败\");\n        }\n      } catch (err) {\n        ElMessage.error(\"更改规格状态失败\");\n      }\n    }\n\n    // 修改规格\n    const originalSpecInfo = ref();\n    function editSpec(spec) {\n      spec.isEdited = true;\n      originalSpecInfo.value = {\n        ...spec\n      };\n    }\n    function beforeSpecImageUpload(file) {\n      const isImage = file.type.startsWith(\"image/\");\n      if (!isImage) {\n        ElMessage.error(\"仅支持图片文件！\");\n        return false;\n      }\n      const isLt2M = file.size / 1024 / 1024 < 2;\n      if (!isLt2M) {\n        ElMessage.error(\"文件大小不能超过 2MB！\");\n        return false;\n      }\n      return true;\n    }\n    const selectedFile = ref(null);\n    function handleSpecImageChangeMain(file, productIndex, specIndex) {\n      const reader = new FileReader();\n      selectedFile.value = file.raw;\n      reader.readAsDataURL(file.raw);\n      reader.onload = () => {\n        products.value[productIndex].specs[specIndex].imageUrl = reader.result;\n      };\n    }\n    async function uploadSpecImage(spec) {\n      const formData = new FormData();\n      formData.append(\"image\", selectedFile.value);\n      formData.append(\"specID\", spec.specID);\n      try {\n        const response = await axios.post(\"/api/shop/updateSpecImage\", formData, {\n          headers: {\n            \"Content-Type\": \"multipart/form-data\"\n          },\n          withCredentials: true\n        });\n        if (response.data.code === 200) {\n          ElMessage.success(\"上传图片成功\");\n        } else if (response.data.code === 400) {\n          ElMessage.error(\"上传图片失败\");\n        }\n      } catch (err) {\n        ElMessage.error(\"上传图片失败\");\n      }\n    }\n    async function saveSpec(product, spec) {\n      if (spec.name === \"\" || spec.price === \"\" || spec.stock === \"\") {\n        ElMessage.error(\"请填写完整规格信息\");\n        return;\n      }\n      const isChanged = spec.imageUrl !== originalSpecInfo.value.imageUrl;\n      try {\n        const response = await axios.post('/api/shop/updateSpecInfo', {\n          specName: spec.name,\n          goodID: product.goodID,\n          specID: spec.specID,\n          specPrice: spec.price,\n          specStock: spec.stock,\n          imageUrl: spec.imageUrl,\n          type: \"specInfo\"\n        }, {\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true\n        });\n        if (response.data.code === 200) {\n          ElMessage.success(\"修改规格信息成功\");\n          if (isChanged) await uploadSpecImage(spec);\n          window.location.reload();\n        } else if (response.data.code === 400) {\n          ElMessage.error(\"修改规格信息失败\");\n        }\n      } catch (err) {\n        ElMessage.error(\"修改规格信息失败\");\n      }\n    }\n    function cancelEditSpec(spec) {\n      spec.isEdited = false;\n      // 重置规格信息\n      spec.name = originalSpecInfo.value.name;\n      spec.price = originalSpecInfo.value.price;\n      spec.stock = originalSpecInfo.value.stock;\n      spec.imageUrl = originalSpecInfo.value.imageUrl;\n      selectedFile.value = null;\n      originalSpecInfo.value = null;\n    }\n    const productForm = ref({\n      shopID: \"\",\n      name: \"\",\n      origin: \"\",\n      imageUrl: \"\",\n      // 商品主图预览URL\n      specs: [{\n        name: \"\",\n        price: \"\",\n        stock: \"\",\n        imageUrl: \"\"\n      } // 规格初始项\n      ]\n    });\n    const handleTabClick = () => {\n      if (activeName.value === \"second\") {\n        productForm.value.name = \"\";\n        productForm.value.origin = \"\";\n        productForm.value.imageUrl = \"\";\n        productForm.value.specs = [{\n          name: \"\",\n          price: \"\",\n          stock: \"\",\n          imageUrl: \"\"\n        }];\n      }\n    };\n\n    // 商品主图选择事件\n    const handleImageChange = file => {\n      const reader = new FileReader();\n      reader.readAsDataURL(file.raw);\n      reader.onload = () => {\n        productForm.value.imageUrl = reader.result;\n      };\n    };\n\n    // 商品规格图片选择事件\n    const handleSpecImageChange = (file, index) => {\n      const reader = new FileReader();\n      reader.readAsDataURL(file.raw);\n      reader.onload = () => {\n        productForm.value.specs[index].imageUrl = reader.result;\n      };\n    };\n\n    // 添加规格\n    const addSpec = () => {\n      productForm.value.specs.push({\n        name: \"\",\n        price: \"\",\n        stock: \"\",\n        imageUrl: \"\"\n      });\n    };\n    async function submitGood() {\n      try {\n        const response = await axios.post(\"/api/shop/insertGoodInfo\", {\n          shopID: shopForm.value.shopID,\n          name: productForm.value.name,\n          origin: productForm.value.origin,\n          imageUrl: productForm.value.imageUrl,\n          specs: productForm.value.specs\n        });\n        if (response.data.code === 200) {\n          ElMessage.success(\"商品上架成功\");\n          window.location.reload();\n        } else if (response.data.code === 400) {\n          ElMessage.error(\"商品上架失败\");\n        }\n      } catch (err) {\n        ElMessage.error(\"商品上架失败\");\n      }\n    }\n    onMounted(async () => {\n      loading.value = true;\n      initUserSession();\n      await initShopInfo();\n      shopSlider.value.setActiveIndex(\"2-1\");\n      storeHeader.value.setTitle(\"商品管理\");\n      if (isMerchant()) {\n        productForm.value.shopID = shopForm.value.shopID;\n        await initProducts();\n        loading.value = false;\n      }\n    });\n    const __returned__ = {\n      shopSlider,\n      storeHeader,\n      shopForm,\n      initUserSession,\n      initShopInfo,\n      UserForm,\n      activeName,\n      products,\n      loading,\n      isMerchant,\n      initProducts,\n      filteredProducts,\n      searchQuery,\n      searchProducts,\n      removeProduct,\n      originalProductInfo,\n      editProduct,\n      selectedGoodFile,\n      handleImageChangeMain,\n      uploadProductImage,\n      saveProduct,\n      cancelEdit,\n      removeSpec,\n      originalSpecInfo,\n      editSpec,\n      beforeSpecImageUpload,\n      selectedFile,\n      handleSpecImageChangeMain,\n      uploadSpecImage,\n      saveSpec,\n      cancelEditSpec,\n      productForm,\n      handleTabClick,\n      handleImageChange,\n      handleSpecImageChange,\n      addSpec,\n      submitGood,\n      ShopSliderComponent,\n      onMounted,\n      ref,\n      get useUserShop() {\n        return useUserShop;\n      },\n      get Plus() {\n        return Plus;\n      },\n      get Search() {\n        return Search;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get axios() {\n        return axios;\n      },\n      StoreHeaderView\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ShopSliderComponent","onMounted","ref","useUserShop","Plus","Search","ElMessage","axios","StoreHeaderView","shopSlider","storeHeader","shopForm","initUserSession","initShopInfo","UserForm","activeName","products","loading","isMerchant","value","role","error","setTimeout","window","location","href","initProducts","response","post","shopID","headers","withCredentials","data","filteredProducts","err","searchQuery","searchProducts","filter","item","name","toLowerCase","includes","goodID","map","specs","spec","imageUrl","replace","removeProduct","product","updateStatus","status","origin","type","code","success","originalProductInfo","editProduct","isEdited","selectedGoodFile","handleImageChangeMain","file","productIndex","reader","FileReader","raw","readAsDataURL","onload","result","uploadProductImage","formData","FormData","append","saveProduct","isChanged","reload","cancelEdit","removeSpec","specID","specName","specPrice","price","specStock","stock","originalSpecInfo","editSpec","beforeSpecImageUpload","isImage","startsWith","isLt2M","size","selectedFile","handleSpecImageChangeMain","specIndex","uploadSpecImage","saveSpec","cancelEditSpec","productForm","handleTabClick","handleImageChange","handleSpecImageChange","index","addSpec","push","submitGood","setActiveIndex","setTitle"],"sources":["D:/Cache/Java/shopping/shoppping_c_frontend/src/views/Store/StoreGoodView.vue"],"sourcesContent":["<template>\r\n  <div class=\"d-flex\" style=\"height: 100vh; overflow: hidden;\">\r\n    <ShopSliderComponent ref=\"shopSlider\"></ShopSliderComponent>\r\n    <div class=\"flex-grow-1 overflow-auto\" style=\"background: #f5f7fa;\">\r\n      <StoreHeaderView ref=\"storeHeader\"></StoreHeaderView>\r\n\r\n      <div class=\"p-4\" v-loading=\"loading\">\r\n        <el-tabs v-model=\"activeName\" class=\"demo-tabs\" @tab-click=\"handleTabClick\">\r\n          <el-tab-pane label=\"已上架商品\" name=\"first\">\r\n            <div class=\"search-container \">\r\n              <el-input\r\n                  class=\"search-input\"\r\n                  v-model=\"searchQuery\"\r\n                  placeholder=\"请输入商品名称或商品ID进行搜索\"\r\n                  clearable\r\n                  @keyup.enter=\"searchProducts\"\r\n              />\r\n              <el-button type=\"primary\" @click=\"searchProducts\">\r\n                <el-icon>\r\n                  <Search/>\r\n                </el-icon>\r\n                搜索\r\n              </el-button>\r\n            </div>\r\n            <div v-for=\"(product, productIndex) in filteredProducts\" :key=\"productIndex\" class=\"product-form-container\">\r\n              <div class=\"product-header\">\r\n                <h2 class=\"form-title\" v-if=\"!product.isEdited\">{{ product.name }}</h2>\r\n                <el-input v-model=\"product.name\" type=\"textarea\" placeholder=\"请输入商品名称\" v-else/>\r\n                <div>\r\n                  <div v-if=\"!product.isEdited\">\r\n                    <el-button type=\"danger\" @click=\"removeProduct(product)\" size=\"small\"\r\n                               v-if=\"product.status === true\">下架\r\n                    </el-button>\r\n                    <el-button type=\"danger\" @click=\"removeProduct(product)\" size=\"small\" v-else>上架\r\n                    </el-button>\r\n                    <el-button type=\"primary\" @click=\"editProduct(product)\" size=\"small\">修改</el-button>\r\n                  </div>\r\n                  <div v-else>\r\n                    <el-button type=\"primary\" @click=\"saveProduct(product)\" size=\"small\">保存</el-button>\r\n                    <el-button type=\"danger\" @click=\"cancelEdit(product)\" size=\"small\">取消</el-button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <el-divider/>\r\n\r\n              <!-- 商品信息 -->\r\n              <div class=\"product-info\">\r\n                <div class=\"image-preview\">\r\n                  <template v-if=\"product.isEdited\">\r\n                    <el-upload\r\n                        class=\"upload-demo\"\r\n                        :show-file-list=\"false\"\r\n                        :on-change=\"(file) =>  handleImageChangeMain(file, productIndex)\"\r\n                        :before-upload=\"beforeSpecImageUpload\"\r\n                        accept=\"image/*\"\r\n                        drag\r\n                    >\r\n                      <div v-if=\"!product.imageUrl\" class=\"image-placeholder\">\r\n                        <el-icon>\r\n                          <plus/>\r\n                        </el-icon>\r\n                        <p>点击上传或拖拽图片</p>\r\n                      </div>\r\n                      <el-image\r\n                          v-else\r\n                          :src=\"product.imageUrl\"\r\n                          alt=\"商品图片预览\"\r\n                          style=\"width: 200px; height: 200px; object-fit: cover; border-radius: 10px;\"\r\n                      />\r\n                    </el-upload>\r\n                  </template>\r\n                  <template v-else>\r\n                    <el-image\r\n                        style=\"width: 200px; height: 200px; object-fit: cover; border-radius: 10px;\"\r\n                        :src=\"product.imageUrl\"\r\n                        fit=\"cover\"\r\n                    />\r\n                  </template>\r\n                </div>\r\n                <div class=\"info-fields\">\r\n                  <el-form :model=\"product\" label-width=\"80px\">\r\n                    <el-form-item label=\"生产地\">\r\n                      <el-input v-model=\"product.origin\" placeholder=\"请输入生产地\"\r\n                                :disabled=\"!product.isEdited\"/>\r\n                    </el-form-item>\r\n                  </el-form>\r\n                </div>\r\n              </div>\r\n\r\n              <el-divider/>\r\n\r\n              <!-- 商品规格 -->\r\n              <h3 class=\"spec-title\">商品规格</h3>\r\n              <div v-for=\"(spec, specIndex) in product.specs\" :key=\"specIndex\" class=\"spec-item\">\r\n                <div class=\"spec-image\">\r\n                  <template v-if=\"spec.isEdited\">\r\n                    <el-upload\r\n                        class=\"upload-demo\"\r\n                        :show-file-list=\"false\"\r\n                        :on-change=\"(file) => handleSpecImageChangeMain(file, productIndex, specIndex)\"\r\n                        :before-upload=\"beforeSpecImageUpload\"\r\n                        accept=\"image/*\"\r\n                        drag\r\n                    >\r\n                      <div v-if=\"!spec.imageUrl\" class=\"image-placeholder\">\r\n                        <el-icon>\r\n                          <plus/>\r\n                        </el-icon>\r\n                        <p>点击上传或拖拽图片</p>\r\n                      </div>\r\n                      <el-image\r\n                          v-else\r\n                          :src=\"spec.imageUrl\"\r\n                          alt=\"规格图片预览\"\r\n                          style=\"width: 100px; height: 100px; object-fit: cover; border-radius: 10px;\"\r\n                      />\r\n                    </el-upload>\r\n                  </template>\r\n                  <template v-else>\r\n                    <el-image\r\n                        style=\"width: 100px; height: 100px; object-fit: cover; border-radius: 10px;\"\r\n                        :src=\"spec.imageUrl\"\r\n                        fit=\"cover\"\r\n                    />\r\n                  </template>\r\n                </div>\r\n                <div class=\"spec-fields\">\r\n                  <el-form label-width=\"80px\">\r\n                    <el-form-item label=\"规格名称\">\r\n                      <el-input v-model=\"spec.name\" :disabled=\"!spec.isEdited\"/>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"价格\">\r\n                      <el-input v-model=\"spec.price\" :disabled=\"!spec.isEdited\"/>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"库存\">\r\n                      <el-input v-model=\"spec.stock\" :disabled=\"!spec.isEdited\"/>\r\n                    </el-form-item>\r\n                  </el-form>\r\n                </div>\r\n                <div class=\"spec-actions\">\r\n                  <div v-if=\"!spec.isEdited\">\r\n                    <el-button type=\"danger\" size=\"small\" @click=\"removeSpec(product,spec)\"\r\n                               v-if=\"spec.status === true\">下架\r\n                    </el-button>\r\n                    <el-button type=\"danger\" size=\"small\" @click=\"removeSpec(product, spec)\" v-else>上架\r\n                    </el-button>\r\n                    <el-button type=\"primary\" size=\"small\" @click=\"editSpec(spec)\">修改</el-button>\r\n                  </div>\r\n                  <div v-else>\r\n                    <el-button type=\"primary\" size=\"small\" @click=\"saveSpec(product, spec)\">保存</el-button>\r\n                    <el-button type=\"danger\" size=\"small\" @click=\"cancelEditSpec(spec)\">取消</el-button>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </el-tab-pane>\r\n\r\n          <el-tab-pane label=\"上架商品\" name=\"second\">\r\n            <div class=\"product-form-container\">\r\n              <div>\r\n                <h2 class=\"form-title\">填写商品信息\r\n                  <el-button type=\"primary\" @click=\"submitGood\">\r\n                    完成\r\n                  </el-button>\r\n                </h2>\r\n              </div>\r\n              <el-divider/>\r\n\r\n              <!-- 商品信息 -->\r\n              <div class=\"product-info\">\r\n                <div class=\"image-preview\">\r\n                  <el-upload\r\n                      class=\"upload-demo\"\r\n                      :show-file-list=\"false\"\r\n                      :on-change=\"handleImageChange\"\r\n                      accept=\"image/*\"\r\n                      drag\r\n                  >\r\n                    <div v-if=\"!productForm.imageUrl\" class=\"image-placeholder\">\r\n                      <el-icon>\r\n                        <plus/>\r\n                      </el-icon>\r\n                      <p>点击上传或拖拽图片</p>\r\n                    </div>\r\n                    <img\r\n                        v-else\r\n                        :src=\"productForm.imageUrl\"\r\n                        alt=\"商品图片预览\"\r\n                        style=\"width: 200px; height: 200px; object-fit: cover; border-radius: 10px; cursor: pointer;\"\r\n                    />\r\n                  </el-upload>\r\n                </div>\r\n                <div class=\"info-fields\">\r\n                  <el-form :model=\"productForm\" label-width=\"80px\">\r\n                    <el-form-item label=\"商品名称\">\r\n                      <el-input v-model=\"productForm.name\" type=\"textarea\" placeholder=\"请输入商品名称\"/>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"生产地\">\r\n                      <el-input v-model=\"productForm.origin\" placeholder=\"请输入生产地\"/>\r\n                    </el-form-item>\r\n                  </el-form>\r\n                </div>\r\n              </div>\r\n\r\n              <el-divider/>\r\n\r\n              <!-- 商品规格 -->\r\n              <h3 class=\"spec-title\">商品规格</h3>\r\n              <div\r\n                  v-for=\"(spec, index) in productForm.specs\"\r\n                  :key=\"index\"\r\n                  class=\"spec-item\"\r\n              >\r\n                <div class=\"spec-image\">\r\n                  <el-upload\r\n                      class=\"upload-demo\"\r\n                      :show-file-list=\"false\"\r\n                      :on-change=\"(file) => handleSpecImageChange(file, index)\"\r\n                      accept=\"image/*\"\r\n                      drag\r\n                  >\r\n                    <div v-if=\"!spec.imageUrl\" class=\"image-placeholder\">\r\n                      <el-icon>\r\n                        <plus/>\r\n                      </el-icon>\r\n                      <p>点击上传或拖拽图片</p>\r\n                    </div>\r\n                    <img\r\n                        v-else\r\n                        :src=\"spec.imageUrl\"\r\n                        alt=\"规格图片预览\"\r\n                        style=\"width: 100px; height: 100px; object-fit: cover; border-radius: 10px;\"\r\n                    />\r\n                  </el-upload>\r\n                </div>\r\n                <div class=\"spec-fields\">\r\n                  <el-form label-width=\"80px\">\r\n                    <el-form-item label=\"规格名称\">\r\n                      <el-input v-model=\"spec.name\" placeholder=\"请输入规格名称\"/>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"价格\">\r\n                      <el-input v-model=\"spec.price\" placeholder=\"请输入价格\"/>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"库存\">\r\n                      <el-input v-model=\"spec.stock\" placeholder=\"请输入库存\"/>\r\n                    </el-form-item>\r\n                  </el-form>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"add-spec\">\r\n                <el-button\r\n                    type=\"primary\"\r\n                    @click=\"addSpec\"\r\n                    plain\r\n                    size=\"small\"\r\n                >\r\n                  <el-icon>\r\n                    <plus/>\r\n                  </el-icon>\r\n                  添加规格\r\n                </el-button>\r\n              </div>\r\n            </div>\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport ShopSliderComponent from \"@/components/ShopSliderComponent.vue\";\r\nimport {onMounted, ref} from \"vue\";\r\nimport {useUserShop} from \"@/composables/useShopUser\";\r\nimport {Plus, Search} from \"@element-plus/icons-vue\";\r\nimport {ElMessage} from \"element-plus\";\r\nimport axios from \"axios\";\r\nimport StoreHeaderView from \"@/components/StoreHeaderView.vue\";\r\n\r\nconst shopSlider = ref(null);\r\nconst storeHeader = ref(null);\r\nconst {shopForm, initUserSession, initShopInfo, UserForm} = useUserShop();\r\nconst activeName = ref(\"first\");\r\n\r\nconst products = ref();\r\nconst loading = ref();\r\n\r\nfunction isMerchant() {\r\n  if (UserForm.value.role !== \"merchant\") {\r\n    ElMessage.error(\"您没有权限访问该页面\");\r\n    setTimeout(() => {\r\n      window.location.href = \"/store/index\";\r\n    }, 1000);\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nasync function initProducts() {\r\n  try {\r\n    const response = await axios.post('/api/shop/getAllGoodInfo', {\r\n      shopID: shopForm.value.shopID,\r\n    }, {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      withCredentials: true\r\n    })\r\n    if (response.data != null) {\r\n      products.value = response.data;\r\n      filteredProducts.value = products.value;\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"获取商品信息失败\");\r\n  }\r\n}\r\n\r\nconst filteredProducts = ref([]);\r\n// 搜索框内容\r\nconst searchQuery = ref(\"\");\r\n\r\n// 过滤后的商品列表\r\nfunction searchProducts() {\r\n  if (searchQuery.value === \"\") {\r\n    filteredProducts.value = products.value;\r\n  } else {\r\n    filteredProducts.value = products.value\r\n        .filter(item =>\r\n            item.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||\r\n            item.goodID.toLowerCase().includes(searchQuery.value.toLowerCase())\r\n        )\r\n        .map(item => ({\r\n          ...item,\r\n          specs: item.specs.map(spec => ({...spec, imageUrl: spec.imageUrl.replace(\"@\", \"\")}))\r\n        }));\r\n  }\r\n}\r\n\r\n// 下架商品\r\nasync function removeProduct(product) {\r\n  try {\r\n    const response = await axios.post('/api/shop/updateGoodInfo', {\r\n      name: product.name,\r\n      goodID: product.goodID,\r\n      updateStatus: !product.status,\r\n      shopID: shopForm.value.shopID,\r\n      origin: product.origin,\r\n      imageUrl: product.imageUrl,\r\n      type: \"goodStatus\"\r\n    }, {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.code === 200) {\r\n      ElMessage.success(\"更改状态成功\");\r\n      await initProducts();\r\n    } else if (response.data.code === 400) {\r\n      ElMessage.error(\"更改状态失败\");\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"更改状态失败\");\r\n  }\r\n}\r\n\r\n// 修改商品\r\nconst originalProductInfo = ref();\r\n\r\nfunction editProduct(product) {\r\n  originalProductInfo.value = {...product};\r\n  product.isEdited = true;\r\n}\r\n\r\nconst selectedGoodFile = ref(null);\r\n\r\nfunction handleImageChangeMain(file, productIndex) {\r\n  const reader = new FileReader();\r\n  selectedGoodFile.value = file.raw;\r\n  reader.readAsDataURL(file.raw);\r\n  reader.onload = () => {\r\n    products.value[productIndex].imageUrl = reader.result;\r\n  };\r\n}\r\n\r\nasync function uploadProductImage(product) {\r\n  const formData = new FormData();\r\n  formData.append(\"image\", selectedGoodFile.value);\r\n  formData.append(\"goodID\", product.goodID)\r\n  try {\r\n    const response = await axios.post(\"/api/shop/updateGoodImage\", formData, {\r\n      headers: {\r\n        \"Content-Type\": \"multipart/form-data\"\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.code === 200) {\r\n      ElMessage.success(\"上传图片成功\");\r\n    } else if (response.data.code === 400) {\r\n      ElMessage.error(\"上传图片失败\");\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"上传图片失败\");\r\n  }\r\n}\r\n\r\nasync function saveProduct(product) {\r\n  if (product.name === \"\" || product.origin === \"\") {\r\n    ElMessage.error(\"请填写完整商品信息\");\r\n    return;\r\n  }\r\n  const isChanged = product.imageUrl !== originalProductInfo.value.imageUrl;\r\n  try {\r\n    const response = await axios.post('/api/shop/updateGoodInfo', {\r\n      name: product.name,\r\n      goodID: product.goodID,\r\n      shopID: shopForm.value.shopID,\r\n      origin: product.origin,\r\n      imageUrl: product.imageUrl,\r\n      type: \"goodInfo\"\r\n    }, {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.code === 200) {\r\n      ElMessage.success(\"修改商品信息成功\");\r\n      if (isChanged)\r\n        await uploadProductImage(product);\r\n      window.location.reload();\r\n    } else if (response.data.code === 400) {\r\n      ElMessage.error(\"修改商品信息失败\");\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"修改商品信息失败\");\r\n  }\r\n}\r\n\r\nfunction cancelEdit(product) {\r\n  product.isEdited = false;\r\n  // 重置商品信息\r\n  product.name = originalProductInfo.value.name;\r\n  product.origin = originalProductInfo.value.origin;\r\n  product.imageUrl = originalProductInfo.value.imageUrl;\r\n  product.specs = originalProductInfo.value.specs\r\n  originalProductInfo.value = null;\r\n}\r\n\r\n// 下架规格\r\nasync function removeSpec(product, spec) {\r\n  try {\r\n    const response = await axios.post('/api/shop/updateSpecInfo', {\r\n      goodID: product.goodID,\r\n      specID: spec.specID,\r\n      updateStatus: !spec.status,\r\n      specName: spec.name,\r\n      specPrice: spec.price,\r\n      specStock: spec.stock,\r\n      imageUrl: spec.imageUrl,\r\n      type: \"specStatus\"\r\n    }, {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.code === 200) {\r\n      ElMessage.success(\"更改规格状态成功\");\r\n      await initProducts();\r\n      spec.isEdited = false;\r\n    } else if (response.data.code === 400) {\r\n      ElMessage.error(\"更改规格状态失败\");\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"更改规格状态失败\");\r\n  }\r\n}\r\n\r\n// 修改规格\r\nconst originalSpecInfo = ref();\r\n\r\nfunction editSpec(spec) {\r\n  spec.isEdited = true;\r\n  originalSpecInfo.value = {...spec};\r\n}\r\n\r\nfunction beforeSpecImageUpload(file) {\r\n  const isImage = file.type.startsWith(\"image/\");\r\n  if (!isImage) {\r\n    ElMessage.error(\"仅支持图片文件！\");\r\n    return false;\r\n  }\r\n  const isLt2M = file.size / 1024 / 1024 < 2;\r\n  if (!isLt2M) {\r\n    ElMessage.error(\"文件大小不能超过 2MB！\");\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nconst selectedFile = ref(null);\r\n\r\nfunction handleSpecImageChangeMain(file, productIndex, specIndex) {\r\n  const reader = new FileReader();\r\n  selectedFile.value = file.raw;\r\n  reader.readAsDataURL(file.raw);\r\n  reader.onload = () => {\r\n    products.value[productIndex].specs[specIndex].imageUrl = reader.result;\r\n  };\r\n}\r\n\r\nasync function uploadSpecImage(spec) {\r\n  const formData = new FormData();\r\n  formData.append(\"image\", selectedFile.value);\r\n  formData.append(\"specID\", spec.specID)\r\n  try {\r\n    const response = await axios.post(\"/api/shop/updateSpecImage\", formData, {\r\n      headers: {\r\n        \"Content-Type\": \"multipart/form-data\"\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.code === 200) {\r\n      ElMessage.success(\"上传图片成功\");\r\n    } else if (response.data.code === 400) {\r\n      ElMessage.error(\"上传图片失败\");\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"上传图片失败\");\r\n  }\r\n}\r\n\r\nasync function saveSpec(product, spec) {\r\n  if (spec.name === \"\" || spec.price === \"\" || spec.stock === \"\") {\r\n    ElMessage.error(\"请填写完整规格信息\");\r\n    return;\r\n  }\r\n  const isChanged = spec.imageUrl !== originalSpecInfo.value.imageUrl;\r\n  try {\r\n    const response = await axios.post('/api/shop/updateSpecInfo', {\r\n      specName: spec.name,\r\n      goodID: product.goodID,\r\n      specID: spec.specID,\r\n      specPrice: spec.price,\r\n      specStock: spec.stock,\r\n      imageUrl: spec.imageUrl,\r\n      type: \"specInfo\"\r\n    }, {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.code === 200) {\r\n      ElMessage.success(\"修改规格信息成功\");\r\n      if (isChanged)\r\n        await uploadSpecImage(spec);\r\n      window.location.reload();\r\n    } else if (response.data.code === 400) {\r\n      ElMessage.error(\"修改规格信息失败\");\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"修改规格信息失败\");\r\n  }\r\n}\r\n\r\nfunction cancelEditSpec(spec) {\r\n  spec.isEdited = false;\r\n  // 重置规格信息\r\n  spec.name = originalSpecInfo.value.name;\r\n  spec.price = originalSpecInfo.value.price;\r\n  spec.stock = originalSpecInfo.value.stock;\r\n  spec.imageUrl = originalSpecInfo.value.imageUrl;\r\n  selectedFile.value = null;\r\n  originalSpecInfo.value = null;\r\n}\r\n\r\nconst productForm = ref({\r\n  shopID: \"\",\r\n  name: \"\",\r\n  origin: \"\",\r\n  imageUrl: \"\", // 商品主图预览URL\r\n  specs: [\r\n    {name: \"\", price: \"\", stock: \"\", imageUrl: \"\"}, // 规格初始项\r\n  ],\r\n});\r\n\r\nconst handleTabClick = () => {\r\n  if (activeName.value === \"second\") {\r\n    productForm.value.name = \"\";\r\n    productForm.value.origin = \"\";\r\n    productForm.value.imageUrl = \"\";\r\n    productForm.value.specs = [\r\n      {name: \"\", price: \"\", stock: \"\", imageUrl: \"\"},\r\n    ];\r\n  }\r\n}\r\n\r\n// 商品主图选择事件\r\nconst handleImageChange = (file) => {\r\n  const reader = new FileReader();\r\n  reader.readAsDataURL(file.raw);\r\n  reader.onload = () => {\r\n    productForm.value.imageUrl = reader.result;\r\n  };\r\n};\r\n\r\n// 商品规格图片选择事件\r\nconst handleSpecImageChange = (file, index) => {\r\n  const reader = new FileReader();\r\n  reader.readAsDataURL(file.raw);\r\n  reader.onload = () => {\r\n    productForm.value.specs[index].imageUrl = reader.result;\r\n  };\r\n};\r\n\r\n// 添加规格\r\nconst addSpec = () => {\r\n  productForm.value.specs.push({name: \"\", price: \"\", stock: \"\", imageUrl: \"\"});\r\n};\r\n\r\nasync function submitGood() {\r\n  try {\r\n    const response = await axios.post(\"/api/shop/insertGoodInfo\", {\r\n      shopID: shopForm.value.shopID,\r\n      name: productForm.value.name,\r\n      origin: productForm.value.origin,\r\n      imageUrl: productForm.value.imageUrl,\r\n      specs: productForm.value.specs,\r\n    });\r\n    if (response.data.code === 200) {\r\n      ElMessage.success(\"商品上架成功\")\r\n      window.location.reload();\r\n    } else if (response.data.code === 400) {\r\n      ElMessage.error(\"商品上架失败\")\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"商品上架失败\")\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  loading.value = true;\r\n  initUserSession();\r\n  await initShopInfo();\r\n  shopSlider.value.setActiveIndex(\"2-1\");\r\n  storeHeader.value.setTitle(\"商品管理\");\r\n  if (isMerchant()) {\r\n    productForm.value.shopID = shopForm.value.shopID;\r\n    await initProducts();\r\n    loading.value = false;\r\n  }\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.product-form-container {\r\n  border: 1px solid #e6e6e6;\r\n  border-radius: 10px;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12);\r\n  padding: 24px;\r\n  background: #fff;\r\n}\r\n\r\n.search-container {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n  padding-right: 20px;\r\n}\r\n\r\n.search-input {\r\n  padding: 10px;\r\n  font-size: 16px;\r\n  border: 2px solid #ccc;\r\n  border-radius: 8px 0 0 8px;\r\n  outline: none;\r\n  width: 200px;\r\n  border-right: none;\r\n}\r\n\r\n.form-title {\r\n  font-size: 20px;\r\n  font-weight: 600;\r\n  margin-bottom: 16px;\r\n  color: #333;\r\n}\r\n\r\n.product-info {\r\n  display: flex;\r\n  gap: 20px;\r\n  align-items: center;\r\n}\r\n\r\n.image-preview {\r\n  width: 200px;\r\n  height: 200px;\r\n  border: 2px dashed #d9d9d9;\r\n  border-radius: 10px;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  position: relative;\r\n  background: #f5f5f5;\r\n  cursor: pointer;\r\n}\r\n\r\n.image-placeholder {\r\n  text-align: center;\r\n  color: #999;\r\n  font-size: 14px;\r\n}\r\n\r\n.spec-title {\r\n  font-size: 18px;\r\n  font-weight: 600;\r\n  margin: 16px 0;\r\n  color: #666;\r\n}\r\n\r\n.spec-item {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 20px;\r\n  margin-bottom: 16px;\r\n}\r\n\r\n.spec-fields {\r\n  flex: 1;\r\n}\r\n\r\n.add-spec {\r\n  text-align: center;\r\n  margin-top: 16px;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}