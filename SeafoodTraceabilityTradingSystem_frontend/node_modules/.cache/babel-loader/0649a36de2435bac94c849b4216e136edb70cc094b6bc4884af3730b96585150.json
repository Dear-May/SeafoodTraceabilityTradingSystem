{"ast":null,"code":"import { onMounted, ref } from \"vue\";\nimport axios from \"axios\";\nimport { ElMessage } from \"element-plus\";\nimport router from \"@/router\";\nexport default {\n  __name: 'AdminIndexView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    let id = null;\n    async function checkUserPermission() {\n      id = new URLSearchParams(window.location.search).get('id');\n      if (!id) {\n        ElMessage.error('权限校验失败');\n        await router.replace('/');\n      } else {\n        try {\n          const response = await axios.post('/api/admin/checkUserPermission', {\n            id: id\n          }, {\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            withCredentials: true\n          });\n          if (response.data.code !== 200) {\n            ElMessage.error('无权限访问');\n            await router.replace('/');\n          }\n        } catch (error) {\n          ElMessage.error('获取权限失败');\n          await router.replace('/');\n        }\n      }\n    }\n    const shops = ref([]);\n    const formatDate = date => {\n      if (!date) return '';\n      const d = new Date(date);\n      const year = d.getFullYear();\n      const month = String(d.getMonth() + 1).padStart(2, '0'); // 月份从0开始，所以需要加1\n      const day = String(d.getDate()).padStart(2, '0');\n      const hours = String(d.getHours()).padStart(2, '0');\n      const minutes = String(d.getMinutes()).padStart(2, '0');\n      const seconds = String(d.getSeconds()).padStart(2, '0');\n      return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n    };\n    async function initShops() {\n      try {\n        const response = await axios.post('/api/admin/getAllReviewLicenses', {}, {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          withCredentials: true\n        });\n        if (response.data !== null) {\n          shops.value = response.data;\n          console.log(shops.value);\n        }\n      } catch (error) {\n        ElMessage.error('获取商家信息失败');\n      }\n    }\n    const activeNames = ref([]);\n    async function approveShop(index) {\n      try {\n        const response = await axios.post('/api/admin/updateReviewLicenseStatus', {\n          id: shops.value[index].licenseInfo.id,\n          status: \"通过\"\n        }, {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          withCredentials: true\n        });\n        if (response.data.code === 200) {\n          ElMessage.success('审核通过');\n          await initShops();\n        } else ElMessage.error('审核失败1');\n      } catch (error) {\n        ElMessage.error('审核失败');\n      }\n    }\n    async function rejectShop(index) {\n      try {\n        const response = await axios.post('/api/admin/updateReviewLicenseStatus', {\n          id: shops.value[index].licenseInfo.id,\n          status: \"未通过\"\n        }, {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          withCredentials: true\n        });\n        if (response.data.code === 200) {\n          await initShops();\n          ElMessage.success('退回申请成功');\n        } else ElMessage.error('退回申请失败');\n      } catch (error) {\n        ElMessage.error('退回申请失败');\n      }\n    }\n    onMounted(async () => {\n      await checkUserPermission();\n      await initShops();\n    });\n    const __returned__ = {\n      get id() {\n        return id;\n      },\n      set id(v) {\n        id = v;\n      },\n      checkUserPermission,\n      shops,\n      formatDate,\n      initShops,\n      activeNames,\n      approveShop,\n      rejectShop,\n      onMounted,\n      ref,\n      get axios() {\n        return axios;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get router() {\n        return router;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["onMounted","ref","axios","ElMessage","router","id","checkUserPermission","URLSearchParams","window","location","search","get","error","replace","response","post","headers","withCredentials","data","code","shops","formatDate","date","d","Date","year","getFullYear","month","String","getMonth","padStart","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","initShops","value","console","log","activeNames","approveShop","index","licenseInfo","status","success","rejectShop"],"sources":["D:/Cache/Java/shopping/shoppping_c_frontend/src/views/Admin/AdminIndexView.vue"],"sourcesContent":["<template>\r\n  <div class=\"d-flex\" style=\"height: 100vh; overflow: hidden;\">\r\n    <aside class=\"bg-dark text-light\" style=\"width: 200px; padding-top: 20px;\">\r\n      <div class=\"text-center mb-4\">\r\n        <a style=\"font-size: 16px; font-weight: bold\">后台管理</a>\r\n      </div>\r\n      <el-menu\r\n          :default-openeds=\"['1']\"\r\n          :default-active=\"'1-1'\"\r\n          class=\"border-0\"\r\n          text-color=\"#fff\"\r\n          active-text-color=\"#ffd04b\"\r\n          background-color=\"#333\"\r\n      >\r\n        <el-sub-menu index=\"1\">\r\n          <template #title>首页</template>\r\n          <el-menu-item index=\"1-1\">首页</el-menu-item>\r\n          <el-menu-item index=\"1-2\" @click=\"() => router.push('/admin/goodSync?id='+id)\">搜索引擎商品数据同步\r\n          </el-menu-item>\r\n        </el-sub-menu>\r\n      </el-menu>\r\n    </aside>\r\n\r\n    <div class=\"flex-grow-1 overflow-auto\" style=\"background: #f5f7fa;\">\r\n      <nav class=\"navbar navbar-light bg-white border-bottom shadow-sm\">\r\n        <div class=\"container-fluid\">\r\n          <span class=\"navbar-brand mb-0 h1\">店铺审核</span>\r\n        </div>\r\n      </nav>\r\n\r\n      <div class=\"p-4\">\r\n        <el-collapse v-model=\"activeNames\">\r\n          <el-collapse-item v-for=\"(shop, index) in shops\" :key=\"index\" :title=\"shop.name\" :name=\"index\">\r\n            <table border=\"1\">\r\n              <thead>\r\n              <tr>\r\n                <th>项目</th>\r\n                <th>信息</th>\r\n              </tr>\r\n              </thead>\r\n              <tbody>\r\n              <tr>\r\n                <td>ID</td>\r\n                <td>{{ shop.licenseInfo.id }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>店铺ID</td>\r\n                <td>{{ shop.licenseInfo.shopid }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>插入时间</td>\r\n                <td>{{ formatDate(shop.licenseInfo.inserttime) }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>更新时间</td>\r\n                <td>{{ formatDate(shop.licenseInfo.updatetime) }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>状态</td>\r\n                <td>{{ shop.licenseInfo.status }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>统一社会信用代码</td>\r\n                <td>{{ shop.licenseInfo.socialcreditcode }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>名称</td>\r\n                <td>{{ shop.licenseInfo.name }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>地址</td>\r\n                <td>{{ shop.licenseInfo.location }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>注册资本</td>\r\n                <td>{{ shop.licenseInfo.registeredcapital }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>实收资本</td>\r\n                <td>{{ shop.licenseInfo.paidincapital }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>成立日期</td>\r\n                <td>{{ shop.licenseInfo.dateofestablishment }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>经营范围</td>\r\n                <td>{{ shop.licenseInfo.businessscope }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>法定代表人</td>\r\n                <td>{{ shop.licenseInfo.legalrepresentative }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>公司类型</td>\r\n                <td>{{ shop.licenseInfo.type }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>登记机关</td>\r\n                <td>{{ shop.licenseInfo.registrationauthority }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>组成形式</td>\r\n                <td>{{ shop.licenseInfo.compositionform }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>身份证号</td>\r\n                <td>{{ shop.licenseInfo.idnumber }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>有效期至</td>\r\n                <td>{{ shop.licenseInfo.periodOfValidity }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>有效期起始日期</td>\r\n                <td>{{ shop.licenseInfo.startingdateofvalidityperiod }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>批准日期</td>\r\n                <td>{{ shop.licenseInfo.dateofapproval }}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>税务登记号</td>\r\n                <td>{{ shop.licenseInfo.taxregistrationnumber }}</td>\r\n              </tr>\r\n              </tbody>\r\n            </table>\r\n            <el-image :src=\"shop.licenseImage\" style=\"width: 50vw; height: auto\"\r\n                      :preview-src-list=\"[shop.licenseImage]\"></el-image>\r\n            <div class=\"mt-2\">\r\n              <el-button type=\"success\" @click=\"approveShop(index)\">通过审核</el-button>\r\n              <el-button type=\"danger\" @click=\"rejectShop(index)\">退回申请</el-button>\r\n            </div>\r\n          </el-collapse-item>\r\n        </el-collapse>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {onMounted, ref} from \"vue\";\r\nimport axios from \"axios\";\r\nimport {ElMessage} from \"element-plus\";\r\nimport router from \"@/router\";\r\n\r\nlet id = null;\r\n\r\nasync function checkUserPermission() {\r\n  id = new URLSearchParams(window.location.search).get('id');\r\n  if (!id) {\r\n    ElMessage.error('权限校验失败');\r\n    await router.replace('/')\r\n  } else {\r\n    try {\r\n      const response = await axios.post('/api/admin/checkUserPermission', {\r\n        id: id,\r\n      }, {\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        withCredentials: true\r\n      });\r\n      if (response.data.code !== 200) {\r\n        ElMessage.error('无权限访问')\r\n        await router.replace('/')\r\n      }\r\n    } catch (error) {\r\n      ElMessage.error('获取权限失败')\r\n      await router.replace('/')\r\n    }\r\n  }\r\n}\r\n\r\nconst shops = ref([]);\r\n\r\nconst formatDate = (date) => {\r\n  if (!date) return '';\r\n  const d = new Date(date);\r\n  const year = d.getFullYear();\r\n  const month = String(d.getMonth() + 1).padStart(2, '0'); // 月份从0开始，所以需要加1\r\n  const day = String(d.getDate()).padStart(2, '0');\r\n  const hours = String(d.getHours()).padStart(2, '0');\r\n  const minutes = String(d.getMinutes()).padStart(2, '0');\r\n  const seconds = String(d.getSeconds()).padStart(2, '0');\r\n  return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\r\n}\r\n\r\nasync function initShops() {\r\n  try {\r\n    const response = await axios.post('/api/admin/getAllReviewLicenses', {}, {\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data !== null) {\r\n      shops.value = response.data;\r\n      console.log(shops.value);\r\n    }\r\n  } catch (error) {\r\n    ElMessage.error('获取商家信息失败')\r\n  }\r\n}\r\n\r\nconst activeNames = ref([]);\r\n\r\nasync function approveShop(index) {\r\n  try {\r\n    const response = await axios.post('/api/admin/updateReviewLicenseStatus', {\r\n      id: shops.value[index].licenseInfo.id,\r\n      status: \"通过\"\r\n    }, {\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.code === 200) {\r\n      ElMessage.success('审核通过')\r\n      await initShops();\r\n    } else\r\n      ElMessage.error('审核失败1')\r\n  } catch (error) {\r\n    ElMessage.error('审核失败')\r\n  }\r\n}\r\n\r\nasync function rejectShop(index) {\r\n  try {\r\n    const response = await axios.post('/api/admin/updateReviewLicenseStatus', {\r\n      id: shops.value[index].licenseInfo.id,\r\n      status: \"未通过\"\r\n    }, {\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.code === 200) {\r\n      await initShops();\r\n      ElMessage.success('退回申请成功')\r\n    } else\r\n      ElMessage.error('退回申请失败')\r\n  } catch (error) {\r\n    ElMessage.error('退回申请失败')\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  await checkUserPermission();\r\n  await initShops();\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\ntd {\r\n  padding: 10px;\r\n  border: 1px solid #ccc;\r\n  font-size: 14px;\r\n  font-weight: bold;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}