{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ArrowDown } from \"@element-plus/icons-vue\";\nimport router from \"@/router\";\nimport { onMounted, ref } from \"vue\";\nimport { ElMessage } from \"element-plus\";\nimport useUser from \"@/composables/useUser\";\nimport axios from \"axios\";\nexport default {\n  __name: 'HeaderComponent',\n  setup(__props, {\n    expose: __expose\n  }) {\n    const {\n      UserInfoForm,\n      initUserSession\n    } = useUser();\n    const searchCategory = ref('product');\n    const setSearchCategory = category => {\n      searchCategory.value = category;\n    };\n    const searchQuery = ref('');\n    function searchProduct(searchText) {\n      router.push('/search?searchText=' + searchText);\n    }\n    const city = localStorage.getItem('city');\n    const weather = localStorage.getItem('weather');\n    const temperature = localStorage.getItem('temperature');\n    const handleMyProfileClick = () => {\n      router.push('/mySpace');\n    };\n    const handleMyMessage = () => {\n      router.push('/talkToStore');\n    };\n    function handleIndex() {\n      router.push('/');\n    }\n    function handleTalk() {\n      router.push('/talk');\n    }\n    const unreadMessageCount = ref(0);\n    async function getUnreadMessageCount() {\n      try {\n        const response = await axios.post('/api/chat/getUnreadMessageCount', {\n          userId: UserInfoForm.value.id\n        }, {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          withCredentials: true\n        });\n        if (response.data.count !== 0) unreadMessageCount.value = response.data.count;\n      } catch (err) {\n        ElMessage.error('获取未读消息失败');\n      }\n    }\n    __expose({\n      getUnreadMessageCount\n    });\n    function logout() {\n      sessionStorage.removeItem('userBaseInfo');\n      //清除cookie\n      const cookies = document.cookie.split(\"; \");\n      for (let cookie of cookies) {\n        const eqPos = cookie.indexOf(\"=\");\n        const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;\n        document.cookie = name + \"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/\";\n      }\n      ElMessage.success('退出成功');\n      setTimeout(() => {\n        router.push('/');\n      }, 1500);\n    }\n    onMounted(async () => {\n      initUserSession();\n      if (UserInfoForm.value.id) {\n        await getUnreadMessageCount();\n      }\n    });\n    const __returned__ = {\n      UserInfoForm,\n      initUserSession,\n      searchCategory,\n      setSearchCategory,\n      searchQuery,\n      searchProduct,\n      city,\n      weather,\n      temperature,\n      handleMyProfileClick,\n      handleMyMessage,\n      handleIndex,\n      handleTalk,\n      unreadMessageCount,\n      getUnreadMessageCount,\n      logout,\n      get ArrowDown() {\n        return ArrowDown;\n      },\n      get router() {\n        return router;\n      },\n      onMounted,\n      ref,\n      get ElMessage() {\n        return ElMessage;\n      },\n      get useUser() {\n        return useUser;\n      },\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ArrowDown","router","onMounted","ref","ElMessage","useUser","axios","UserInfoForm","initUserSession","searchCategory","setSearchCategory","category","value","searchQuery","searchProduct","searchText","push","city","localStorage","getItem","weather","temperature","handleMyProfileClick","handleMyMessage","handleIndex","handleTalk","unreadMessageCount","getUnreadMessageCount","response","post","userId","id","headers","withCredentials","data","count","err","error","__expose","logout","sessionStorage","removeItem","cookies","document","cookie","split","eqPos","indexOf","name","substr","success","setTimeout"],"sources":["D:/Cache/Java/shopping/shoppping_c_frontend/src/components/HeaderComponent.vue"],"sourcesContent":["<template>\r\n  <header class=\"p-3 mb-3 border-bottom header\">\r\n    <div class=\"container-fluid\">\r\n      <div class=\"row\">\r\n        <div class=\"col-3 d-flex align-items-center justify-content-start\">\r\n          <a href=\"/\" class=\"d-flex align-items-center mb-2 mb-lg-0 link-body-emphasis text-decoration-none\">\r\n            <img src=\"../images/logo.png\" alt=\"Haichao\" class=\"bi me-2\" width=\"50\" height=\"50\" role=\"img\"\r\n                 aria-label=\"Haichao\">\r\n          </a>\r\n          <nav class=\"nav\">\r\n            <a @click=\"handleMyProfileClick\" class=\"nav-link px-2 link-secondary\">我的海潮</a>\r\n            <a @click=\"handleIndex\" class=\"nav-link px-2 link-emphasis\">首页</a>\r\n            <a href=\"#\" class=\"nav-link px-2 link-body-emphasis\">帮助中心</a>\r\n          </nav>\r\n        </div>\r\n\r\n        <div class=\"col-6 d-flex align-items-center justify-content-center\">\r\n          <div class=\"search-bar\">\r\n            <el-dropdown>\r\n                <span class=\"el-dropdown-link search-select\">\r\n                  {{ searchCategory === 'product' ? '商品' : '商家' }}\r\n                  <el-icon class=\"el-icon--right\">\r\n                    <arrow-down/>\r\n                  </el-icon>\r\n                </span>\r\n              <template #dropdown>\r\n                <el-dropdown-menu>\r\n                  <el-dropdown-item @click=\"setSearchCategory('product')\">商品</el-dropdown-item>\r\n                  <el-dropdown-item @click=\"setSearchCategory('store')\">商家</el-dropdown-item>\r\n                </el-dropdown-menu>\r\n              </template>\r\n            </el-dropdown>\r\n            <el-input\r\n                placeholder=\"商品/店铺/品牌\"\r\n                v-model=\"searchQuery\"\r\n                @keyup.enter=\"searchProduct(searchQuery)\"\r\n                clearable\r\n                class=\"search-input\"\r\n            />\r\n            <el-button type=\"primary\" icon=\"el-icon-search\" class=\"search-button\" @click=\"searchProduct(searchQuery)\">搜索\r\n            </el-button>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"col-3 d-flex align-items-center justify-content-end\" style=\"margin-left: auto;\">\r\n          <template v-if=\"UserInfoForm.id\">\r\n            <div class=\"weather-info d-flex align-items-center\">\r\n              <i class=\"bi bi-geo-alt-fill me-2\" style=\"font-size: 20px;\"></i>\r\n              <span>{{ city }}</span>\r\n              <i class=\"bi bi-cloud-sun-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='晴'\"></i>\r\n              <i class=\"bi bi-cloud-fog-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='阴'\"></i>\r\n              <i class=\"bi bi-cloud-rain-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='雨'\"></i>\r\n              <i class=\"bi bi-cloud-haze-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='雾'\"></i>\r\n              <i class=\"bi bi-cloud-sun-rain-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='多云'\"></i>\r\n              <i class=\"bi bi-cloud ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='霾'\"></i>\r\n              <div class=\"d-flex flex-column ms-2\">\r\n                <span>{{ weather }}</span>\r\n                <span>{{ temperature }}°C</span>\r\n              </div>\r\n            </div>\r\n            &nbsp;&nbsp;&nbsp;&nbsp;\r\n            <nav class=\"nav\">\r\n              <a href=\"#\" class=\"nav-link px-2 link-secondary\" @click=\"handleIndex\">主页</a>\r\n              <a href=\"#\" class=\"nav-link px-2 link-body-emphasis\" @click=\"handleTalk\">讨论</a>\r\n            </nav>\r\n            &nbsp;&nbsp;&nbsp;&nbsp;\r\n            <div class=\"dropdown text-end margin-right-10\">\r\n              <a href=\"#\" class=\"d-block link-body-emphasis text-decoration-none dropdown-toggle\"\r\n                 data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n                <img :src=\"UserInfoForm.avatar\" alt=\"mdo\" width=\"40\" height=\"40\" class=\"rounded-circle\">\r\n              </a>\r\n              <ul class=\"dropdown-menu text-small\">\r\n                <li><a class=\"dropdown-item\" @click=\"handleMyProfileClick\">我的海潮</a></li>\r\n                <li>\r\n                  <el-badge :value=\"unreadMessageCount\" class=\"item\">\r\n                    <a class=\"dropdown-item\" @click=\"handleMyMessage\">我的消息</a>\r\n                  </el-badge>\r\n                </li>\r\n                <li><a class=\"dropdown-item\" href=\"#\">设置</a></li>\r\n                <li>\r\n                  <hr class=\"dropdown-divider\">\r\n                </li>\r\n                <li><a class=\"dropdown-item\" @click=\"logout\">登出账号</a></li>\r\n              </ul>\r\n            </div>\r\n          </template>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </header>\r\n</template>\r\n\r\n<script setup>\r\nimport {ArrowDown} from \"@element-plus/icons-vue\";\r\nimport router from \"@/router\";\r\nimport {defineExpose, onMounted, ref} from \"vue\";\r\nimport {ElMessage} from \"element-plus\";\r\nimport useUser from \"@/composables/useUser\";\r\nimport axios from \"axios\";\r\n\r\nconst {UserInfoForm, initUserSession} = useUser()\r\n\r\nconst searchCategory = ref('product');\r\nconst setSearchCategory = (category) => {\r\n  searchCategory.value = category;\r\n};\r\nconst searchQuery = ref('');\r\n\r\nfunction searchProduct(searchText) {\r\n  router.push('/search?searchText=' + searchText);\r\n}\r\n\r\nconst city = localStorage.getItem('city');\r\nconst weather = localStorage.getItem('weather');\r\nconst temperature = localStorage.getItem('temperature');\r\n\r\nconst handleMyProfileClick = () => {\r\n  router.push('/mySpace');\r\n};\r\n\r\nconst handleMyMessage = () => {\r\n  router.push('/talkToStore');\r\n}\r\n\r\nfunction handleIndex() {\r\n  router.push('/');\r\n}\r\n\r\nfunction handleTalk() {\r\n  router.push('/talk');\r\n}\r\n\r\nconst unreadMessageCount = ref(0);\r\n\r\nasync function getUnreadMessageCount() {\r\n  try {\r\n    const response = await axios.post('/api/chat/getUnreadMessageCount', {\r\n      userId: UserInfoForm.value.id\r\n    }, {\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.count !== 0)\r\n      unreadMessageCount.value = response.data.count;\r\n  } catch (err) {\r\n    ElMessage.error('获取未读消息失败');\r\n  }\r\n}\r\n\r\ndefineExpose({getUnreadMessageCount});\r\n\r\nfunction logout() {\r\n  sessionStorage.removeItem('userBaseInfo');\r\n  //清除cookie\r\n  const cookies = document.cookie.split(\"; \");\r\n  for (let cookie of cookies) {\r\n    const eqPos = cookie.indexOf(\"=\");\r\n    const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;\r\n    document.cookie = name + \"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/\";\r\n  }\r\n  ElMessage.success('退出成功');\r\n  setTimeout(() => {\r\n    router.push('/');\r\n  }, 1500);\r\n}\r\n\r\nonMounted(async () => {\r\n  initUserSession();\r\n  if (UserInfoForm.value.id) {\r\n    await getUnreadMessageCount();\r\n  }\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.header {\r\n  position: fixed;\r\n  top: 0;\r\n  width: 100%;\r\n  z-index: 1001;\r\n  background-color: #ffffff; // 设置背景色确保内容可见\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); // 添加阴影使其更明显\r\n  transition: all 0.3s ease; // 添加过渡效果\r\n}\r\n\r\n.header.nav.a:hover {\r\n  color: #e02020;\r\n}\r\n\r\n.search-bar {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  max-width: 800px;\r\n  width: 100%;\r\n  border: 2px solid #e02020;\r\n  border-radius: 50px;\r\n  overflow: hidden;\r\n}\r\n\r\n.search-select {\r\n  cursor: pointer;\r\n  padding: 0 15px;\r\n  display: flex;\r\n  align-items: center;\r\n  border-right: 1px solid #e02020;\r\n  background-color: transparent;\r\n  font-size: 16px;\r\n}\r\n\r\n.search-input {\r\n  flex: 1;\r\n  border: none;\r\n  outline: none;\r\n  height: 50px;\r\n  font-size: 16px;\r\n  box-shadow: none;\r\n  background-color: transparent;\r\n}\r\n\r\n.search-button {\r\n  height: 50px;\r\n  background-color: #e02020;\r\n  color: #ffffff;\r\n  border: none;\r\n  border-radius: 0;\r\n  padding: 0 30px;\r\n  font-size: 16px;\r\n}\r\n\r\n.el-tooltip__trigger:focus-visible {\r\n  outline: unset;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}