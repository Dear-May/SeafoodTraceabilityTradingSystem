{"ast":null,"code":"import ShopSliderComponent from \"@/components/ShopSliderComponent.vue\";\nimport StoreHeaderView from \"@/components/StoreHeaderView.vue\";\nimport { ref, onMounted } from \"vue\";\nimport { useUserShop } from \"@/composables/useShopUser\";\nimport VueVideoPlayer from \"vue-video-player\";\nimport \"video.js/dist/video-js.css\"; // 导入 video.js 样式\n\n// 组件引用\n\nexport default {\n  __name: 'LiveView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const shopSlider = ref(null);\n    const storeHeader = ref(null);\n    const {\n      shopForm,\n      initUserSession,\n      initShopInfo\n    } = useUserShop();\n\n    // 控制变量\n    const loading = ref(false);\n    const isPlaying = ref(false);\n\n    // 拉流播放地址\n    const playSrc = ref(\"\"); // 示例：通过服务器生成 RTMP/HLS 地址\n\n    // 视频播放器配置\n    const playerOptions = ref({\n      autoplay: true,\n      // 自动播放\n      controls: true,\n      // 显示控制按钮\n      preload: \"auto\",\n      playbackRates: [0.5, 1.0, 1.5, 2.0],\n      // 播放速度\n      fluid: true,\n      // 自适应大小\n      language: \"zh-CN\",\n      // 视频语言\n      sources: [],\n      // 视频源\n      poster: \"https://via.placeholder.com/800x450.png?text=直播未开始\" // 播放器封面\n    });\n\n    // 初始化播放器\n    const initPlayer = () => {\n      playerOptions.value.sources = [{\n        src: playSrc.value,\n        // 设置拉流地址\n        type: \"application/x-mpegURL\" // HLS 流媒体格式\n      }];\n    };\n\n    // 播放流\n    const playStream = async () => {\n      if (isPlaying.value) return;\n      try {\n        loading.value = true;\n\n        // 设置流媒体拉流地址（示例：HLS 或 RTMP 转 HLS 地址）\n        playSrc.value = `http://localhost:8080/live/${shopForm.value.shopID}/index.m3u8`;\n\n        // 初始化播放器\n        initPlayer();\n\n        // 播放\n        const player = document.querySelector(\".video-player video\");\n        player.play();\n        isPlaying.value = true;\n        console.log(\"正在观看直播流:\", playSrc.value);\n      } catch (error) {\n        console.error(\"拉流失败:\", error);\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 停止播放\n    const stopStream = () => {\n      if (!isPlaying.value) return;\n      const player = document.querySelector(\".video-player video\");\n      player.pause();\n      player.src = \"\"; // 停止流加载\n      isPlaying.value = false;\n      console.log(\"已停止观看直播\");\n    };\n\n    // 组件挂载\n    onMounted(async () => {\n      loading.value = true;\n      await initUserSession();\n      await initShopInfo();\n      shopSlider.value.setActiveIndex(\"6-2\");\n      storeHeader.value.setTitle(\"直播间\");\n      loading.value = false;\n    });\n    const __returned__ = {\n      shopSlider,\n      storeHeader,\n      shopForm,\n      initUserSession,\n      initShopInfo,\n      loading,\n      isPlaying,\n      playSrc,\n      playerOptions,\n      initPlayer,\n      playStream,\n      stopStream,\n      ShopSliderComponent,\n      StoreHeaderView,\n      ref,\n      onMounted,\n      get useUserShop() {\n        return useUserShop;\n      },\n      get VueVideoPlayer() {\n        return VueVideoPlayer;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ShopSliderComponent","StoreHeaderView","ref","onMounted","useUserShop","VueVideoPlayer","shopSlider","storeHeader","shopForm","initUserSession","initShopInfo","loading","isPlaying","playSrc","playerOptions","autoplay","controls","preload","playbackRates","fluid","language","sources","poster","initPlayer","value","src","type","playStream","shopID","player","document","querySelector","play","console","log","error","stopStream","pause","setActiveIndex","setTitle"],"sources":["D:/Cache/Java/shopping/shoppping_c_frontend/src/views/LiveView.vue"],"sourcesContent":["<template>\r\n  <div class=\"d-flex\" style=\"height: 100vh; overflow: hidden;\">\r\n    <ShopSliderComponent ref=\"shopSlider\"></ShopSliderComponent>\r\n    <div class=\"flex-grow-1 overflow-auto\" style=\"background: #f5f7fa;\">\r\n      <StoreHeaderView ref=\"storeHeader\"></StoreHeaderView>\r\n\r\n      <div class=\"p-4\" v-loading=\"loading\">\r\n        <div class=\"live-stream-container\">\r\n          <!-- 拉流界面 -->\r\n          <div class=\"header bg-light d-flex align-items-center p-3 shadow-sm\">\r\n            <h5 class=\"text-primary me-auto mb-0\">观看直播</h5>\r\n            <el-button\r\n                type=\"primary\"\r\n                size=\"small\"\r\n                :disabled=\"isPlaying\"\r\n                @click=\"playStream\"\r\n            >\r\n              开始观看\r\n            </el-button>\r\n            <el-button\r\n                type=\"danger\"\r\n                size=\"small\"\r\n                :disabled=\"!isPlaying\"\r\n                @click=\"stopStream\"\r\n            >\r\n              停止观看\r\n            </el-button>\r\n          </div>\r\n\r\n          <div class=\"content-container\">\r\n            <vue-video-player\r\n                ref=\"videoPlayer\"\r\n                class=\"video-player\"\r\n                :options=\"playerOptions\"\r\n            ></vue-video-player>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script setup>\r\nimport ShopSliderComponent from \"@/components/ShopSliderComponent.vue\";\r\nimport StoreHeaderView from \"@/components/StoreHeaderView.vue\";\r\nimport {ref, onMounted} from \"vue\";\r\nimport {useUserShop} from \"@/composables/useShopUser\";\r\nimport VueVideoPlayer from \"vue-video-player\";\r\nimport \"video.js/dist/video-js.css\"; // 导入 video.js 样式\r\n\r\n// 组件引用\r\nconst shopSlider = ref(null);\r\nconst storeHeader = ref(null);\r\nconst {shopForm, initUserSession, initShopInfo} = useUserShop();\r\n\r\n// 控制变量\r\nconst loading = ref(false);\r\nconst isPlaying = ref(false);\r\n\r\n// 拉流播放地址\r\nconst playSrc = ref(\"\"); // 示例：通过服务器生成 RTMP/HLS 地址\r\n\r\n// 视频播放器配置\r\nconst playerOptions = ref({\r\n  autoplay: true, // 自动播放\r\n  controls: true, // 显示控制按钮\r\n  preload: \"auto\",\r\n  playbackRates: [0.5, 1.0, 1.5, 2.0], // 播放速度\r\n  fluid: true, // 自适应大小\r\n  language: \"zh-CN\", // 视频语言\r\n  sources: [], // 视频源\r\n  poster: \"https://via.placeholder.com/800x450.png?text=直播未开始\", // 播放器封面\r\n});\r\n\r\n// 初始化播放器\r\nconst initPlayer = () => {\r\n  playerOptions.value.sources = [\r\n    {\r\n      src: playSrc.value, // 设置拉流地址\r\n      type: \"application/x-mpegURL\", // HLS 流媒体格式\r\n    },\r\n  ];\r\n};\r\n\r\n// 播放流\r\nconst playStream = async () => {\r\n  if (isPlaying.value) return;\r\n\r\n  try {\r\n    loading.value = true;\r\n\r\n    // 设置流媒体拉流地址（示例：HLS 或 RTMP 转 HLS 地址）\r\n    playSrc.value = `http://localhost:8080/live/${shopForm.value.shopID}/index.m3u8`;\r\n\r\n    // 初始化播放器\r\n    initPlayer();\r\n\r\n    // 播放\r\n    const player = document.querySelector(\".video-player video\");\r\n    player.play();\r\n    isPlaying.value = true;\r\n\r\n    console.log(\"正在观看直播流:\", playSrc.value);\r\n  } catch (error) {\r\n    console.error(\"拉流失败:\", error);\r\n  } finally {\r\n    loading.value = false;\r\n  }\r\n};\r\n\r\n// 停止播放\r\nconst stopStream = () => {\r\n  if (!isPlaying.value) return;\r\n\r\n  const player = document.querySelector(\".video-player video\");\r\n  player.pause();\r\n  player.src = \"\"; // 停止流加载\r\n  isPlaying.value = false;\r\n\r\n  console.log(\"已停止观看直播\");\r\n};\r\n\r\n// 组件挂载\r\nonMounted(async () => {\r\n  loading.value = true;\r\n  await initUserSession();\r\n  await initShopInfo();\r\n  shopSlider.value.setActiveIndex(\"6-2\");\r\n  storeHeader.value.setTitle(\"直播间\");\r\n  loading.value = false;\r\n});\r\n</script>\r\n\r\n\r\n<style lang=\"less\" scoped>\r\n.live-stream-container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 80vh;\r\n}\r\n\r\n.header {\r\n  display: flex;\r\n  align-items: center;\r\n  border-bottom: 1px solid #ddd;\r\n}\r\n\r\n.content-container {\r\n  flex: 1;\r\n  background: #000; /* 播放器背景 */\r\n}\r\n\r\n.video-player {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.video-js .vjs-big-play-button {\r\n  top: 50%;\r\n  left: 50%;\r\n  margin-top: -1em;\r\n  margin-left: -1em;\r\n}\r\n</style>\r\n"],"mappings":"AA4CA,OAAOA,mBAAmB,MAAM,sCAAsC;AACtE,OAAOC,eAAe,MAAM,kCAAkC;AAC9D,SAAQC,GAAG,EAAEC,SAAS,QAAO,KAAK;AAClC,SAAQC,WAAW,QAAO,2BAA2B;AACrD,OAAOC,cAAc,MAAM,kBAAkB;AAC7C,OAAO,4BAA4B,CAAC,CAAC;;AAErC;;;;;;;;IACA,MAAMC,UAAU,GAAGJ,GAAG,CAAC,IAAI,CAAC;IAC5B,MAAMK,WAAW,GAAGL,GAAG,CAAC,IAAI,CAAC;IAC7B,MAAM;MAACM,QAAQ;MAAEC,eAAe;MAAEC;IAAY,CAAC,GAAGN,WAAW,CAAC,CAAC;;IAE/D;IACA,MAAMO,OAAO,GAAGT,GAAG,CAAC,KAAK,CAAC;IAC1B,MAAMU,SAAS,GAAGV,GAAG,CAAC,KAAK,CAAC;;IAE5B;IACA,MAAMW,OAAO,GAAGX,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;;IAEzB;IACA,MAAMY,aAAa,GAAGZ,GAAG,CAAC;MACxBa,QAAQ,EAAE,IAAI;MAAE;MAChBC,QAAQ,EAAE,IAAI;MAAE;MAChBC,OAAO,EAAE,MAAM;MACfC,aAAa,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;MAAE;MACrCC,KAAK,EAAE,IAAI;MAAE;MACbC,QAAQ,EAAE,OAAO;MAAE;MACnBC,OAAO,EAAE,EAAE;MAAE;MACbC,MAAM,EAAE,oDAAoD,CAAE;IAChE,CAAC,CAAC;;IAEF;IACA,MAAMC,UAAU,GAAGA,CAAA,KAAM;MACvBT,aAAa,CAACU,KAAK,CAACH,OAAO,GAAG,CAC5B;QACEI,GAAG,EAAEZ,OAAO,CAACW,KAAK;QAAE;QACpBE,IAAI,EAAE,uBAAuB,CAAE;MACjC,CAAC,CACF;IACH,CAAC;;IAED;IACA,MAAMC,UAAU,GAAG,MAAAA,CAAA,KAAY;MAC7B,IAAIf,SAAS,CAACY,KAAK,EAAE;MAErB,IAAI;QACFb,OAAO,CAACa,KAAK,GAAG,IAAI;;QAEpB;QACAX,OAAO,CAACW,KAAK,GAAG,8BAA8BhB,QAAQ,CAACgB,KAAK,CAACI,MAAM,aAAa;;QAEhF;QACAL,UAAU,CAAC,CAAC;;QAEZ;QACA,MAAMM,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,qBAAqB,CAAC;QAC5DF,MAAM,CAACG,IAAI,CAAC,CAAC;QACbpB,SAAS,CAACY,KAAK,GAAG,IAAI;QAEtBS,OAAO,CAACC,GAAG,CAAC,UAAU,EAAErB,OAAO,CAACW,KAAK,CAAC;MACxC,CAAC,CAAC,OAAOW,KAAK,EAAE;QACdF,OAAO,CAACE,KAAK,CAAC,OAAO,EAAEA,KAAK,CAAC;MAC/B,CAAC,SAAS;QACRxB,OAAO,CAACa,KAAK,GAAG,KAAK;MACvB;IACF,CAAC;;IAED;IACA,MAAMY,UAAU,GAAGA,CAAA,KAAM;MACvB,IAAI,CAACxB,SAAS,CAACY,KAAK,EAAE;MAEtB,MAAMK,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,qBAAqB,CAAC;MAC5DF,MAAM,CAACQ,KAAK,CAAC,CAAC;MACdR,MAAM,CAACJ,GAAG,GAAG,EAAE,CAAC,CAAC;MACjBb,SAAS,CAACY,KAAK,GAAG,KAAK;MAEvBS,OAAO,CAACC,GAAG,CAAC,SAAS,CAAC;IACxB,CAAC;;IAED;IACA/B,SAAS,CAAC,YAAY;MACpBQ,OAAO,CAACa,KAAK,GAAG,IAAI;MACpB,MAAMf,eAAe,CAAC,CAAC;MACvB,MAAMC,YAAY,CAAC,CAAC;MACpBJ,UAAU,CAACkB,KAAK,CAACc,cAAc,CAAC,KAAK,CAAC;MACtC/B,WAAW,CAACiB,KAAK,CAACe,QAAQ,CAAC,KAAK,CAAC;MACjC5B,OAAO,CAACa,KAAK,GAAG,KAAK;IACvB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}