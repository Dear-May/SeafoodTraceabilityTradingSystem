{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { computed, onBeforeUnmount, onMounted, ref, watch } from 'vue';\nimport { ArrowDown, Plus } from \"@element-plus/icons-vue\";\nimport router from \"@/router\";\nimport axios from \"axios\";\nimport { useThemeStore } from \"@/store/themeStore\";\nimport { ElMessage } from \"element-plus\";\nimport FooterComponent from \"@/components/FooterComponent.vue\";\nimport RightWidgetComponent from \"@/components/RightWidgetComponent.vue\";\nimport useUser from \"@/composables/useUser\";\nexport default {\n  __name: 'SearchByImageView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const {\n      UserInfoForm,\n      initUserSession\n    } = useUser();\n    const themeStore = useThemeStore();\n    const isNightMode = computed(() => themeStore.isNightMode);\n    const searchQuery = ref('');\n    const searchCategory = ref('product');\n    const showImageSearchModal = ref(false);\n    const imageUploader = ref(null);\n    const isScrolled = ref(false);\n    const city = localStorage.getItem('city');\n    const weather = localStorage.getItem('weather');\n    const temperature = localStorage.getItem('temperature');\n    const handleScroll = () => {\n      isScrolled.value = window.scrollY > 200; // 当滚动超过 200px 时，改变搜索栏位置\n\n      // 判断是否到达底部并加载更多商品\n      if (loading_recommend.value) return; // 如果正在加载中，则不触发新的请求\n      const scrollHeight = document.documentElement.scrollHeight;\n      const scrollTop = window.scrollY;\n      const windowHeight = window.innerHeight;\n\n      // 判断是否到达底部\n      if (scrollTop + windowHeight >= scrollHeight - 200) {\n        if (recommendedProducts.value.length < total_recommend.value) {\n          initSearchProducts();\n        }\n      }\n    };\n    const handleImageUpload = (response, file) => {\n      console.log('Uploaded file:', file);\n    };\n    watch(isNightMode, newVal => {\n      if (newVal) {\n        document.body.classList.add('night-mode');\n      } else {\n        document.body.classList.remove('night-mode');\n      }\n    });\n    async function fetchWeather() {\n      try {\n        const response = await axios.post('/api/other/weather1', {\n          city: localStorage.getItem('city')\n        }, {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          withCredentials: true\n        });\n        if (response.data.weather !== null) {\n          localStorage.setItem('weather', response.data.weather);\n          localStorage.setItem('temperature', response.data.temperature);\n        } else {\n          localStorage.setItem('weather', \"晴\");\n          localStorage.setItem('temperature', \"25\");\n        }\n      } catch (err) {\n        localStorage.setItem('weather', \"晴\");\n        localStorage.setItem('temperature', \"25\");\n      }\n    }\n    const searchText = ref('');\n    const recommendedProducts = ref([]);\n    const originalProducts = ref([]);\n    const page_recommend = ref(1);\n    const pageSize = ref(40);\n    const total_recommend = ref(120);\n    const loading_recommend = ref(false); // 用于控制加载状态\n\n    function getKetWord() {\n      const urlParams = new URLSearchParams(window.location.search);\n      searchText.value = urlParams.get('token');\n    }\n    const minPrice = ref(null);\n    const maxPrice = ref(null);\n    const filterForm = {\n      minPrice: 0,\n      maxPrice: 0,\n      location: ''\n    };\n    const locations = ref([]);\n    function applyFilters() {\n      if (filterForm.minPrice === null && filterForm.maxPrice === null && filterForm.location === null) recommendedProducts.value = [...originalProducts.value];else {\n        if (filterForm.minPrice !== null && filterForm.maxPrice !== null) {\n          recommendedProducts.value = originalProducts.value.filter(good => {\n            return good.price >= filterForm.minPrice && good.price <= filterForm.maxPrice;\n          });\n        } else {\n          ElMessage.error('价格区间不能为空');\n          return;\n        }\n        if (filterForm.location !== null) {\n          recommendedProducts.value = originalProducts.value.filter(good => {\n            return good.location === filterForm.location;\n          });\n        }\n      }\n    }\n    async function initSearchProducts() {\n      if (loading_recommend.value) return; // 防止重复加载\n      loading_recommend.value = true; // 设置加载状态为 true，表示正在加载\n\n      try {\n        const response = await axios.post('/api/good/get-search-result', {\n          token: searchText.value,\n          page: page_recommend.value,\n          pageSize: pageSize.value\n        }, {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          withCredentials: true\n        });\n        console.log(response.data);\n        if (response.data !== null) {\n          response.data.forEach(good => {\n            recommendedProducts.value.push({\n              id: good.goodId,\n              name: good.goodName,\n              price: good.price,\n              image: good.showUrl,\n              commentCount: good.comments,\n              location: good.location\n            });\n            originalProducts.value = [...recommendedProducts.value];\n            if (!locations.value.includes(good.location)) {\n              locations.value.push(good.location);\n            }\n          });\n          page_recommend.value++;\n        }\n      } catch (error) {\n        ElMessage.error('获取推荐商品失败');\n      } finally {\n        loading_recommend.value = false; // 请求完成后重置加载状态\n      }\n    }\n    function searchProduct(searchText) {\n      window.location.href = '/search?searchText=' + searchText;\n    }\n    const setSearchCategory = category => {\n      searchCategory.value = category;\n    };\n    function handleTalk() {\n      router.push('/talk');\n    }\n    function handleLogin() {\n      router.push('/login');\n    }\n    function handleRegister() {\n      router.push('/register');\n    }\n    function handleMySpace() {\n      router.push('/mySpace');\n    }\n    const handleMyMessage = () => {\n      router.push('/talkToStore');\n    };\n    const handleGoodDetail = id => {\n      router.push('/goodDetail?id=' + id);\n    };\n    function logout() {\n      sessionStorage.removeItem('userBaseInfo');\n      //清除cookie\n      const cookies = document.cookie.split(\"; \");\n      for (let cookie of cookies) {\n        const eqPos = cookie.indexOf(\"=\");\n        const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;\n        document.cookie = name + \"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/\";\n      }\n      ElMessage.success('退出成功');\n      setTimeout(() => {\n        window.location.reload();\n      }, 1500);\n    }\n    const filedata = ref({\n      file: null,\n      url: null\n    });\n    const beforeUpload = async file => {\n      const isImage = file.type.startsWith('image/');\n      if (!isImage) {\n        ElMessage.error('请选择图片文件！');\n        return;\n      }\n      const isLt2M = file.size / 1024 / 1024 < 2; // 限制文件大小为 2MB\n      if (!isLt2M) {\n        ElMessage.error('图片大小不能超过 2MB！');\n        return;\n      }\n      filedata.value.file = file;\n      filedata.value.url = URL.createObjectURL(file);\n    };\n    async function handleImageSearch() {\n      if (filedata.value.file === null) {\n        ElMessage.error('请先上传图片！');\n        return;\n      }\n      const formData = new FormData();\n      formData.append('image', filedata.value.file);\n      try {\n        const response = await axios.post('/api/good/image-search', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          },\n          withCredentials: true\n        });\n        if (response.data.code === 200) {\n          await router.replace('/searchByImage?token=' + response.data.token);\n          window.location.reload();\n        } else ElMessage.error(\"图片搜索失败\");\n      } catch (error) {\n        ElMessage.error(\"图片搜索失败\");\n      }\n    }\n    onMounted(async () => {\n      //刷新界面\n      window.addEventListener('scroll', handleScroll);\n      getKetWord();\n      document.title = '海潮商城 - 图片搜索';\n      initUserSession();\n      await initSearchProducts();\n      await fetchWeather();\n    });\n    onBeforeUnmount(() => {\n      window.removeEventListener('scroll', handleScroll);\n    });\n    const __returned__ = {\n      UserInfoForm,\n      initUserSession,\n      themeStore,\n      isNightMode,\n      searchQuery,\n      searchCategory,\n      showImageSearchModal,\n      imageUploader,\n      isScrolled,\n      city,\n      weather,\n      temperature,\n      handleScroll,\n      handleImageUpload,\n      fetchWeather,\n      searchText,\n      recommendedProducts,\n      originalProducts,\n      page_recommend,\n      pageSize,\n      total_recommend,\n      loading_recommend,\n      getKetWord,\n      minPrice,\n      maxPrice,\n      filterForm,\n      locations,\n      applyFilters,\n      initSearchProducts,\n      searchProduct,\n      setSearchCategory,\n      handleTalk,\n      handleLogin,\n      handleRegister,\n      handleMySpace,\n      handleMyMessage,\n      handleGoodDetail,\n      logout,\n      filedata,\n      beforeUpload,\n      handleImageSearch,\n      computed,\n      onBeforeUnmount,\n      onMounted,\n      ref,\n      watch,\n      get ArrowDown() {\n        return ArrowDown;\n      },\n      get Plus() {\n        return Plus;\n      },\n      get router() {\n        return router;\n      },\n      get axios() {\n        return axios;\n      },\n      get useThemeStore() {\n        return useThemeStore;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      FooterComponent,\n      RightWidgetComponent,\n      get useUser() {\n        return useUser;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["computed","onBeforeUnmount","onMounted","ref","watch","ArrowDown","Plus","router","axios","useThemeStore","ElMessage","FooterComponent","RightWidgetComponent","useUser","UserInfoForm","initUserSession","themeStore","isNightMode","searchQuery","searchCategory","showImageSearchModal","imageUploader","isScrolled","city","localStorage","getItem","weather","temperature","handleScroll","value","window","scrollY","loading_recommend","scrollHeight","document","documentElement","scrollTop","windowHeight","innerHeight","recommendedProducts","length","total_recommend","initSearchProducts","handleImageUpload","response","file","console","log","newVal","body","classList","add","remove","fetchWeather","post","headers","withCredentials","data","setItem","err","searchText","originalProducts","page_recommend","pageSize","getKetWord","urlParams","URLSearchParams","location","search","get","minPrice","maxPrice","filterForm","locations","applyFilters","filter","good","price","error","token","page","forEach","push","id","goodId","name","goodName","image","showUrl","commentCount","comments","includes","searchProduct","href","setSearchCategory","category","handleTalk","handleLogin","handleRegister","handleMySpace","handleMyMessage","handleGoodDetail","logout","sessionStorage","removeItem","cookies","cookie","split","eqPos","indexOf","substr","success","setTimeout","reload","filedata","url","beforeUpload","isImage","type","startsWith","isLt2M","size","URL","createObjectURL","handleImageSearch","formData","FormData","append","code","replace","addEventListener","title","removeEventListener"],"sources":["D:/Cache/Java/shopping/shoppping_c_frontend/src/views/SearchByImageView.vue"],"sourcesContent":["<template>\r\n  <div class=\"homepage\" :class=\"{ 'night-mode': isNightMode }\">\r\n    <header class=\"p-3 mb-3 border-bottom header\">\r\n      <div class=\"container-fluid\">\r\n        <div class=\"row\">\r\n          <div class=\"col-2 d-flex align-items-center justify-content-start\">\r\n            <a href=\"/\" class=\"d-flex align-items-center mb-2 mb-lg-0 link-body-emphasis text-decoration-none\">\r\n              <img src=\"../images/logo.png\" alt=\"Bootstrap\" class=\"bi me-2\" width=\"50\" height=\"50\" role=\"img\"\r\n                   aria-label=\"Bootstrap\">\r\n            </a>\r\n            <nav class=\"nav\">\r\n              <a href=\"/\" class=\"nav-link px-2 link-secondary\">主页</a>\r\n              <a href=\"#\" class=\"nav-link px-2 link-body-emphasis\" @click=\"handleTalk\">讨论</a>\r\n            </nav>\r\n          </div>\r\n\r\n          <div class=\"col-6 d-flex align-items-center justify-content-center\" v-if=\"!isScrolled\">\r\n            <i class=\"bi bi-geo-alt-fill me-2\" style=\"font-size: 20px;\"></i>\r\n            <span>{{ city }}</span>\r\n            <i class=\"bi bi-cloud-sun-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='晴'\"></i>\r\n            <i class=\"bi bi-cloud-fog-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='阴'\"></i>\r\n            <i class=\"bi bi-cloud-rain-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='雨'\"></i>\r\n            <i class=\"bi bi-cloud-haze-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='雾'\"></i>\r\n            <i class=\"bi bi-cloud-sun-rain-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='多云'\"></i>\r\n            <i class=\"bi bi-cloud ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='霾'\"></i>\r\n            <div class=\"d-flex flex-column ms-2\">\r\n              <span>{{ weather }}</span>\r\n              <span>{{ temperature }}°C</span>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"col d-flex align-items-center justify-content-center\" v-if=\"isScrolled\">\r\n            <div class=\"search-bar\">\r\n              <el-dropdown>\r\n                <span class=\"el-dropdown-link search-select\">\r\n                  {{ searchCategory === 'product' ? '商品' : '商家' }}\r\n                  <el-icon class=\"el-icon-right\">\r\n                    <arrow-down/>\r\n                  </el-icon>\r\n                </span>\r\n                <template #dropdown>\r\n                  <el-dropdown-menu>\r\n                    <el-dropdown-item @click=\"setSearchCategory('product')\">商品</el-dropdown-item>\r\n                    <el-dropdown-item @click=\"setSearchCategory('store')\">商家</el-dropdown-item>\r\n                  </el-dropdown-menu>\r\n                </template>\r\n              </el-dropdown>\r\n              <el-input\r\n                  placeholder=\"京东搜索 商品/店铺/品牌\"\r\n                  v-model=\"searchQuery\"\r\n                  @keyup.enter=\"searchProduct(searchQuery)\"\r\n                  clearable\r\n                  class=\"search-input\"\r\n              />\r\n              <el-button type=\"primary\" icon=\"el-icon-search\" class=\"search-button\" @click=\"searchProduct(searchQuery)\">\r\n                搜索\r\n              </el-button>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"col-4 d-flex align-items-center justify-content-end\" style=\"margin-left: auto;\">\r\n            <template v-if=\"isScrolled\">\r\n              <div class=\"weather-info d-flex align-items-center\">\r\n                <i class=\"bi bi-geo-alt-fill me-2\" style=\"font-size: 20px;\"></i>\r\n                <span>{{ city }}</span>\r\n                <i class=\"bi bi-cloud-sun-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='晴'\"></i>\r\n                <i class=\"bi bi-cloud-fog-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='阴'\"></i>\r\n                <i class=\"bi bi-cloud-rain-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='雨'\"></i>\r\n                <i class=\"bi bi-cloud-haze-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='雾'\"></i>\r\n                <i class=\"bi bi-cloud-sun-rain-fill ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='多云'\"></i>\r\n                <i class=\"bi bi-cloud ms-4\" style=\"font-size: 20px;\" v-if=\"weather==='霾'\"></i>\r\n                <div class=\"d-flex flex-column ms-2\">\r\n                  <span>{{ weather }}</span>\r\n                  <span>{{ temperature }}°C</span>\r\n                </div>\r\n              </div>\r\n            </template>\r\n            <template v-if=\"UserInfoForm.id\">\r\n              <nav class=\"nav\">\r\n                <a href=\"#\" class=\"nav-link px-2 link-secondary\">主页</a>\r\n                <a href=\"#\" class=\"nav-link px-2 link-body-emphasis\" @click=\"handleTalk\">讨论</a>\r\n                <a href=\"#\" class=\"nav-link px-2 link-body-emphasis\" @click=\"handleTalk\">讨论</a>\r\n                <a href=\"#\" class=\"nav-link px-2 link-body-emphasis\" @click=\"handleTalk\">讨论</a>\r\n                <a href=\"#\" class=\"nav-link px-2 link-body-emphasis\" @click=\"handleTalk\">讨论</a>\r\n                <a href=\"#\" class=\"nav-link px-2 link-body-emphasis\" @click=\"handleTalk\">讨论</a>\r\n              </nav>\r\n              &nbsp;&nbsp;&nbsp;&nbsp;\r\n              <div class=\"dropdown text-end margin-right-10\">\r\n                <a href=\"#\" class=\"d-block link-body-emphasis text-decoration-none dropdown-toggle\"\r\n                   data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n                  <img :src=\"UserInfoForm.avatar\" alt=\"mdo\" width=\"40\" height=\"40\" class=\"rounded-circle\">\r\n                </a>\r\n                <ul class=\"dropdown-menu text-small\">\r\n                  <li><a class=\"dropdown-item\" @click=\"handleMySpace\">我的海潮</a></li>\r\n                  <el-badge :value=\"0\" class=\"item\">\r\n                    <li><a class=\"dropdown-item\" @click=\"handleMyMessage\">我的消息</a></li>\r\n                  </el-badge>\r\n                  <li><a class=\"dropdown-item\" href=\"#\">设置</a></li>\r\n                  <li>\r\n                    <hr class=\"dropdown-divider\">\r\n                  </li>\r\n                  <li><a class=\"dropdown-item\" @click=\"logout\">登出账号</a></li>\r\n                </ul>\r\n              </div>\r\n            </template>\r\n            <template v-else>\r\n              <el-button type=\"primary\" class=\"me-2 login-button\" @click=\"handleLogin\">登录</el-button>\r\n              <el-button type=\"primary\" class=\"register-button\" @click=\"handleRegister\">免费注册</el-button>\r\n            </template>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </header>\r\n\r\n    <div class=\"search-bar-section\" style=\"margin-top: 80px;\">\r\n      <div class=\"container\">\r\n        <div class=\"search-bar\">\r\n          <el-dropdown>\r\n            <span class=\"el-dropdown-link search-select\">\r\n              {{ searchCategory === 'product' ? '商品' : '商家' }}\r\n              <el-icon class=\"el-icon--right\">\r\n                <arrow-down/>\r\n              </el-icon>\r\n            </span>\r\n            <template #dropdown>\r\n              <el-dropdown-menu>\r\n                <el-dropdown-item @click=\"setSearchCategory('product')\">商品</el-dropdown-item>\r\n                <el-dropdown-item @click=\"setSearchCategory('store')\">商家</el-dropdown-item>\r\n              </el-dropdown-menu>\r\n            </template>\r\n          </el-dropdown>\r\n          <el-input\r\n              placeholder=\"京东搜索 商品/店铺/品牌\"\r\n              v-model=\"searchQuery\"\r\n              @keyup.enter=\"searchProduct(searchQuery)\"\r\n              clearable\r\n              class=\"search-input\"\r\n          >\r\n            <template #append>\r\n              <el-button @click=\"showImageSearchModal = true\" style=\"background-color: transparent;\">\r\n                <i class=\"bi bi-camera-fill\" style=\"font-size: 20px\"></i>\r\n              </el-button>\r\n              <el-dialog v-model=\"showImageSearchModal\" title=\"按图片搜索\" width=\"30%\">\r\n                <div class=\"upload-container\">\r\n                  <el-upload\r\n                      class=\"avatar-uploader\"\r\n                      :show-file-list=\"false\"\r\n                      :before-upload=\"beforeUpload\"\r\n                  >\r\n                    <el-image v-if=\"filedata.url\" :src=\"filedata.url\" class=\"avatar\" style=\"border-radius: 5px;\"\r\n                              :preview-src-list=\"[filedata.url]\"/>\r\n                    <el-icon v-else class=\"avatar-uploader-icon\">\r\n                      <Plus/>\r\n                    </el-icon>\r\n                  </el-upload>\r\n                  <el-button type=\"primary\" @click=\"handleImageSearch\">搜索</el-button>\r\n                </div>\r\n              </el-dialog>\r\n            </template>\r\n\r\n          </el-input>\r\n          <el-button type=\"primary\" icon=\"el-icon-search\" class=\"search-button\" @click=\"searchProduct(searchQuery)\">\r\n            搜索\r\n          </el-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <el-container>\r\n      <el-main>\r\n        <div class=\"filter-section\">\r\n          <el-form :inline=\"true\" :model=\"filterForm\" class=\"filter-form\">\r\n            <el-form-item label=\"价格区间\">\r\n              <el-input-number v-model=\"minPrice\" placeholder=\"最小价格\" @change=\"filterForm.minPrice = minPrice\"/>\r\n              <el-input-number v-model=\"maxPrice\" placeholder=\"最大价格\" @change=\"filterForm.maxPrice = maxPrice\"/>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"发货地\">\r\n              <el-select v-model=\"filterForm.location\" placeholder=\"选择发货地\" style=\"width: 150px;\">\r\n                <el-option\r\n                    v-for=\"loc in locations\"\r\n                    :key=\"loc\"\r\n                    :label=\"loc\"\r\n                    :value=\"loc\"\r\n                    @click=\"filterForm.location = loc\"\r\n                />\r\n              </el-select>\r\n            </el-form-item>\r\n\r\n            <el-form-item>\r\n              <el-button type=\"primary\" @click=\"applyFilters\">筛选</el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        </div>\r\n\r\n        <section class=\"recommendation-section\">\r\n          <div class=\"tab-content\">\r\n            <div>\r\n              <el-row :gutter=\"20\">\r\n                <el-col :span=\"4\" v-for=\"product in recommendedProducts\" :key=\"product.id\">\r\n                  <el-tooltip\r\n                      class=\"box-item\"\r\n                      effect=\"dark\"\r\n                      :content=\"product.name\"\r\n                      placement=\"right\"\r\n                  >\r\n                    <el-card shadow=\"hover\" class=\"product-card\" @click=\"handleGoodDetail(product.id)\">\r\n                      <img :src=\"product.image\" class=\"product-image\" alt=\"Product Image\">\r\n                      <div class=\"product-info\">\r\n                        <p v-if=\"product.name.length < 10\">{{ product.name }}</p>\r\n                        <p v-else>{{ product.name.slice(0, 10) }}...</p>\r\n                        <h4 class=\"product-price\">￥{{ product.price }}</h4>\r\n                        <div class=\"row\">\r\n                          <div class=\"col-6\">\r\n                            <p style=\"color: #999; font-size: 14px;\" v-if=\"product.commentCount>=100\">\r\n                              {{ product.commentCount }}+人评价</p>\r\n                            <p style=\"color: #999; font-size: 14px;\" v-else>{{\r\n                                product.commentCount\r\n                              }}人评价</p>\r\n                          </div>\r\n                          <div class=\"col-6\">\r\n                            <p style=\"color: #999; font-size: 14px;\">{{ product.location }}</p>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </el-card>\r\n                  </el-tooltip>\r\n                </el-col>\r\n              </el-row>\r\n            </div>\r\n          </div>\r\n\r\n        </section>\r\n      </el-main>\r\n    </el-container>\r\n    <RightWidgetComponent/>\r\n    <FooterComponent/>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {computed, onBeforeUnmount, onMounted, ref, watch} from 'vue';\r\nimport {ArrowDown, Plus} from \"@element-plus/icons-vue\";\r\nimport router from \"@/router\";\r\nimport axios from \"axios\";\r\nimport {useThemeStore} from \"@/store/themeStore\";\r\nimport {ElMessage} from \"element-plus\";\r\nimport FooterComponent from \"@/components/FooterComponent.vue\";\r\nimport RightWidgetComponent from \"@/components/RightWidgetComponent.vue\";\r\nimport useUser from \"@/composables/useUser\";\r\n\r\nconst {UserInfoForm, initUserSession} = useUser()\r\n\r\nconst themeStore = useThemeStore();\r\nconst isNightMode = computed(() => themeStore.isNightMode);\r\nconst searchQuery = ref('');\r\nconst searchCategory = ref('product');\r\nconst showImageSearchModal = ref(false);\r\nconst imageUploader = ref(null);\r\nconst isScrolled = ref(false);\r\nconst city = localStorage.getItem('city');\r\nconst weather = localStorage.getItem('weather');\r\nconst temperature = localStorage.getItem('temperature');\r\nconst handleScroll = () => {\r\n  isScrolled.value = window.scrollY > 200; // 当滚动超过 200px 时，改变搜索栏位置\r\n\r\n  // 判断是否到达底部并加载更多商品\r\n  if (loading_recommend.value) return; // 如果正在加载中，则不触发新的请求\r\n  const scrollHeight = document.documentElement.scrollHeight;\r\n  const scrollTop = window.scrollY;\r\n  const windowHeight = window.innerHeight;\r\n\r\n  // 判断是否到达底部\r\n  if (scrollTop + windowHeight >= scrollHeight - 200) {\r\n    if (recommendedProducts.value.length < total_recommend.value) {\r\n      initSearchProducts();\r\n    }\r\n  }\r\n};\r\n\r\nconst handleImageUpload = (response, file) => {\r\n  console.log('Uploaded file:', file);\r\n};\r\n\r\nwatch(isNightMode, (newVal) => {\r\n  if (newVal) {\r\n    document.body.classList.add('night-mode');\r\n  } else {\r\n    document.body.classList.remove('night-mode');\r\n  }\r\n});\r\n\r\nasync function fetchWeather() {\r\n  try {\r\n    const response = await axios.post('/api/other/weather1', {\r\n      city: localStorage.getItem('city'),\r\n    }, {\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.weather !== null) {\r\n      localStorage.setItem('weather', response.data.weather);\r\n      localStorage.setItem('temperature', response.data.temperature);\r\n    } else {\r\n      localStorage.setItem('weather', \"晴\");\r\n      localStorage.setItem('temperature', \"25\");\r\n    }\r\n  } catch (err) {\r\n    localStorage.setItem('weather', \"晴\");\r\n    localStorage.setItem('temperature', \"25\");\r\n  }\r\n}\r\n\r\nconst searchText = ref('');\r\nconst recommendedProducts = ref([]);\r\nconst originalProducts = ref([]);\r\nconst page_recommend = ref(1);\r\nconst pageSize = ref(40);\r\nconst total_recommend = ref(120);\r\nconst loading_recommend = ref(false); // 用于控制加载状态\r\n\r\nfunction getKetWord() {\r\n  const urlParams = new URLSearchParams(window.location.search);\r\n  searchText.value = urlParams.get('token');\r\n}\r\n\r\nconst minPrice = ref(null);\r\nconst maxPrice = ref(null);\r\nconst filterForm = {\r\n  minPrice: 0,\r\n  maxPrice: 0,\r\n  location: '',\r\n};\r\nconst locations = ref([]);\r\n\r\nfunction applyFilters() {\r\n  if (filterForm.minPrice === null && filterForm.maxPrice === null && filterForm.location === null)\r\n    recommendedProducts.value = [...originalProducts.value];\r\n  else {\r\n    if (filterForm.minPrice !== null && filterForm.maxPrice !== null) {\r\n      recommendedProducts.value = originalProducts.value.filter(good => {\r\n        return good.price >= filterForm.minPrice && good.price <= filterForm.maxPrice;\r\n      });\r\n    } else {\r\n      ElMessage.error('价格区间不能为空');\r\n      return;\r\n    }\r\n    if (filterForm.location !== null) {\r\n      recommendedProducts.value = originalProducts.value.filter(good => {\r\n        return good.location === filterForm.location;\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nasync function initSearchProducts() {\r\n  if (loading_recommend.value) return; // 防止重复加载\r\n  loading_recommend.value = true; // 设置加载状态为 true，表示正在加载\r\n\r\n  try {\r\n    const response = await axios.post('/api/good/get-search-result', {\r\n      token: searchText.value,\r\n      page: page_recommend.value,\r\n      pageSize: pageSize.value,\r\n    }, {\r\n      headers: {'Content-Type': 'application/json'},\r\n      withCredentials: true\r\n    });\r\n    console.log(response.data);\r\n    if (response.data !== null) {\r\n      response.data.forEach(good => {\r\n        recommendedProducts.value.push({\r\n          id: good.goodId,\r\n          name: good.goodName,\r\n          price: good.price,\r\n          image: good.showUrl,\r\n          commentCount: good.comments,\r\n          location: good.location\r\n        });\r\n        originalProducts.value = [...recommendedProducts.value];\r\n        if (!locations.value.includes(good.location)) {\r\n          locations.value.push(good.location);\r\n        }\r\n      });\r\n      page_recommend.value++;\r\n    }\r\n  } catch (error) {\r\n    ElMessage.error('获取推荐商品失败');\r\n  } finally {\r\n    loading_recommend.value = false; // 请求完成后重置加载状态\r\n  }\r\n}\r\n\r\nfunction searchProduct(searchText) {\r\n  window.location.href = '/search?searchText=' + searchText;\r\n}\r\n\r\nconst setSearchCategory = (category) => {\r\n  searchCategory.value = category;\r\n};\r\n\r\nfunction handleTalk() {\r\n  router.push('/talk');\r\n}\r\n\r\nfunction handleLogin() {\r\n  router.push('/login');\r\n}\r\n\r\nfunction handleRegister() {\r\n  router.push('/register');\r\n}\r\n\r\nfunction handleMySpace() {\r\n  router.push('/mySpace');\r\n}\r\n\r\nconst handleMyMessage = () => {\r\n  router.push('/talkToStore');\r\n}\r\n\r\nconst handleGoodDetail = (id) => {\r\n  router.push('/goodDetail?id=' + id);\r\n}\r\n\r\nfunction logout() {\r\n  sessionStorage.removeItem('userBaseInfo');\r\n  //清除cookie\r\n  const cookies = document.cookie.split(\"; \");\r\n  for (let cookie of cookies) {\r\n    const eqPos = cookie.indexOf(\"=\");\r\n    const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;\r\n    document.cookie = name + \"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/\";\r\n  }\r\n  ElMessage.success('退出成功');\r\n  setTimeout(() => {\r\n    window.location.reload();\r\n  }, 1500);\r\n}\r\n\r\nconst filedata = ref({\r\n  file: null,\r\n  url: null,\r\n})\r\nconst beforeUpload = async (file) => {\r\n  const isImage = file.type.startsWith('image/');\r\n  if (!isImage) {\r\n    ElMessage.error('请选择图片文件！');\r\n    return;\r\n  }\r\n  const isLt2M = file.size / 1024 / 1024 < 2;  // 限制文件大小为 2MB\r\n  if (!isLt2M) {\r\n    ElMessage.error('图片大小不能超过 2MB！');\r\n    return;\r\n  }\r\n  filedata.value.file = file;\r\n  filedata.value.url = URL.createObjectURL(file);\r\n};\r\n\r\nasync function handleImageSearch() {\r\n  if (filedata.value.file === null) {\r\n    ElMessage.error('请先上传图片！');\r\n    return;\r\n  }\r\n  const formData = new FormData();\r\n  formData.append('image', filedata.value.file);\r\n  try {\r\n    const response = await axios.post('/api/good/image-search', formData, {\r\n      headers: {\r\n        'Content-Type': 'multipart/form-data'\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.code === 200) {\r\n      await router.replace('/searchByImage?token=' + response.data.token)\r\n      window.location.reload();\r\n    } else\r\n      ElMessage.error(\"图片搜索失败\");\r\n  } catch (error) {\r\n    ElMessage.error(\"图片搜索失败\");\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  //刷新界面\r\n  window.addEventListener('scroll', handleScroll);\r\n  getKetWord();\r\n  document.title = '海潮商城 - 图片搜索';\r\n  initUserSession();\r\n  await initSearchProducts();\r\n  await fetchWeather();\r\n});\r\n\r\n\r\nonBeforeUnmount(() => {\r\n  window.removeEventListener('scroll', handleScroll);\r\n});\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.homepage {\r\n  font-family: Arial, sans-serif;\r\n  background-color: #f5f5f5;\r\n}\r\n\r\n.header {\r\n  position: fixed;\r\n  top: 0;\r\n  width: 100%;\r\n  z-index: 1001;\r\n  background-color: #ffffff; // 设置背景色确保内容可见\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); // 添加阴影使其更明显\r\n  transition: all 0.3s ease; // 添加过渡效果\r\n}\r\n\r\n.weather-info {\r\n  margin-right: 20px; // 给天气信息留些间距\r\n}\r\n\r\n.p-3 {\r\n  padding: 1rem;\r\n}\r\n\r\n.mb-3 {\r\n  margin-bottom: 1rem;\r\n}\r\n\r\n.border-bottom {\r\n  border-bottom: 1px solid #eaeaea;\r\n}\r\n\r\n.login-button {\r\n  background-color: #007bff; // 按钮背景颜色\r\n  border-radius: 20px; // 边框圆角\r\n  padding: 10px 20px; // 内边距\r\n  font-weight: bold; // 字体加粗\r\n  font-size: 16px;\r\n  color: #ffffff; // 字体颜色\r\n  transition: background-color 0.3s ease; // 背景颜色渐变效果\r\n}\r\n\r\n.login-button:hover {\r\n  background-color: #0056b3; // 悬停时的背景颜色\r\n}\r\n\r\n.register-button {\r\n  background-color: #96CDCD; // 按钮背景颜色\r\n  border: 2px solid #96CDCD;\r\n  border-radius: 20px; // 边框圆角\r\n  padding: 10px 20px; // 内边距\r\n  font-weight: bold; // 字体加粗\r\n  font-size: 16px;\r\n  color: #ffffff; // 字体颜色\r\n  transition: background-color 0.3s ease; // 背景颜色渐变效果\r\n}\r\n\r\n.register-button:hover {\r\n  border-color: #668B8B;\r\n  background-color: #668B8B; // 悬停时的背景颜色\r\n}\r\n\r\n.container {\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.search-bar-section {\r\n  padding: 30px 0;\r\n  background-color: #ffffff;\r\n  text-align: center;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.search-bar {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  max-width: 800px;\r\n  width: 100%;\r\n  border: 2px solid #e02020;\r\n  border-radius: 50px;\r\n  overflow: hidden;\r\n}\r\n\r\n.search-select {\r\n  cursor: pointer;\r\n  padding: 0 15px;\r\n  display: flex;\r\n  align-items: center;\r\n  border-right: 1px solid #e02020;\r\n  background-color: transparent;\r\n  font-size: 16px;\r\n}\r\n\r\n.search-input {\r\n  flex: 1;\r\n  border: none;\r\n  outline: none;\r\n  height: 50px;\r\n  font-size: 16px;\r\n  box-shadow: none;\r\n  background-color: transparent;\r\n}\r\n\r\n.search-button {\r\n  height: 50px;\r\n  background-color: #e02020;\r\n  color: #ffffff;\r\n  border: none;\r\n  border-radius: 0;\r\n  padding: 0 30px;\r\n  font-size: 16px;\r\n}\r\n\r\n.camera-icon {\r\n  background-color: transparent;\r\n  color: #e02020;\r\n  border: none;\r\n}\r\n\r\n.vanta-carousel {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 400px;\r\n}\r\n\r\n.carousel {\r\n  position: relative;\r\n  z-index: 1;\r\n}\r\n\r\n.carousel-image {\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: cover;\r\n}\r\n\r\n.subcategory-popup {\r\n  position: absolute;\r\n  z-index: 1000;\r\n  width: 35%;\r\n  height: 60.3%;\r\n  padding: 10px;\r\n  background: #fff;\r\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\r\n  transition: opacity 0.3s ease;\r\n  opacity: 0.9;\r\n}\r\n\r\n.subcategory-details {\r\n  font-size: 14px;\r\n  color: #555;\r\n}\r\n\r\n.subcategory-links {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 10px;\r\n  margin-top: 10px;\r\n  max-width: 800px; // 限制最大宽度，每行最多放置 10 个子类别链接\r\n}\r\n\r\n.subcategory-links a {\r\n  font-size: 16px;\r\n  color: #808080;\r\n  text-decoration: none;\r\n  transition: color 0.3s ease;\r\n}\r\n\r\n.subcategory-links a:hover {\r\n  color: #e02020 !important;\r\n}\r\n\r\n.recommended-section {\r\n  margin-top: 20px;\r\n  background-color: #ffffff;\r\n  padding: 20px;\r\n  border-radius: 5px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.tab-navigation {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin: 20px 0;\r\n  border-bottom: 1px solid #eaeaea;\r\n}\r\n\r\n.tab-navigation-item {\r\n  display: flex;\r\n  align-items: center;\r\n  cursor: pointer;\r\n  padding: 10px 20px;\r\n  transition: background-color 0.3s ease;\r\n}\r\n\r\n.tab-navigation-item .tab-icon {\r\n  font-size: 30px;\r\n  color: #e02020;\r\n  margin-right: 10px;\r\n}\r\n\r\n.tab-navigation-item .tab-label {\r\n  color: #333;\r\n  font-weight: normal;\r\n}\r\n\r\n.tab-navigation-item.active .tab-label {\r\n  color: #e02020;\r\n  font-weight: bold;\r\n}\r\n\r\n.tab-navigation-item:hover .tab-label {\r\n  color: #e02020;\r\n}\r\n\r\n.tab-content {\r\n  margin-top: 20px;\r\n}\r\n\r\n.recommendation-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.product-card {\r\n  cursor: pointer;\r\n  margin-bottom: 30px;\r\n  border-radius: 10px;\r\n  height: 400px;\r\n}\r\n\r\n.product-card:hover {\r\n  border-color: #e02020;\r\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.product-image {\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: contain;\r\n}\r\n\r\n.product-info {\r\n  margin-top: 10px;\r\n  text-align: center;\r\n}\r\n\r\n.product-price {\r\n  color: #e02020;\r\n  font-weight: bold;\r\n}\r\n\r\n.right-widget {\r\n  position: fixed;\r\n  right: 0;\r\n  top: 30%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  background-color: #ffffff;\r\n  padding: 10px;\r\n  border-radius: 10px 0 0 10px;\r\n  box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);\r\n  z-index: 1000;\r\n}\r\n\r\n.right-widget .el-button {\r\n  margin-bottom: 15px;\r\n  color: #333;\r\n}\r\n\r\n.right-widget .el-button:hover {\r\n  color: #e02020;\r\n}\r\n\r\n.night-mode {\r\n  background-color: #121212;\r\n  color: #ffffff;\r\n}\r\n\r\n.night-mode .header {\r\n  background-color: #1f1f1f;\r\n  border-color: #333;\r\n}\r\n\r\n.night-mode .search-bar-section {\r\n  background-color: #1f1f1f;\r\n  box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);\r\n}\r\n\r\n.night-mode .el-menu {\r\n  background-color: #1f1f1f;\r\n  border-color: #333;\r\n  color: #d3d3d3;\r\n}\r\n\r\n.night-mode .category-sidebar {\r\n  background-color: #1f1f1f;\r\n  border-right: 1px solid #333;\r\n}\r\n\r\n.night-mode .subcategory-popup {\r\n  background-color: #1f1f1f;\r\n  color: #d3d3d3;\r\n}\r\n\r\n.night-mode .vanta-carousel {\r\n  filter: brightness(0.8);\r\n}\r\n\r\n.night-mode .recommendation-section {\r\n  background-color: #1f1f1f;\r\n  color: #ffffff;\r\n}\r\n\r\n.night-mode .el-card {\r\n  background-color: #1f1f1f;\r\n  color: #ffffff;\r\n}\r\n\r\n.night-mode .right-widget {\r\n  background-color: #1f1f1f;\r\n  color: #ffffff;\r\n}\r\n\r\n.night-mode .right-widget.i {\r\n  background-color: #1f1f1f;\r\n  color: #ffffff;\r\n}\r\n\r\n.night-mode .footer {\r\n  background-color: #1f1f1f;\r\n  border-top: 1px solid #333;\r\n}\r\n\r\n.night-mode .footer-links a {\r\n  color: #ffffff;\r\n}\r\n\r\n.night-mode .footer-links a:hover {\r\n  color: #e02020;\r\n}\r\n\r\n.el-tooltip__trigger:focus-visible {\r\n  outline: unset;\r\n}\r\n\r\n.avatar-uploader .el-upload {\r\n  border: 1px dashed var(--el-border-color);\r\n  border-radius: 6px;\r\n  cursor: pointer;\r\n  position: relative;\r\n  overflow: hidden;\r\n  transition: var(--el-transition-duration-fast);\r\n}\r\n\r\n.avatar-uploader .el-upload:hover {\r\n  border-color: var(--el-color-primary);\r\n}\r\n\r\n.el-icon.avatar-uploader-icon {\r\n  font-size: 28px;\r\n  color: #8c939d;\r\n  width: 178px;\r\n  height: 178px;\r\n  text-align: center;\r\n}\r\n\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}