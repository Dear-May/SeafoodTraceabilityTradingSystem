{"ast":null,"code":"import { onMounted, ref } from 'vue';\nimport provincesData from '@/assets/province.json';\nimport citiesData from '@/assets/city.json';\nimport areasData from '@/assets/area.json';\nimport streetsData from '@/assets/street.json';\nimport { ElMessage } from \"element-plus\";\nimport axios from \"axios\";\nimport useUser from \"@/composables/useUser\";\nexport default {\n  __name: 'AddAddressComponent',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const showAddAddressDialog = ref(false);\n    const selectedAddress = ref([]);\n    const detailedAddress = ref('');\n    const consignee = ref('');\n    const phoneNumber = ref('');\n    const setAsDefault = ref(false);\n    const detailedAddressError = ref(false);\n    const consigneeError = ref(false);\n    const phoneNumberError = ref(false);\n    const addressOptions = ref([]);\n    const {\n      UserInfoForm,\n      initUserSession\n    } = useUser();\n    const loadAddressOptions = () => {\n      addressOptions.value = provincesData.map(province => ({\n        value: province.id,\n        label: province.name,\n        children: (citiesData[province.id] || []).map(city => ({\n          value: city.id,\n          label: city.name,\n          children: (areasData[city.id] || []).map(area => ({\n            value: area.id,\n            label: area.name,\n            children: (streetsData[area.id] || []).map(street => ({\n              value: street.id,\n              label: street.name\n            }))\n          }))\n        }))\n      }));\n    };\n    const handleAddressChange = value => {\n      console.log('Selected address:', value);\n    };\n    async function saveAddress() {\n      detailedAddressError.value = !detailedAddress.value;\n      consigneeError.value = !consignee.value;\n      phoneNumberError.value = !phoneNumber.value;\n      if (detailedAddressError.value || consigneeError.value || phoneNumberError.value || !selectedAddress.value.length) {\n        return;\n      }\n      console.log(selectedAddress.value);\n      try {\n        const response = await axios.post('/api/addresses/addAddress', {\n          userId: UserInfoForm.value.id,\n          consignee: consignee.value,\n          phone: \"86-\" + phoneNumber.value,\n          area: selectedAddress.value.join(' '),\n          detailed_address: detailedAddress.value,\n          is_default: setAsDefault.value\n        }, {\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          withCredentials: true\n        });\n        if (response.status === 200) {\n          ElMessage.success(\"添加地址成功\");\n          setTimeout(() => {\n            window.location.reload();\n          }, 500);\n        } else {\n          ElMessage.error(\"添加地址失败\");\n        }\n      } catch (e) {\n        ElMessage.error(\"添加地址失败\");\n      } finally {\n        showAddAddressDialog.value = false;\n      }\n    }\n    function clearForm() {\n      detailedAddress.value = '';\n      consignee.value = '';\n      phoneNumber.value = '';\n      setAsDefault.value = false;\n      detailedAddressError.value = false;\n      consigneeError.value = false;\n      phoneNumberError.value = false;\n      selectedAddress.value = [];\n      setAsDefault.value = false;\n      showAddAddressDialog.value = false;\n    }\n    onMounted(() => {\n      initUserSession();\n      loadAddressOptions();\n    });\n    const __returned__ = {\n      showAddAddressDialog,\n      selectedAddress,\n      detailedAddress,\n      consignee,\n      phoneNumber,\n      setAsDefault,\n      detailedAddressError,\n      consigneeError,\n      phoneNumberError,\n      addressOptions,\n      UserInfoForm,\n      initUserSession,\n      loadAddressOptions,\n      handleAddressChange,\n      saveAddress,\n      clearForm,\n      onMounted,\n      ref,\n      get provincesData() {\n        return provincesData;\n      },\n      get citiesData() {\n        return citiesData;\n      },\n      get areasData() {\n        return areasData;\n      },\n      get streetsData() {\n        return streetsData;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get axios() {\n        return axios;\n      },\n      get useUser() {\n        return useUser;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["onMounted","ref","provincesData","citiesData","areasData","streetsData","ElMessage","axios","useUser","showAddAddressDialog","selectedAddress","detailedAddress","consignee","phoneNumber","setAsDefault","detailedAddressError","consigneeError","phoneNumberError","addressOptions","UserInfoForm","initUserSession","loadAddressOptions","value","map","province","id","label","name","children","city","area","street","handleAddressChange","console","log","saveAddress","length","response","post","userId","phone","join","detailed_address","is_default","headers","withCredentials","status","success","setTimeout","window","location","reload","error","e","clearForm"],"sources":["D:/Cache/Java/shopping/shoppping_c_frontend/src/components/AddAddressComponent.vue"],"sourcesContent":["<template>\r\n  <el-button type=\"primary\" style=\"background-color: #e02020; border-color: #e02020; margin-bottom: 20px;\"\r\n             @click=\"showAddAddressDialog = true\">\r\n    添加收货地址\r\n  </el-button>\r\n\r\n  <el-dialog v-model=\"showAddAddressDialog\" title=\"添加收货地址\" width=\"700px\" align-center\r\n             style=\"border-radius: 20px;\">\r\n    <div class=\"address-form\">\r\n      <div class=\"row\">\r\n        <label for=\"details\" class=\"form-label col-5 mt-2\" style=\"align-items: center;\">\r\n          <a style=\"color: #e02020;\">*&nbsp;&nbsp;</a> 详细地址：</label>\r\n        <el-cascader class=\"col-7\" v-model=\"selectedAddress\" :options=\"addressOptions\" placeholder=\"请选择省/市/区/街道\"\r\n                     style=\"width: 55%; margin-bottom: 20px;\" @change=\"handleAddressChange\"/>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <div class=\"row\">\r\n          <label for=\"details\" class=\"form-label col-5 mt-3\">\r\n            <a style=\"color: #e02020;\">*&nbsp;&nbsp;</a>\r\n            详细地址：</label>\r\n          <el-input v-model=\"detailedAddress\" type=\"textarea\" class=\"col-8\"\r\n                    placeholder=\"请输入详细地址，详细地址长度需要在2-120个汉字或字符，不能包含特殊字符\" maxlength=\"120\"\r\n                    show-word-limit style=\"width: 55%;\"/>\r\n        </div>\r\n        <span class=\"error-message\"\r\n              v-if=\"detailedAddressError\">详细地址长度需要在2-120个汉字或字符，不能包含特殊字符</span>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <div class=\"row\">\r\n          <label for=\"consignee\" class=\"form-label col-5 mt-3\">\r\n            <a style=\"color: #e02020;\">*&nbsp;&nbsp;</a>\r\n            收货人姓名：</label>\r\n          <el-input v-model=\"consignee\" placeholder=\"长度不超过25个字符，不能包含特殊字符\" maxlength=\"25\"\r\n                    style=\"width: 55%;\" class=\"col-7\"/>\r\n        </div>\r\n        <span class=\"error-message\"\r\n              v-if=\"consigneeError\">收货人姓名长度需要在1-25个汉字或字符之间，不能包含特殊字符</span>\r\n      </div>\r\n      <div class=\"form-group\">\r\n        <div class=\"row\">\r\n          <label for=\"phone\" class=\"form-label col-5 mt-3\">\r\n            <a style=\"color: #e02020;\">*&nbsp;&nbsp;</a>\r\n            手机号：</label>\r\n          <el-input v-model=\"phoneNumber\" placeholder=\"手机号必须填写一项，手机号码不能包含空格\" maxlength=\"11\"\r\n                    style=\"width: 50%;\" class=\"col-7\"/>\r\n        </div>\r\n        <span class=\"error-message\" v-if=\"phoneNumberError\">手机号码不能为空</span>\r\n      </div>\r\n      <el-checkbox v-model=\"setAsDefault\" style=\"margin-top: 20px;\">设置为默认收货地址</el-checkbox>\r\n    </div>\r\n    <template #footer>\r\n      <div class=\"dialog-footer\">\r\n        <el-button @click=\"clearForm\" class=\"cancel-button\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"saveAddress\" class=\"confirm-button\">确认</el-button>\r\n      </div>\r\n    </template>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script setup>\r\nimport {onMounted, ref} from 'vue';\r\nimport provincesData from '@/assets/province.json';\r\nimport citiesData from '@/assets/city.json';\r\nimport areasData from '@/assets/area.json';\r\nimport streetsData from '@/assets/street.json';\r\nimport {ElMessage} from \"element-plus\";\r\nimport axios from \"axios\";\r\nimport useUser from \"@/composables/useUser\";\r\n\r\nconst showAddAddressDialog = ref(false);\r\nconst selectedAddress = ref([]);\r\nconst detailedAddress = ref('');\r\nconst consignee = ref('');\r\nconst phoneNumber = ref('');\r\nconst setAsDefault = ref(false);\r\n\r\nconst detailedAddressError = ref(false);\r\nconst consigneeError = ref(false);\r\nconst phoneNumberError = ref(false);\r\n\r\nconst addressOptions = ref([]);\r\n\r\nconst {UserInfoForm, initUserSession} = useUser()\r\n\r\nconst loadAddressOptions = () => {\r\n  addressOptions.value = provincesData.map(province => ({\r\n    value: province.id,\r\n    label: province.name,\r\n    children: (citiesData[province.id] || []).map(city => ({\r\n      value: city.id,\r\n      label: city.name,\r\n      children: (areasData[city.id] || []).map(area => ({\r\n        value: area.id,\r\n        label: area.name,\r\n        children: (streetsData[area.id] || []).map(street => ({\r\n          value: street.id,\r\n          label: street.name,\r\n        }))\r\n      }))\r\n    }))\r\n  }));\r\n};\r\n\r\nconst handleAddressChange = (value) => {\r\n  console.log('Selected address:', value);\r\n};\r\n\r\nasync function saveAddress() {\r\n  detailedAddressError.value = !detailedAddress.value;\r\n  consigneeError.value = !consignee.value;\r\n  phoneNumberError.value = !phoneNumber.value;\r\n\r\n  if (detailedAddressError.value || consigneeError.value || phoneNumberError.value || !selectedAddress.value.length) {\r\n    return;\r\n  }\r\n  console.log(selectedAddress.value)\r\n  try {\r\n    const response = await axios.post('/api/addresses/addAddress', {\r\n      userId: UserInfoForm.value.id,\r\n      consignee: consignee.value,\r\n      phone: \"86-\" + phoneNumber.value,\r\n      area: selectedAddress.value.join(' '),\r\n      detailed_address: detailedAddress.value,\r\n      is_default: setAsDefault.value,\r\n    }, {\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      withCredentials: true,\r\n    })\r\n    if (response.status === 200) {\r\n      ElMessage.success(\"添加地址成功\");\r\n      setTimeout(() => {\r\n        window.location.reload();\r\n      }, 500);\r\n    } else {\r\n      ElMessage.error(\"添加地址失败\");\r\n    }\r\n  } catch (e) {\r\n    ElMessage.error(\"添加地址失败\");\r\n  } finally {\r\n    showAddAddressDialog.value = false;\r\n  }\r\n}\r\n\r\nfunction clearForm() {\r\n  detailedAddress.value = '';\r\n  consignee.value = '';\r\n  phoneNumber.value = '';\r\n  setAsDefault.value = false;\r\n  detailedAddressError.value = false;\r\n  consigneeError.value = false;\r\n  phoneNumberError.value = false;\r\n  selectedAddress.value = [];\r\n  setAsDefault.value = false;\r\n  showAddAddressDialog.value = false;\r\n}\r\n\r\nonMounted(() => {\r\n  initUserSession()\r\n  loadAddressOptions()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.address-form {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 20px;\r\n  padding: 20px;\r\n  background-color: #f9f9f9;\r\n  border-radius: 8px;\r\n}\r\n\r\n.form-group {\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.form-label {\r\n  font-weight: bold;\r\n  margin-bottom: 8px;\r\n  color: #333;\r\n}\r\n\r\n.dialog-footer {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 20px;\r\n}\r\n\r\n.error-message {\r\n  color: #e02020;\r\n  font-size: 13px;\r\n  margin-top: 5px;\r\n}\r\n\r\n.cancel-button {\r\n  color: #e02020;\r\n  font-weight: bold;\r\n}\r\n\r\n.confirm-button {\r\n  background-color: #e02020;\r\n  border-color: #e02020;\r\n  font-weight: bold;\r\n}\r\n\r\n.el-button[type=\"primary\"] {\r\n  background-color: #e02020;\r\n  border-color: #e02020;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}