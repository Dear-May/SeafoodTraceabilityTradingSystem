{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { onMounted, ref } from \"vue\";\nimport { ElMessage } from \"element-plus\";\nimport ShopSliderComponent from \"@/components/ShopSliderComponent.vue\";\nimport StoreHeaderView from \"@/components/StoreHeaderView.vue\";\nimport { useUserShop } from \"@/composables/useShopUser\";\nimport { Plus, Search } from \"@element-plus/icons-vue\";\nimport axios from \"axios\";\nconst MAX_FILE_SIZE = 3 * 1024 * 1024; // 3MB\n\nexport default {\n  __name: 'StoreTraceabilityManageView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const {\n      UserForm,\n      shopForm,\n      initUserSession,\n      initShopInfo\n    } = useUserShop();\n    const shopSlider = ref(null);\n    const storeHeader = ref(null);\n    // 当前激活的标签页\n    const activeTab = ref(\"trace\");\n    const loading = ref(false);\n    const traceData = ref([]);\n    const activePanels = ref([]);\n    async function initTraceData() {\n      try {\n        const response = await axios.post('/api/trace/getShopTrace', {\n          ShopID: shopForm.value.shopID\n        }, {\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true\n        });\n        if (response.data != null) {\n          traceData.value = response.data;\n        } else ElMessage.error(\"获取溯源信息失败\");\n      } catch (err) {\n        ElMessage.error(\"获取溯源信息失败\");\n      }\n    }\n    function formatDate(dateString) {\n      const date = new Date(dateString);\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0'); // 月份需加1，并补零\n      const day = String(date.getDate()).padStart(2, '0'); // 补零\n\n      return `${year}-${month}-${day}`;\n    }\n    const dialogTraceVisible = ref(false);\n    const selectID = ref(null);\n    const openAddTraceDialog = id => {\n      dialogTraceVisible.value = true;\n      selectID.value = id;\n    };\n    const closeAddTraceDialog = () => {\n      dialogTraceVisible.value = false;\n      traceForm.value = {\n        info: \"\",\n        images: []\n      };\n      info.value = \"\";\n    };\n\n    // 当前步骤\n    const activeStep = ref(0);\n\n    // 示例商品数据\n    const products = ref([]);\n    const filteredProducts = ref([]);\n    async function initProducts() {\n      try {\n        const response = await axios.post('/api/shop/getAllGoodInfo', {\n          shopID: shopForm.value.shopID\n        }, {\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true\n        });\n        if (response.data != null) {\n          products.value = response.data;\n          filteredProducts.value = products.value;\n        }\n      } catch (err) {\n        ElMessage.error(\"获取商品信息失败\");\n      }\n    }\n\n    // 搜索框内容\n    const searchQuery = ref(\"\");\n\n    // 过滤后的商品列表\n    function searchProducts() {\n      if (searchQuery.value === \"\") {\n        filteredProducts.value = products.value;\n      } else {\n        filteredProducts.value = products.value.filter(item => item.name.toLowerCase().includes(searchQuery.value.toLowerCase()) || item.goodID.toLowerCase().includes(searchQuery.value.toLowerCase())).map(item => ({\n          ...item,\n          specs: item.specs.map(spec => ({\n            ...spec,\n            imageUrl: spec.imageUrl.replace(\"@\", \"\")\n          }))\n        }));\n      }\n    }\n    const toggleProduct = id => {\n      const index = selectedProducts.value.indexOf(id);\n      if (index === -1) {\n        selectedProducts.value.push(id);\n      } else {\n        selectedProducts.value.splice(index, 1);\n      }\n    };\n\n    // 已选择的商品\n    const selectedProducts = ref([]);\n    const getProductById = id => {\n      return products.value.find(product => product.goodID === id) || {};\n    };\n    const removeProduct = id => {\n      const index = selectedProducts.value.indexOf(id);\n      if (index > -1) {\n        selectedProducts.value.splice(index, 1);\n      }\n    };\n\n    // 溯源信息表单\n    const traceForm = ref({\n      info: \"\",\n      images: []\n    });\n    const info = ref(\"\");\n    const dialogVisible = ref(false); // 控制图片预览弹窗\n    const dialogImageUrl = ref(\"\"); // 预览图片的路径\n    const handleFileChange = file => {\n      if (file.size > MAX_FILE_SIZE) {\n        ElMessage({\n          type: 'error',\n          message: '文件大小不能超过 3MB'\n        });\n        return;\n      }\n      const reader = new FileReader();\n      reader.readAsDataURL(file.raw);\n      reader.onload = e => {\n        if (!traceForm.value.images) traceForm.value.images = [];\n        traceForm.value.images.push({\n          name: file.name,\n          url: e.url || URL.createObjectURL(file.raw),\n          file: file.raw\n        });\n      };\n    };\n    const handleRemove = file => {\n      traceForm.value.images = traceForm.value.images.filter(item => item.file !== file.raw);\n    };\n    const handlePictureCardPreview = file => {\n      dialogImageUrl.value = file.url; // 获取图片的 URL 或原始文件\n      dialogVisible.value = true;\n    };\n\n    // 下一步\n    const nextStep = () => {\n      if (activeStep.value === 0 && selectedProducts.value.length === 0) {\n        ElMessage.error(\"请选择至少一个商品！\");\n        return;\n      }\n      activeStep.value++;\n    };\n\n    // 上一步\n    const prevStep = () => {\n      if (activeStep.value === 1) {\n        traceForm.value = {\n          info: \"\",\n          images: []\n        };\n      }\n      if (activeStep.value > 0) activeStep.value--;\n    };\n    async function submitTraceImg(traceID) {\n      const formData = new FormData();\n      for (const file of traceForm.value.images) {\n        formData.append('images', file.file);\n      }\n      formData.append('traceInfoID', traceID);\n      try {\n        const response = await axios.post('/api/trace/uploadImg', formData, {\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          },\n          withCredentials: true\n        });\n        if (response.data.code === 200) {\n          ElMessage.success(\"溯源信息提交成功！\");\n          // 清空表单\n          info.value = \"\";\n          traceForm.value = {\n            info: \"\",\n            images: []\n          };\n          selectedProducts.value = [];\n          activeStep.value = 0;\n          activeTab.value = \"trace\";\n          selectID.value = null;\n          dialogTraceVisible.value = false;\n          await initTraceData();\n        } else {\n          ElMessage.error(\"上传图片失败\");\n        }\n      } catch (err) {\n        ElMessage.error(\"上传图片失败\");\n      }\n    }\n\n    // 提交溯源信息\n    async function submitTrace() {\n      traceForm.value.info = info.value;\n      if (!traceForm.value.info.trim()) {\n        ElMessage.error(\"请填写溯源信息！\");\n        return;\n      }\n      if (!traceForm.value.images) {\n        ElMessage.error(\"请上传至少一张图片！\");\n        return;\n      }\n      try {\n        const response = await axios.post('/api/trace/createTrace', {\n          goodIDs: selectedProducts.value,\n          info: traceForm.value.info,\n          userID: UserForm.value.id,\n          shopID: shopForm.value.shopID\n        }, {\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true\n        });\n        if (response.data.result.code === 200) {\n          if (traceForm.value.images) {\n            await submitTraceImg(response.data.traceID[1]);\n          } else {\n            ElMessage.success(\"溯源信息提交成功！\");\n            // 清空表单\n            info.value = \"\";\n            traceForm.value = {\n              info: \"\",\n              images: []\n            };\n            selectedProducts.value = [];\n            activeStep.value = 0;\n            activeTab.value = \"trace\";\n            dialogTraceVisible.value = false;\n            await initTraceData();\n          }\n        } else {\n          console.log(response.data.result.code);\n          ElMessage.error(\"提交溯源信息失败\");\n        }\n      } catch (err) {\n        ElMessage.error(\"提交溯源信息失败\");\n      }\n    }\n    async function addTraceInfo(traceId) {\n      traceForm.value.info = info.value;\n      if (!traceForm.value.info.trim()) {\n        ElMessage.error(\"请填写溯源信息！\");\n        return;\n      }\n      if (!traceForm.value.images) {\n        ElMessage.error(\"请上传至少一张图片！\");\n        return;\n      }\n      try {\n        const response = await axios.post('/api/trace/addTrace', {\n          traceID: traceId,\n          info: traceForm.value.info,\n          userID: UserForm.value.id,\n          shopID: shopForm.value.shopID\n        }, {\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          withCredentials: true\n        });\n        if (response.data.result.code === 200) {\n          if (traceForm.value.images) {\n            await submitTraceImg(response.data.InfoID);\n          } else {\n            ElMessage.success(\"溯源信息提交成功！\");\n            // 清空表单\n            info.value = \"\";\n            traceForm.value = {\n              info: \"\",\n              images: []\n            };\n            selectID.value = null;\n            await initTraceData();\n          }\n        } else {\n          ElMessage.error(\"提交溯源信息失败1\");\n        }\n      } catch (err) {\n        ElMessage.error(\"提交溯源信息失败\");\n      }\n    }\n    onMounted(async () => {\n      loading.value = true;\n      initUserSession();\n      await initShopInfo();\n      shopSlider.value.setActiveIndex('2-2');\n      storeHeader.value.setTitle(\"溯源管理\");\n      await initTraceData();\n      await initProducts();\n      loading.value = false;\n    });\n    const __returned__ = {\n      UserForm,\n      shopForm,\n      initUserSession,\n      initShopInfo,\n      shopSlider,\n      storeHeader,\n      activeTab,\n      loading,\n      traceData,\n      activePanels,\n      initTraceData,\n      formatDate,\n      dialogTraceVisible,\n      selectID,\n      openAddTraceDialog,\n      closeAddTraceDialog,\n      activeStep,\n      products,\n      filteredProducts,\n      initProducts,\n      searchQuery,\n      searchProducts,\n      toggleProduct,\n      selectedProducts,\n      getProductById,\n      removeProduct,\n      traceForm,\n      info,\n      dialogVisible,\n      dialogImageUrl,\n      MAX_FILE_SIZE,\n      handleFileChange,\n      handleRemove,\n      handlePictureCardPreview,\n      nextStep,\n      prevStep,\n      submitTraceImg,\n      submitTrace,\n      addTraceInfo,\n      onMounted,\n      ref,\n      get ElMessage() {\n        return ElMessage;\n      },\n      ShopSliderComponent,\n      StoreHeaderView,\n      get useUserShop() {\n        return useUserShop;\n      },\n      get Plus() {\n        return Plus;\n      },\n      get Search() {\n        return Search;\n      },\n      get axios() {\n        return axios;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["onMounted","ref","ElMessage","ShopSliderComponent","StoreHeaderView","useUserShop","Plus","Search","axios","MAX_FILE_SIZE","UserForm","shopForm","initUserSession","initShopInfo","shopSlider","storeHeader","activeTab","loading","traceData","activePanels","initTraceData","response","post","ShopID","value","shopID","headers","withCredentials","data","error","err","formatDate","dateString","date","Date","year","getFullYear","month","String","getMonth","padStart","day","getDate","dialogTraceVisible","selectID","openAddTraceDialog","id","closeAddTraceDialog","traceForm","info","images","activeStep","products","filteredProducts","initProducts","searchQuery","searchProducts","filter","item","name","toLowerCase","includes","goodID","map","specs","spec","imageUrl","replace","toggleProduct","index","selectedProducts","indexOf","push","splice","getProductById","find","product","removeProduct","dialogVisible","dialogImageUrl","handleFileChange","file","size","type","message","reader","FileReader","readAsDataURL","raw","onload","e","url","URL","createObjectURL","handleRemove","handlePictureCardPreview","nextStep","length","prevStep","submitTraceImg","traceID","formData","FormData","append","code","success","submitTrace","trim","goodIDs","userID","result","console","log","addTraceInfo","traceId","InfoID","setActiveIndex","setTitle"],"sources":["D:/Cache/Java/shopping/shoppping_c_frontend/src/views/Store/StoreTraceabilityManageView.vue"],"sourcesContent":["<template>\r\n  <div class=\"d-flex\" style=\"height: 100vh; overflow: hidden;\">\r\n    <ShopSliderComponent ref=\"shopSlider\"></ShopSliderComponent>\r\n    <div class=\"flex-grow-1 overflow-auto\" style=\"background: #f5f7fa;\">\r\n      <StoreHeaderView ref=\"storeHeader\"></StoreHeaderView>\r\n\r\n      <div class=\"p-4\" v-loading=\"loading\">\r\n        <el-tabs v-model=\"activeTab\" class=\"demo-tabs\">\r\n          <!-- 溯源管理 -->\r\n          <el-tab-pane name=\"trace\">\r\n            <template #label>\r\n              <i class=\"bi bi-bar-chart\" style=\"font-size: 16px; color: #333;\"></i>\r\n              <span style=\"margin-left: 5px; font-weight: bold; font-size: 16px; color: #333;\">溯源管理</span>\r\n            </template>\r\n            <div>\r\n              <!-- 折叠面板 -->\r\n              <el-collapse v-model=\"activePanels\" class=\"trace-collapse\">\r\n                <el-collapse-item\r\n                    v-for=\"item in traceData\"\r\n                    :key=\"item.id\"\r\n                    :title=\"item.title\"\r\n                    :name=\"item.id\"\r\n                >\r\n                  <template #title>\r\n                    <div class=\"collapse-title\">\r\n                      <span style=\"padding-left: 10px; padding-right: 10px;\">{{ item.firstTitle }}</span>\r\n                      <el-tag type=\"info\">{{ formatDate(item.date) }}</el-tag>\r\n                    </div>\r\n                  </template>\r\n                  <!-- 时间线 -->\r\n                  <el-timeline>\r\n                    <el-timeline-item\r\n                        v-for=\"(entry, index) in item.entries\"\r\n                        :key=\"index\"\r\n                        :timestamp=\"formatDate(entry.timestamp)\"\r\n                        placement=\"top\"\r\n                    >\r\n                      <el-card>\r\n                        <div class=\"timeline-entry\">\r\n                          <p style=\"color: #333; font-size: 14px; margin-bottom: 0; text-align: start;\">操作员:\r\n                            {{ entry.operator }}</p>\r\n                          <p class=\"timeline-content\">{{ entry.content }}</p>\r\n                          <div class=\"timeline-images\">\r\n                            <el-image\r\n                                v-for=\"(image, imgIndex) in entry.images\"\r\n                                :key=\"imgIndex\"\r\n                                :src=\"image\"\r\n                                class=\"timeline-image\"\r\n                                style=\"margin-right: 8px;\"\r\n                                fit=\"cover\"\r\n                            ></el-image>\r\n                          </div>\r\n                        </div>\r\n                      </el-card>\r\n                    </el-timeline-item>\r\n                  </el-timeline>\r\n                  <!-- 增加溯源信息按钮 -->\r\n                  <div class=\"add-trace-button\">\r\n                    <el-button type=\"primary\" @click=\"openAddTraceDialog(item.id)\">增加溯源信息</el-button>\r\n                  </div>\r\n\r\n                </el-collapse-item>\r\n              </el-collapse>\r\n              <!-- 增加溯源信息弹窗 -->\r\n              <el-dialog\r\n                  title=\"新增溯源信息\"\r\n                  v-model=\"dialogTraceVisible\"\r\n                  width=\"50%\"\r\n                  :append-to-body=\"true\"\r\n                  :before-close=\"closeAddTraceDialog\"\r\n              >\r\n                <el-form\r\n                    ref=\"traceForm\"\r\n                    :model=\"traceForm\"\r\n                    label-width=\"120px\"\r\n                    class=\"trace-form\"\r\n                >\r\n                  <el-form-item label=\"溯源描述\">\r\n                    <el-input\r\n                        v-model=\"info\"\r\n                        type=\"textarea\"\r\n                        rows=\"5\"\r\n                        placeholder=\"请输入溯源详细描述\"\r\n                        maxlength=\"200\"\r\n                        show-word-limit\r\n                    ></el-input>\r\n                  </el-form-item>\r\n\r\n                  <el-form-item label=\"上传图片\">\r\n                    <el-upload\r\n                        list-type=\"picture-card\"\r\n                        :auto-upload=\"false\"\r\n                        :limit=\"3\"\r\n                        accept=\"image/*\"\r\n                        :on-change=\"handleFileChange\"\r\n                        :on-preview=\"handlePictureCardPreview\"\r\n                        :on-remove=\"handleRemove\"\r\n                        :file-list=\"traceForm.images\"\r\n                    >\r\n                      <el-icon>\r\n                        <Plus/>\r\n                      </el-icon>\r\n                    </el-upload>\r\n                    <br>\r\n                    <div class=\"el-upload__tip\">最多上传 3 张图片，支持 JPG/PNG 格式。</div>\r\n                  </el-form-item>\r\n\r\n                  <el-dialog v-model=\"dialogVisible\">\r\n                    <img :src=\"dialogImageUrl\" alt=\"Preview Image\"/>\r\n                  </el-dialog>\r\n                </el-form>\r\n                <template #footer>\r\n                  <el-button @click=\"closeAddTraceDialog\">取消</el-button>\r\n                  <el-button type=\"primary\" @click=\"addTraceInfo(selectID)\">提交</el-button>\r\n                </template>\r\n              </el-dialog>\r\n            </div>\r\n          </el-tab-pane>\r\n\r\n          <!-- 新增溯源 -->\r\n          <el-tab-pane name=\"add-trace\">\r\n            <template #label>\r\n              <i class=\"bi bi-plus-circle\" style=\"font-size: 16px; color: #333;\"></i>\r\n              <span style=\"margin-left: 5px; font-weight: bold; font-size: 16px; color: #333;\">新增溯源</span>\r\n            </template>\r\n            <div class=\"row\">\r\n              <!-- 步骤条 -->\r\n              <div class=\"col-3 step-container\">\r\n                <el-steps direction=\"vertical\" :active=\"activeStep\" finish-status=\"success\">\r\n                  <el-step title=\"选择商品\"></el-step>\r\n                  <el-step title=\"录入溯源信息\"></el-step>\r\n                </el-steps>\r\n              </div>\r\n\r\n              <!-- 步骤内容 -->\r\n              <div class=\"col-9\">\r\n                <!-- 第一步：选择商品 -->\r\n                <div v-if=\"activeStep === 0\">\r\n                  <h3 class=\"step-title\">选择商品</h3>\r\n                  <el-divider></el-divider>\r\n                  <div class=\"search-container \">\r\n                    <el-input\r\n                        class=\"search-input\"\r\n                        v-model=\"searchQuery\"\r\n                        placeholder=\"请输入商品名称或商品ID进行搜索\"\r\n                        clearable\r\n                        @keyup.enter=\"searchProducts\"\r\n                    />\r\n                    <el-button type=\"primary\" @click=\"searchProducts\">\r\n                      <el-icon>\r\n                        <Search/>\r\n                      </el-icon>\r\n                      搜索\r\n                    </el-button>\r\n                  </div>\r\n                  <div class=\"row product-grid\">\r\n                    <div\r\n                        class=\"col-md-4 mb-3\"\r\n                        v-for=\"product in filteredProducts\"\r\n                        :key=\"product.id\"\r\n                    >\r\n                      <el-card\r\n                          shadow=\"hover\"\r\n                          :class=\"{'selected-card': selectedProducts.includes(product.goodID)}\"\r\n                          class=\"product-card\"\r\n                          @click=\"toggleProduct(product.goodID)\"\r\n                      >\r\n                        <img\r\n                            :src=\"product.imageUrl\"\r\n                            alt=\"商品图片\"\r\n                            class=\"product-image\"\r\n                        />\r\n                        <p class=\"product-name\">{{ product.name }}</p>\r\n                      </el-card>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"step-actions\">\r\n                    <el-button type=\"primary\" @click=\"nextStep\">下一步</el-button>\r\n                  </div>\r\n                </div>\r\n\r\n                <!-- 第二步：录入溯源信息 -->\r\n                <div v-else-if=\"activeStep === 1\">\r\n                  <h3 class=\"step-title\">录入溯源信息</h3>\r\n                  <el-divider></el-divider>\r\n                  <el-form\r\n                      ref=\"traceForm\"\r\n                      :model=\"traceForm\"\r\n                      label-width=\"120px\"\r\n                      class=\"trace-form\"\r\n                  >\r\n                    <el-form-item label=\"溯源描述\">\r\n                      <el-input\r\n                          v-model=\"info\"\r\n                          type=\"textarea\"\r\n                          rows=\"5\"\r\n                          placeholder=\"请输入溯源详细描述\"\r\n                          maxlength=\"200\"\r\n                          show-word-limit\r\n                      ></el-input>\r\n                    </el-form-item>\r\n\r\n                    <el-form-item label=\"上传图片\">\r\n                      <el-upload\r\n                          list-type=\"picture-card\"\r\n                          :auto-upload=\"false\"\r\n                          :limit=\"3\"\r\n                          accept=\"image/*\"\r\n                          :on-change=\"handleFileChange\"\r\n                          :on-preview=\"handlePictureCardPreview\"\r\n                          :on-remove=\"handleRemove\"\r\n                          :file-list=\"traceForm.images\"\r\n                      >\r\n                        <el-icon>\r\n                          <Plus/>\r\n                        </el-icon>\r\n                      </el-upload>\r\n                      <br>\r\n                      <div class=\"el-upload__tip\">最多上传 3 张图片，支持 JPG/PNG 格式。</div>\r\n                    </el-form-item>\r\n\r\n                    <el-dialog v-model=\"dialogVisible\">\r\n                      <img :src=\"dialogImageUrl\" alt=\"Preview Image\"/>\r\n                    </el-dialog>\r\n                  </el-form>\r\n                  <div class=\"step-actions\">\r\n                    <el-button @click=\"prevStep\">上一步</el-button>\r\n                    <el-button type=\"primary\" @click=\"submitTrace\">提交</el-button>\r\n                  </div>\r\n                </div>\r\n\r\n              </div>\r\n            </div>\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </div>\r\n\r\n      <div class=\"fixed-selected-products\" v-if=\"activeTab === 'add-trace' && activeStep === 0\">\r\n        <h4>已选商品</h4>\r\n        <div v-if=\"selectedProducts.length === 0\">\r\n          <p>尚未选择任何商品。</p>\r\n        </div>\r\n        <el-card\r\n            v-for=\"id in selectedProducts\"\r\n            :key=\"id\"\r\n            class=\"selected-product-card\"\r\n            shadow=\"hover\"\r\n        >\r\n          <div class=\"d-flex align-items-center\">\r\n            <img\r\n                :src=\"getProductById(id).imageUrl\"\r\n                alt=\"商品图片\"\r\n                class=\"product-thumbnail\"\r\n            />\r\n            <div class=\"ml-2\">\r\n              <p class=\"selected-product-name\">{{ getProductById(id).name }}</p>\r\n              <el-button\r\n                  type=\"text\"\r\n                  size=\"small\"\r\n                  @click=\"removeProduct(id)\"\r\n                  class=\"remove-btn\"\r\n              >\r\n                移除\r\n              </el-button>\r\n            </div>\r\n          </div>\r\n        </el-card>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n</template>\r\n\r\n<script setup>\r\nimport {onMounted, ref} from \"vue\";\r\nimport {ElMessage} from \"element-plus\";\r\nimport ShopSliderComponent from \"@/components/ShopSliderComponent.vue\";\r\nimport StoreHeaderView from \"@/components/StoreHeaderView.vue\";\r\nimport {useUserShop} from \"@/composables/useShopUser\";\r\nimport {Plus, Search} from \"@element-plus/icons-vue\";\r\nimport axios from \"axios\";\r\n\r\nconst {UserForm, shopForm, initUserSession, initShopInfo} = useUserShop();\r\nconst shopSlider = ref(null);\r\nconst storeHeader = ref(null);\r\n// 当前激活的标签页\r\nconst activeTab = ref(\"trace\");\r\nconst loading = ref(false);\r\nconst traceData = ref([]);\r\nconst activePanels = ref([]);\r\n\r\nasync function initTraceData() {\r\n  try {\r\n    const response = await axios.post('/api/trace/getShopTrace', {\r\n      ShopID: shopForm.value.shopID,\r\n    }, {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data != null) {\r\n      traceData.value = response.data;\r\n    } else\r\n      ElMessage.error(\"获取溯源信息失败\");\r\n  } catch (err) {\r\n    ElMessage.error(\"获取溯源信息失败\");\r\n  }\r\n}\r\n\r\nfunction formatDate(dateString) {\r\n  const date = new Date(dateString);\r\n  const year = date.getFullYear();\r\n  const month = String(date.getMonth() + 1).padStart(2, '0'); // 月份需加1，并补零\r\n  const day = String(date.getDate()).padStart(2, '0'); // 补零\r\n\r\n  return `${year}-${month}-${day}`;\r\n}\r\n\r\nconst dialogTraceVisible = ref(false);\r\nconst selectID = ref(null);\r\nconst openAddTraceDialog = (id) => {\r\n  dialogTraceVisible.value = true;\r\n  selectID.value = id;\r\n};\r\nconst closeAddTraceDialog = () => {\r\n  dialogTraceVisible.value = false;\r\n  traceForm.value = {info: \"\", images: []};\r\n  info.value = \"\";\r\n}\r\n\r\n// 当前步骤\r\nconst activeStep = ref(0);\r\n\r\n// 示例商品数据\r\nconst products = ref([]);\r\nconst filteredProducts = ref([]);\r\n\r\nasync function initProducts() {\r\n  try {\r\n    const response = await axios.post('/api/shop/getAllGoodInfo', {\r\n      shopID: shopForm.value.shopID,\r\n    }, {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      withCredentials: true\r\n    })\r\n    if (response.data != null) {\r\n      products.value = response.data;\r\n      filteredProducts.value = products.value;\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"获取商品信息失败\");\r\n  }\r\n}\r\n\r\n// 搜索框内容\r\nconst searchQuery = ref(\"\");\r\n\r\n// 过滤后的商品列表\r\nfunction searchProducts() {\r\n  if (searchQuery.value === \"\") {\r\n    filteredProducts.value = products.value;\r\n  } else {\r\n    filteredProducts.value = products.value\r\n        .filter(item =>\r\n            item.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||\r\n            item.goodID.toLowerCase().includes(searchQuery.value.toLowerCase())\r\n        )\r\n        .map(item => ({\r\n          ...item,\r\n          specs: item.specs.map(spec => ({...spec, imageUrl: spec.imageUrl.replace(\"@\", \"\")}))\r\n        }));\r\n  }\r\n}\r\n\r\nconst toggleProduct = (id) => {\r\n  const index = selectedProducts.value.indexOf(id);\r\n  if (index === -1) {\r\n    selectedProducts.value.push(id);\r\n  } else {\r\n    selectedProducts.value.splice(index, 1);\r\n  }\r\n};\r\n\r\n// 已选择的商品\r\nconst selectedProducts = ref([]);\r\n\r\nconst getProductById = (id) => {\r\n  return products.value.find((product) => product.goodID === id) || {};\r\n};\r\n\r\nconst removeProduct = (id) => {\r\n  const index = selectedProducts.value.indexOf(id);\r\n  if (index > -1) {\r\n    selectedProducts.value.splice(index, 1);\r\n  }\r\n};\r\n\r\n// 溯源信息表单\r\nconst traceForm = ref({\r\n  info: \"\",\r\n  images: []\r\n})\r\nconst info = ref(\"\");\r\nconst dialogVisible = ref(false); // 控制图片预览弹窗\r\nconst dialogImageUrl = ref(\"\"); // 预览图片的路径\r\nconst MAX_FILE_SIZE = 3 * 1024 * 1024; // 3MB\r\n\r\nconst handleFileChange = (file) => {\r\n  if (file.size > MAX_FILE_SIZE) {\r\n    ElMessage({\r\n      type: 'error',\r\n      message: '文件大小不能超过 3MB',\r\n    });\r\n    return;\r\n  }\r\n  const reader = new FileReader();\r\n  reader.readAsDataURL(file.raw);\r\n  reader.onload = (e) => {\r\n    if (!traceForm.value.images)\r\n      traceForm.value.images = [];\r\n    traceForm.value.images.push({\r\n      name: file.name,\r\n      url: e.url || URL.createObjectURL(file.raw),\r\n      file: file.raw\r\n    });\r\n  };\r\n};\r\n\r\nconst handleRemove = (file) => {\r\n  traceForm.value.images = traceForm.value.images.filter(item => item.file !== file.raw);\r\n};\r\n\r\nconst handlePictureCardPreview = (file) => {\r\n  dialogImageUrl.value = file.url; // 获取图片的 URL 或原始文件\r\n  dialogVisible.value = true;\r\n};\r\n\r\n// 下一步\r\nconst nextStep = () => {\r\n  if (activeStep.value === 0 && selectedProducts.value.length === 0) {\r\n    ElMessage.error(\"请选择至少一个商品！\");\r\n    return;\r\n  }\r\n  activeStep.value++;\r\n};\r\n\r\n// 上一步\r\nconst prevStep = () => {\r\n  if (activeStep.value === 1) {\r\n    traceForm.value = {info: \"\", images: []};\r\n  }\r\n  if (activeStep.value > 0) activeStep.value--;\r\n};\r\n\r\nasync function submitTraceImg(traceID) {\r\n  const formData = new FormData();\r\n  for (const file of traceForm.value.images) {\r\n    formData.append('images', file.file);\r\n  }\r\n  formData.append('traceInfoID', traceID);\r\n  try {\r\n    const response = await axios.post('/api/trace/uploadImg', formData, {\r\n      headers: {\r\n        'Content-Type': 'multipart/form-data'\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.code === 200) {\r\n      ElMessage.success(\"溯源信息提交成功！\");\r\n      // 清空表单\r\n      info.value = \"\";\r\n      traceForm.value = {info: \"\", images: []};\r\n      selectedProducts.value = [];\r\n      activeStep.value = 0;\r\n      activeTab.value = \"trace\";\r\n      selectID.value = null;\r\n      dialogTraceVisible.value = false;\r\n      await initTraceData();\r\n    } else {\r\n      ElMessage.error(\"上传图片失败\");\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"上传图片失败\");\r\n  }\r\n}\r\n\r\n// 提交溯源信息\r\nasync function submitTrace() {\r\n  traceForm.value.info = info.value;\r\n  if (!traceForm.value.info.trim()) {\r\n    ElMessage.error(\"请填写溯源信息！\");\r\n    return;\r\n  }\r\n  if (!traceForm.value.images) {\r\n    ElMessage.error(\"请上传至少一张图片！\");\r\n    return;\r\n  }\r\n  try {\r\n    const response = await axios.post('/api/trace/createTrace', {\r\n      goodIDs: selectedProducts.value,\r\n      info: traceForm.value.info,\r\n      userID: UserForm.value.id,\r\n      shopID: shopForm.value.shopID,\r\n    }, {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.result.code === 200) {\r\n      if (traceForm.value.images) {\r\n        await submitTraceImg(response.data.traceID[1]);\r\n      } else {\r\n        ElMessage.success(\"溯源信息提交成功！\");\r\n        // 清空表单\r\n        info.value = \"\";\r\n        traceForm.value = {info: \"\", images: []};\r\n        selectedProducts.value = [];\r\n        activeStep.value = 0;\r\n        activeTab.value = \"trace\";\r\n        dialogTraceVisible.value = false;\r\n        await initTraceData();\r\n      }\r\n    } else {\r\n      console.log(response.data.result.code);\r\n      ElMessage.error(\"提交溯源信息失败\");\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"提交溯源信息失败\");\r\n  }\r\n}\r\n\r\nasync function addTraceInfo(traceId) {\r\n  traceForm.value.info = info.value;\r\n  if (!traceForm.value.info.trim()) {\r\n    ElMessage.error(\"请填写溯源信息！\");\r\n    return;\r\n  }\r\n  if (!traceForm.value.images) {\r\n    ElMessage.error(\"请上传至少一张图片！\");\r\n    return;\r\n  }\r\n  try {\r\n    const response = await axios.post('/api/trace/addTrace', {\r\n      traceID: traceId,\r\n      info: traceForm.value.info,\r\n      userID: UserForm.value.id,\r\n      shopID: shopForm.value.shopID,\r\n    }, {\r\n      headers: {\r\n        \"Content-Type\": \"application/json\"\r\n      },\r\n      withCredentials: true\r\n    });\r\n    if (response.data.result.code === 200) {\r\n      if (traceForm.value.images) {\r\n        await submitTraceImg(response.data.InfoID);\r\n      } else {\r\n        ElMessage.success(\"溯源信息提交成功！\");\r\n        // 清空表单\r\n        info.value = \"\";\r\n        traceForm.value = {info: \"\", images: []};\r\n        selectID.value = null;\r\n        await initTraceData();\r\n      }\r\n    } else {\r\n      ElMessage.error(\"提交溯源信息失败1\")\r\n    }\r\n  } catch (err) {\r\n    ElMessage.error(\"提交溯源信息失败\");\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  loading.value = true;\r\n  initUserSession();\r\n  await initShopInfo();\r\n  shopSlider.value.setActiveIndex('2-2')\r\n  storeHeader.value.setTitle(\"溯源管理\")\r\n  await initTraceData();\r\n  await initProducts();\r\n  loading.value = false;\r\n});\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.step-container {\r\n  padding-right: 20px;\r\n  border-right: 1px solid #e6e6e6;\r\n}\r\n\r\n.step-title {\r\n  font-size: 20px;\r\n  font-weight: bold;\r\n  color: #333;\r\n  margin-bottom: 16px;\r\n}\r\n\r\n.search-container {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n  padding-right: 20px;\r\n\r\n  .search-input {\r\n    padding: 10px;\r\n    font-size: 16px;\r\n    border: 2px solid #ccc;\r\n    border-radius: 8px 0 0 8px;\r\n    outline: none;\r\n    width: 200px;\r\n    border-right: none;\r\n  }\r\n\r\n  .search-button {\r\n    padding: 10px 20px;\r\n    background-color: #e02020;\r\n    color: white;\r\n    font-size: 16px;\r\n    border: 2px solid #e02020;\r\n    border-radius: 0 8px 8px 0;\r\n    cursor: pointer;\r\n    font-weight: bold;\r\n  }\r\n\r\n  .search-button:hover {\r\n    background-color: #c21a1a;\r\n    border-color: #c21a1a;\r\n  }\r\n}\r\n\r\n.product-grid {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 16px;\r\n  min-height: 60vh;\r\n}\r\n\r\n.product-card {\r\n  text-align: center;\r\n  padding: 15px;\r\n  cursor: pointer;\r\n  border: 1px solid #e6e6e6;\r\n  border-radius: 8px;\r\n  transition: all 0.3s;\r\n}\r\n\r\n.product-card:hover {\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\r\n  transform: translateY(-3px);\r\n}\r\n\r\n.product-card.selected-card {\r\n  border-color: #409eff;\r\n  background-color: #f0faff;\r\n}\r\n\r\n.product-image {\r\n  width: 100px;\r\n  height: 100px;\r\n  margin-bottom: 10px;\r\n  object-fit: cover;\r\n  border-radius: 50%;\r\n  border: 2px solid #e6e6e6;\r\n}\r\n\r\n.product-name {\r\n  font-size: 16px;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.step-actions {\r\n  margin-top: 20px;\r\n  text-align: right;\r\n}\r\n\r\n.el-upload {\r\n  margin-top: 10px;\r\n}\r\n\r\n.trace-form {\r\n  padding: 20px;\r\n  background: #fff;\r\n  border: 1px solid #e6e6e6;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.trace-form .el-form-item {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.el-upload {\r\n  margin-top: 10px;\r\n}\r\n\r\n.el-upload .el-icon-plus {\r\n  font-size: 24px;\r\n  color: #409eff;\r\n}\r\n\r\n.el-upload__tip {\r\n  font-size: 12px;\r\n  color: #999;\r\n  margin-top: 5px;\r\n}\r\n\r\n.step-actions {\r\n  margin-top: 20px;\r\n  text-align: right;\r\n}\r\n\r\n.step-actions .el-button {\r\n  margin-left: 10px;\r\n}\r\n\r\n.fixed-selected-products {\r\n  position: fixed;\r\n  top: 300px;\r\n  right: 20px;\r\n  width: 300px;\r\n  background: #fff;\r\n  border: 1px solid #e6e6e6;\r\n  border-radius: 8px;\r\n  padding: 16px;\r\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.fixed-selected-products h4 {\r\n  margin-bottom: 16px;\r\n  font-size: 18px;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.selected-product-card {\r\n  margin-bottom: 12px;\r\n  padding: 8px;\r\n  border: 1px solid #e6e6e6;\r\n  border-radius: 4px;\r\n}\r\n\r\n.product-thumbnail {\r\n  width: 50px;\r\n  height: 50px;\r\n  border-radius: 4px;\r\n  object-fit: cover;\r\n}\r\n\r\n.selected-product-name {\r\n  margin: 0;\r\n  font-size: 14px;\r\n  font-weight: bold;\r\n  color: #333;\r\n}\r\n\r\n.remove-btn {\r\n  color: #ff4d4f;\r\n  font-size: 12px;\r\n  margin-top: 4px;\r\n}\r\n\r\n/* 折叠面板整体样式 */\r\n.trace-collapse {\r\n  margin-bottom: 20px;\r\n  border: 1px solid #e6e6e6;\r\n  border-radius: 8px;\r\n  background: #fff;\r\n  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n/* 折叠面板标题 */\r\n.collapse-title {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  font-weight: bold;\r\n  color: #333;\r\n  font-size: 16px;\r\n}\r\n\r\n.collapse-title .el-tag {\r\n  font-size: 12px;\r\n  background-color: #f5f7fa;\r\n  color: #409eff;\r\n}\r\n\r\n/* 时间线样式 */\r\n.timeline-entry {\r\n  padding: 12px 0;\r\n}\r\n\r\n.timeline-content {\r\n  font-size: 14px;\r\n  color: #666;\r\n  margin-bottom: 8px;\r\n  line-height: 1.5;\r\n  text-align: start;\r\n}\r\n\r\n.timeline-entry img {\r\n  width: 100px;\r\n  height: 100px;\r\n  object-fit: cover;\r\n  border-radius: 8px;\r\n  margin-top: 8px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n/* 增加溯源信息按钮 */\r\n.add-trace-button {\r\n  text-align: right;\r\n  margin-top: 20px;\r\n  margin-right: 20px;\r\n}\r\n\r\n.add-trace-button .el-button {\r\n  padding: 10px 24px;\r\n  font-size: 14px;\r\n}\r\n\r\n/* 弹窗样式 */\r\n.el-dialog {\r\n  border-radius: 10px;\r\n}\r\n\r\n.el-dialog__header {\r\n  font-weight: bold;\r\n  font-size: 18px;\r\n  color: #333;\r\n}\r\n\r\n.el-form-item {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.el-upload .el-icon-plus {\r\n  font-size: 36px;\r\n  color: #409eff;\r\n}\r\n\r\n.el-upload__tip {\r\n  font-size: 12px;\r\n  color: #999;\r\n  margin-top: 5px;\r\n  text-align: left;\r\n}\r\n\r\n.el-upload__trigger:hover {\r\n  background-color: #f5f7fa;\r\n  border: 1px dashed #409eff;\r\n}\r\n\r\n.el-timeline {\r\n  padding: 16px;\r\n  background: #f9f9f9;\r\n  border-radius: 8px;\r\n  margin-top: 10px;\r\n}\r\n\r\n.el-timeline-item__content {\r\n  font-size: 14px;\r\n  color: #333;\r\n}\r\n\r\n.timeline-images {\r\n  display: flex;\r\n  gap: 8px;\r\n  margin-top: 8px;\r\n}\r\n\r\n.timeline-image {\r\n  width: 100px;\r\n  height: 100px;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n</style>\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}