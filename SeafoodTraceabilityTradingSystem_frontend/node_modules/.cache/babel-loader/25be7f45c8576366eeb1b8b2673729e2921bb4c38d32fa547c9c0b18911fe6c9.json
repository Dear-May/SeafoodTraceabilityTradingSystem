{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport ShopSliderComponent from \"@/components/ShopSliderComponent.vue\";\nimport { useUserShop } from \"@/composables/useShopUser\";\nimport { onMounted, ref } from \"vue\";\nimport axios from \"axios\";\nimport { ElMessage } from \"element-plus\";\nimport router from \"@/router\";\nimport StoreHeaderView from \"@/components/StoreHeaderView.vue\";\nexport default {\n  __name: 'StoreOrderListView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const {\n      shopForm,\n      initUserSession,\n      initShopInfo\n    } = useUserShop();\n    const shopSlider = ref(null);\n    const storeHeader = ref(null);\n    const activeTab = ref('all');\n    const handleTabClick = () => {\n      if (activeTab.value === 'refunding') {\n        ElMessage.error('暂未开通');\n      }\n    };\n    const orderList = ref([]);\n    const filteredOrders = ref([]);\n    const orderCount = ref({\n      all: 0,\n      paid: 0,\n      delivered: 0,\n      refunding: 0\n    });\n    async function initOrderCount() {\n      try {\n        const response = await axios.post('/api/shop/getShopOrderCount', {\n          shopID: shopForm.value.shopID\n        }, {\n          headers: {\n            'Content-Type': 'application/json;charset=UTF-8'\n          },\n          withCredentials: true\n        });\n        if (response.data !== null) {\n          orderCount.value = response.data;\n        } else ElMessage.error(\"获取订单数量失败，请稍后再试。\");\n      } catch (err) {\n        ElMessage.error(\"获取订单数量失败，请稍后再试。\");\n      }\n    }\n    async function initOrdersInfo() {\n      try {\n        const response = await axios.post('/api/shop/getShopOrderInfo', {\n          shopID: shopForm.value.shopID\n        }, {\n          headers: {\n            'Content-Type': 'application/json;charset=UTF-8'\n          },\n          withCredentials: true\n        });\n        if (response.data !== null) {\n          orderList.value = response.data;\n          filteredOrders.value = orderList.value;\n          await initOrderCount();\n        } else ElMessage.error(\"获取订单信息失败，请稍后再试。\");\n      } catch (err) {\n        ElMessage.error(\"获取订单信息失败，请稍后再试。\");\n      }\n    }\n    const searchQuery = ref(\"\");\n    function filterOrders() {\n      // 检查搜索查询是否为空\n      if (!searchQuery.value.trim() && activeTab.value === 'all') {\n        // 如果为空，直接展示所有历史数据\n        filteredOrders.value = orderList.value;\n        return;\n      }\n\n      // 根据关键词过滤历史数据\n      filteredOrders.value = filteredOrders.value.filter(item => item.orderId.toLowerCase().includes(searchQuery.value.toLowerCase()) || item.userName.toLowerCase().includes(searchQuery.value.toLowerCase())).map(item => ({\n        status: item.status,\n        createTime: item.createTime,\n        address: item.address,\n        shopId: item.shopId,\n        userName: item.userName,\n        totalPrice: item.totalPrice,\n        orderId: item.orderId,\n        orderItems: item.orderItems // 可以根据需要决定是否包含订单项\n      }));\n    }\n    function filterOrdersStatus(status) {\n      if (status === '全部') {\n        filteredOrders.value = orderList.value;\n        return;\n      }\n      filteredOrders.value = orderList.value.filter(item => item.status === status);\n    }\n    function formatDate(dateString) {\n      const date = new Date(dateString);\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0'); // 月份需加1，并补零\n      const day = String(date.getDate()).padStart(2, '0'); // 补零\n\n      return `${year}-${month}-${day}`;\n    }\n    function handleToChat(shopId) {\n      router.push('/talkToStore?id=' + shopId);\n    }\n    async function handleDeliver(order) {\n      try {\n        const response = await axios.post('/api/shop/updateOrderStatus', {\n          shopId: shopForm.value.shopID,\n          userId: order.userId,\n          orderId: order.orderId,\n          status: '已发货'\n        }, {\n          headers: {\n            'Content-Type': 'application/json;charset=UTF-8'\n          },\n          withCredentials: true\n        });\n        if (response.data.code === 200) {\n          ElMessage.success(\"订单状态已更新为已发货\");\n          await initOrdersInfo();\n        } else ElMessage.error(\"发货失败，请稍后再试。\");\n      } catch (err) {\n        ElMessage.error(\"发货失败，请稍后再试。\");\n      }\n    }\n    onMounted(async () => {\n      initUserSession();\n      await initShopInfo();\n      shopSlider.value.setActiveIndex('3-1');\n      storeHeader.value.setTitle('订单管理');\n      await initOrdersInfo();\n    });\n    const __returned__ = {\n      shopForm,\n      initUserSession,\n      initShopInfo,\n      shopSlider,\n      storeHeader,\n      activeTab,\n      handleTabClick,\n      orderList,\n      filteredOrders,\n      orderCount,\n      initOrderCount,\n      initOrdersInfo,\n      searchQuery,\n      filterOrders,\n      filterOrdersStatus,\n      formatDate,\n      handleToChat,\n      handleDeliver,\n      ShopSliderComponent,\n      get useUserShop() {\n        return useUserShop;\n      },\n      onMounted,\n      ref,\n      get axios() {\n        return axios;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get router() {\n        return router;\n      },\n      StoreHeaderView\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ShopSliderComponent","useUserShop","onMounted","ref","axios","ElMessage","router","StoreHeaderView","shopForm","initUserSession","initShopInfo","shopSlider","storeHeader","activeTab","handleTabClick","value","error","orderList","filteredOrders","orderCount","all","paid","delivered","refunding","initOrderCount","response","post","shopID","headers","withCredentials","data","err","initOrdersInfo","searchQuery","filterOrders","trim","filter","item","orderId","toLowerCase","includes","userName","map","status","createTime","address","shopId","totalPrice","orderItems","filterOrdersStatus","formatDate","dateString","date","Date","year","getFullYear","month","String","getMonth","padStart","day","getDate","handleToChat","push","handleDeliver","order","userId","code","success","setActiveIndex","setTitle"],"sources":["D:/Cache/Java/shopping/shoppping_c_frontend/src/views/Store/StoreOrderListView.vue"],"sourcesContent":["<template>\r\n  <div class=\"d-flex\" style=\"height: 100vh; overflow: hidden;\">\r\n    <ShopSliderComponent ref=\"shopSlider\" @initApplications=\"initOrdersInfo\"></ShopSliderComponent>\r\n    <div class=\"flex-grow-1 overflow-auto\" style=\"background: #f5f7fa;\">\r\n      <StoreHeaderView ref=\"storeHeader\"></StoreHeaderView>\r\n\r\n      <div class=\"p-4\">\r\n        <el-tabs class=\"demo-tabs\" v-model=\"activeTab\" @tab-click=\"handleTabClick\">\r\n          <el-tab-pane name=\"all\" label=\"全部订单\">\r\n            <template #label>\r\n        <span class=\"custom-tabs-label\" @click=\"filterOrdersStatus('全部')\">\r\n          <span :class=\"{isActive: activeTab==='all'}\"><i\r\n              class=\"bi bi-list order-icon\"></i>所有订单&nbsp;({{ orderCount.all }})</span>\r\n        </span>\r\n            </template>\r\n            <div class=\"search-container\">\r\n              <el-input type=\"text\" v-model=\"searchQuery\" placeholder=\"搜索用户名或者订单号...\" class=\"search-input\"\r\n                        @keyup.enter=\"filterOrders\"/>\r\n              <button @click=\"filterOrders\" class=\"search-button\">\r\n                <a class=\"bi bi-search\" style=\"color:whitesmoke;\"></a>\r\n              </button>\r\n            </div>\r\n            <div class=\"row\"\r\n                 style=\"background-color: #f5f5f5; padding: 10px; margin-bottom: 10px; margin-left: 40px; margin-right: 40px; font-weight: bold;\">\r\n              <span class=\"col-4\">商品</span>\r\n              <span class=\"col-1\">单价</span>\r\n              <span class=\"col-2\">数量</span>\r\n              <span class=\"col-3\">总计</span>\r\n              <span class=\"col-2\">操作</span>\r\n            </div>\r\n            <div class=\"order-list\">\r\n              <div v-for=\"(order) in filteredOrders\" :key=\"order.orderId\" class=\"order-items\">\r\n                <div class=\"order-item-header row\">\r\n                  <div class=\"col-4\" style=\"text-align: left;\">\r\n                    <span style=\"font-weight: bold; font-size: 16px;\">{{ formatDate(order.createTime) }}</span>&nbsp;&nbsp;\r\n                    <span style=\"font-size: 14px;\">订单号：{{ order.orderId }}</span>\r\n                  </div>\r\n                  <div class=\"col-5\" style=\"text-align: left;\">\r\n                    <span style=\"font-size: 14px;\" class=\"ellipsis\">{{ order.userName }}\r\n                    <a class=\"bi bi-chat shake-animation\" style=\"margin-left: 10px; color: #ff5000;\"\r\n                       @click=\"handleToChat(order.shopId)\"></a></span>\r\n                  </div>\r\n                  <div class=\"col-3\">\r\n                    <span style=\"font-size: 14px; font-weight: bold;\">状态：{{ order.status }}</span>\r\n                  </div>\r\n                </div>\r\n                <div class=\"order-item-body row\">\r\n                  <div class=\"col-8\">\r\n                    <div class=\"row order-item-body-card\" v-for=\"(item,index) in order.orderItems\" :key=\"item.itemId\"\r\n                         style=\"text-align: left;\">\r\n                      <div class=\"col-2\">\r\n                        <img :src=\"item.specimg\" alt=\"\" style=\"width: 100px; height: 100px;\">\r\n                      </div>\r\n                      <div class=\"col-4 row\">\r\n                        <span style=\"font-size: 16px; font-weight: bold; text-align: left;\">{{ item.goodname }}</span>\r\n                        <span style=\"font-size: 12px; text-align: left; color: #555555;\">规格：{{ item.specname }}</span>\r\n                      </div>\r\n                      <div class=\"col-3\"\r\n                           style=\"border-left: 1px solid #e0e0e0; border-right: 1px solid #e0e0e0; align-items: center; justify-content: center; display: flex;\">\r\n                        <span style=\"font-size: 16px; font-weight: bold;\">￥{{ item.specprice }}</span>\r\n                      </div>\r\n                      <div class=\"col-3\"\r\n                           style=\"border-left: 1px solid #e0e0e0; border-right: 1px solid #e0e0e0; align-items: center; justify-content: center; display: flex;\">\r\n                        <span style=\"font-size: 16px; font-weight: bold;\">{{ item.specnumber }}</span>\r\n                      </div>\r\n                      <el-divider v-if=\"index < order.orderItems.length - 1\"></el-divider>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"col-4 row\"\r\n                       style=\"text-align: center; align-items: center; justify-content: center; display: flex;\">\r\n                    <div\r\n                        style=\"border-right: 1px solid #e0e0e0; height: 100%; align-items: center; justify-content: center; display: flex;\"\r\n                        class=\"col\">\r\n                  <span\r\n                      style=\"font-size: 16px; font-weight: bold;\">总计：￥{{\r\n                      order.totalPrice\r\n                    }}</span>\r\n                    </div>\r\n                    <div class=\"col\">\r\n                      <div v-if=\"order.status === '已支付'\">\r\n                        <el-button type=\"success\" size=\"small\" @click=\"handleDeliver(order)\"\r\n                                   class=\"evaluate-button\"\r\n                                   style=\"background-color: transparent; border: none; color: #333333;\">寄送商品\r\n                        </el-button>\r\n                      </div>\r\n                      <div v-else-if=\"order.status === '已发货'\">\r\n                        <el-button type=\"success\" size=\"small\" @click=\"handleToEvaluate(order.orderId)\"\r\n                                   class=\"evaluate-button\"\r\n                                   style=\"background-color: transparent; border: none; color: #333333;\">查看物流\r\n                        </el-button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </el-tab-pane>\r\n          <el-tab-pane name=\"paid\" label=\"待发货\">\r\n            <template #label>\r\n              <span class=\"custom-tabs-label\" @click=\"()=>{filterOrdersStatus('已支付'); activeTab = 'paid';}\">\r\n                <span :class=\"{isActive: activeTab === 'paid'}\"><i\r\n                    class=\"bi bi-truck order-icon\"></i>待发货&nbsp;({{ orderCount.paid }})</span>\r\n              </span>\r\n            </template>\r\n            <div class=\"search-container\">\r\n              <el-input type=\"text\" v-model=\"searchQuery\" placeholder=\"搜索用户名或者订单号...\" class=\"search-input\"\r\n                        @keyup.enter=\"filterOrders\"/>\r\n              <button @click=\"filterOrders\" class=\"search-button\">\r\n                <a class=\"bi bi-search\" style=\"color:whitesmoke;\"></a>\r\n              </button>\r\n            </div>\r\n            <div class=\"row\"\r\n                 style=\"background-color: #f5f5f5; padding: 10px; margin-bottom: 10px; margin-left: 40px; margin-right: 40px;\">\r\n              <span class=\"col-4\">商品</span>\r\n              <span class=\"col-1\">单价</span>\r\n              <span class=\"col-2\">数量</span>\r\n              <span class=\"col-3\">总计</span>\r\n              <span class=\"col-2\">操作</span>\r\n            </div>\r\n            <div class=\"order-list\">\r\n              <div v-for=\"(order) in filteredOrders\" :key=\"order.orderId\" class=\"order-items\">\r\n                <div class=\"order-item-header row\">\r\n                  <div class=\"col-4\" style=\"text-align: left;\">\r\n                    <span style=\"font-weight: bold; font-size: 16px;\">{{ formatDate(order.createTime) }}</span>&nbsp;&nbsp;\r\n                    <span style=\"font-size: 14px;\">订单号：{{ order.orderId }}</span>\r\n                  </div>\r\n                  <div class=\"col-5\" style=\"text-align: left;\">\r\n                    <span style=\"font-size: 14px;\" class=\"ellipsis\">{{ order.userName }}\r\n                    <a class=\"bi bi-chat shake-animation\" style=\"margin-left: 10px; color: #ff5000;\"\r\n                       @click=\"handleToChat(order.shopId)\"></a></span>\r\n                  </div>\r\n                  <div class=\"col-3\">\r\n                    <span style=\"font-size: 14px; font-weight: bold;\">状态：{{ order.status }}</span>\r\n                  </div>\r\n                </div>\r\n                <div class=\"order-item-body row\">\r\n                  <div class=\"col-8\">\r\n                    <div class=\"row order-item-body-card\" v-for=\"(item,index) in order.orderItems\" :key=\"item.itemId\"\r\n                         style=\"text-align: left;\">\r\n                      <div class=\"col-2\">\r\n                        <img :src=\"item.specimg\" alt=\"\" style=\"width: 100px; height: 100px;\">\r\n                      </div>\r\n                      <div class=\"col-4 row\">\r\n                        <span style=\"font-size: 16px; font-weight: bold; text-align: left;\">{{ item.goodname }}</span>\r\n                        <span style=\"font-size: 12px; text-align: left; color: #555555;\">规格：{{ item.specname }}</span>\r\n                      </div>\r\n                      <div class=\"col-3\"\r\n                           style=\"border-left: 1px solid #e0e0e0; border-right: 1px solid #e0e0e0; align-items: center; justify-content: center; display: flex;\">\r\n                        <span style=\"font-size: 16px; font-weight: bold;\">￥{{ item.specprice }}</span>\r\n                      </div>\r\n                      <div class=\"col-3\"\r\n                           style=\"border-left: 1px solid #e0e0e0; border-right: 1px solid #e0e0e0; align-items: center; justify-content: center; display: flex;\">\r\n                        <span style=\"font-size: 16px; font-weight: bold;\">{{ item.specnumber }}</span>\r\n                      </div>\r\n                      <el-divider v-if=\"index < order.orderItems.length - 1\"></el-divider>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"col-4 row\"\r\n                       style=\"text-align: center; align-items: center; justify-content: center; display: flex;\">\r\n                    <div\r\n                        style=\"border-right: 1px solid #e0e0e0; height: 100%; align-items: center; justify-content: center; display: flex;\"\r\n                        class=\"col\">\r\n                  <span\r\n                      style=\"font-size: 16px; font-weight: bold;\">总计：￥{{\r\n                      order.totalPrice\r\n                    }}</span>\r\n                    </div>\r\n                    <div class=\"col\">\r\n                      <div v-if=\"order.status === '已支付'\">\r\n                        <el-button type=\"success\" size=\"small\" @click=\"handleDeliver(order)\"\r\n                                   class=\"evaluate-button\"\r\n                                   style=\"background-color: transparent; border: none; color: #333333;\">寄送商品\r\n                        </el-button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </el-tab-pane>\r\n          <el-tab-pane name=\"delivered\" label=\"待收货\">\r\n            <template #label>\r\n              <span class=\"custom-tabs-label\" @click=\"() => {filterOrdersStatus('已发货'); activeTab = 'delivered';}\">\r\n                <span :class=\"{isActive: activeTab === 'delivered'}\"><i\r\n                    class=\"bi bi-cash order-icon\"></i>待收货&nbsp;({{ orderCount.delivered }})</span>\r\n              </span>\r\n            </template>\r\n            <div class=\"search-container\">\r\n              <el-input type=\"text\" v-model=\"searchQuery\" placeholder=\"搜索用户名或者订单号...\" class=\"search-input\"\r\n                        @keyup.enter=\"filterOrders\"/>\r\n              <button @click=\"filterOrders\" class=\"search-button\">\r\n                <a class=\"bi bi-search\" style=\"color:whitesmoke;\"></a>\r\n              </button>\r\n            </div>\r\n            <div class=\"row\"\r\n                 style=\"background-color: #f5f5f5; padding: 10px; margin-bottom: 10px; margin-left: 40px; margin-right: 40px;\">\r\n              <span class=\"col-4\">商品</span>\r\n              <span class=\"col-1\">单价</span>\r\n              <span class=\"col-2\">数量</span>\r\n              <span class=\"col-3\">总计</span>\r\n              <span class=\"col-2\">操作</span>\r\n            </div>\r\n            <div class=\"order-list\">\r\n              <div v-for=\"(order) in filteredOrders\" :key=\"order.orderId\" class=\"order-items\">\r\n                <div class=\"order-item-header row\">\r\n                  <div class=\"col-4\" style=\"text-align: left;\">\r\n                    <span style=\"font-weight: bold; font-size: 16px;\">{{ formatDate(order.createTime) }}</span>&nbsp;&nbsp;\r\n                    <span style=\"font-size: 14px;\">订单号：{{ order.orderId }}</span>\r\n                  </div>\r\n                  <div class=\"col-5\" style=\"text-align: left;\">\r\n                    <span style=\"font-size: 14px;\" class=\"ellipsis\">{{ order.userName }}\r\n                    <a class=\"bi bi-chat shake-animation\" style=\"margin-left: 10px; color: #ff5000;\"\r\n                       @click=\"handleToChat(order.shopId)\"></a></span>\r\n                  </div>\r\n                  <div class=\"col-3\">\r\n                    <span style=\"font-size: 14px; font-weight: bold;\">状态：{{ order.status }}</span>\r\n                  </div>\r\n                </div>\r\n                <div class=\"order-item-body row\">\r\n                  <div class=\"col-8\">\r\n                    <div class=\"row order-item-body-card\" v-for=\"(item,index) in order.orderItems\" :key=\"item.itemId\"\r\n                         style=\"text-align: left;\">\r\n                      <div class=\"col-2\">\r\n                        <img :src=\"item.specimg\" alt=\"\" style=\"width: 100px; height: 100px;\">\r\n                      </div>\r\n                      <div class=\"col-4 row\">\r\n                        <span style=\"font-size: 16px; font-weight: bold; text-align: left;\">{{ item.goodname }}</span>\r\n                        <span style=\"font-size: 12px; text-align: left; color: #555555;\">规格：{{ item.specname }}</span>\r\n                      </div>\r\n                      <div class=\"col-3\"\r\n                           style=\"border-left: 1px solid #e0e0e0; border-right: 1px solid #e0e0e0; align-items: center; justify-content: center; display: flex;\">\r\n                        <span style=\"font-size: 16px; font-weight: bold;\">￥{{ item.specprice }}</span>\r\n                      </div>\r\n                      <div class=\"col-3\"\r\n                           style=\"border-left: 1px solid #e0e0e0; border-right: 1px solid #e0e0e0; align-items: center; justify-content: center; display: flex;\">\r\n                        <span style=\"font-size: 16px; font-weight: bold;\">{{ item.specnumber }}</span>\r\n                      </div>\r\n                      <el-divider v-if=\"index < order.orderItems.length - 1\"></el-divider>\r\n                    </div>\r\n                  </div>\r\n                  <div class=\"col-4 row\"\r\n                       style=\"text-align: center; align-items: center; justify-content: center; display: flex;\">\r\n                    <div\r\n                        style=\"border-right: 1px solid #e0e0e0; height: 100%; align-items: center; justify-content: center; display: flex;\"\r\n                        class=\"col\">\r\n                  <span\r\n                      style=\"font-size: 16px; font-weight: bold;\">总计：￥{{\r\n                      order.totalPrice\r\n                    }}</span>\r\n                    </div>\r\n                    <div class=\"col\">\r\n                      <div\r\n                          v-if=\"order.status === '已支付' || order.status === '已发货' || order.status === '已评价'\">\r\n                        <el-button type=\"success\" size=\"small\" @click=\"handleToEvaluate(order.orderId)\"\r\n                                   class=\"evaluate-button\"\r\n                                   style=\"background-color: transparent; border: none; color: #333333;\">查看物流\r\n                        </el-button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </el-tab-pane>\r\n          <el-tab-pane name=\"refunding\" label=\"退款中\">\r\n            <template #label>\r\n              <span class=\"custom-tabs-label\" @click=\"() => {router.push('/store/orderReturns')}\">\r\n                <span :class=\"{isActive: activeTab === 'refunding'}\"><i\r\n                    class=\"bi bi-cash order-icon\"></i>待退款&nbsp;({{ orderCount.refunding }})</span>\r\n              </span>\r\n            </template>\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport ShopSliderComponent from \"@/components/ShopSliderComponent.vue\";\r\nimport {useUserShop} from \"@/composables/useShopUser\";\r\nimport {onMounted, ref} from \"vue\";\r\nimport axios from \"axios\";\r\nimport {ElMessage} from \"element-plus\";\r\nimport router from \"@/router\";\r\nimport StoreHeaderView from \"@/components/StoreHeaderView.vue\";\r\n\r\nconst {shopForm, initUserSession, initShopInfo} = useUserShop();\r\n\r\nconst shopSlider = ref(null);\r\nconst storeHeader = ref(null);\r\nconst activeTab = ref('all');\r\nconst handleTabClick = () => {\r\n  if (activeTab.value === 'refunding') {\r\n    ElMessage.error('暂未开通');\r\n  }\r\n}\r\nconst orderList = ref([]);\r\nconst filteredOrders = ref([]);\r\nconst orderCount = ref({\r\n  all: 0,\r\n  paid: 0,\r\n  delivered: 0,\r\n  refunding: 0,\r\n});\r\n\r\nasync function initOrderCount() {\r\n  try {\r\n    const response = await axios.post('/api/shop/getShopOrderCount', {\r\n      shopID: shopForm.value.shopID\r\n    }, {\r\n      headers: {\r\n        'Content-Type': 'application/json;charset=UTF-8'\r\n      },\r\n      withCredentials: true\r\n    })\r\n    if (response.data !== null) {\r\n      orderCount.value = response.data;\r\n    } else\r\n      ElMessage.error(\"获取订单数量失败，请稍后再试。\")\r\n  } catch (err) {\r\n    ElMessage.error(\"获取订单数量失败，请稍后再试。\")\r\n  }\r\n}\r\n\r\nasync function initOrdersInfo() {\r\n  try {\r\n    const response = await axios.post('/api/shop/getShopOrderInfo', {\r\n      shopID: shopForm.value.shopID\r\n    }, {\r\n      headers: {\r\n        'Content-Type': 'application/json;charset=UTF-8'\r\n      },\r\n      withCredentials: true\r\n    })\r\n    if (response.data !== null) {\r\n      orderList.value = response.data;\r\n      filteredOrders.value = orderList.value;\r\n      await initOrderCount();\r\n    } else\r\n      ElMessage.error(\"获取订单信息失败，请稍后再试。\")\r\n  } catch (err) {\r\n    ElMessage.error(\"获取订单信息失败，请稍后再试。\")\r\n  }\r\n}\r\n\r\nconst searchQuery = ref(\"\");\r\n\r\nfunction filterOrders() {\r\n  // 检查搜索查询是否为空\r\n  if (!searchQuery.value.trim() && activeTab.value === 'all') {\r\n    // 如果为空，直接展示所有历史数据\r\n    filteredOrders.value = orderList.value;\r\n    return;\r\n  }\r\n\r\n  // 根据关键词过滤历史数据\r\n  filteredOrders.value = filteredOrders.value\r\n      .filter(item =>\r\n          item.orderId.toLowerCase().includes(searchQuery.value.toLowerCase()) ||\r\n          item.userName.toLowerCase().includes(searchQuery.value.toLowerCase())\r\n      )\r\n      .map(item => ({\r\n        status: item.status,\r\n        createTime: item.createTime,\r\n        address: item.address,\r\n        shopId: item.shopId,\r\n        userName: item.userName,\r\n        totalPrice: item.totalPrice,\r\n        orderId: item.orderId,\r\n        orderItems: item.orderItems // 可以根据需要决定是否包含订单项\r\n      }));\r\n}\r\n\r\nfunction filterOrdersStatus(status) {\r\n  if (status === '全部') {\r\n    filteredOrders.value = orderList.value;\r\n    return;\r\n  }\r\n  filteredOrders.value = orderList.value.filter(item => item.status === status);\r\n}\r\n\r\nfunction formatDate(dateString) {\r\n  const date = new Date(dateString);\r\n  const year = date.getFullYear();\r\n  const month = String(date.getMonth() + 1).padStart(2, '0'); // 月份需加1，并补零\r\n  const day = String(date.getDate()).padStart(2, '0'); // 补零\r\n\r\n  return `${year}-${month}-${day}`;\r\n}\r\n\r\nfunction handleToChat(shopId) {\r\n  router.push('/talkToStore?id=' + shopId);\r\n}\r\n\r\nasync function handleDeliver(order) {\r\n  try {\r\n    const response = await axios.post('/api/shop/updateOrderStatus', {\r\n      shopId: shopForm.value.shopID,\r\n      userId: order.userId,\r\n      orderId: order.orderId,\r\n      status: '已发货'\r\n    }, {\r\n      headers: {\r\n        'Content-Type': 'application/json;charset=UTF-8'\r\n      },\r\n      withCredentials: true\r\n    })\r\n    if (response.data.code === 200) {\r\n      ElMessage.success(\"订单状态已更新为已发货\")\r\n      await initOrdersInfo();\r\n    } else\r\n      ElMessage.error(\"发货失败，请稍后再试。\")\r\n  } catch (err) {\r\n    ElMessage.error(\"发货失败，请稍后再试。\")\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  initUserSession();\r\n  await initShopInfo();\r\n  shopSlider.value.setActiveIndex('3-1')\r\n  storeHeader.value.setTitle('订单管理');\r\n  await initOrdersInfo();\r\n});\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.demo-tabs > .el-tabs__content {\r\n  padding: 32px;\r\n  color: #ff5000;\r\n  font-size: 32px;\r\n  font-weight: 600;\r\n  background-color: #f5f7fa; /* 添加背景色 */\r\n  border-radius: 8px; /* 添加圆角效果 */\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* 添加阴影 */\r\n}\r\n\r\n\r\n.demo-tabs .order-icon {\r\n  transition: transform 0.3s ease-in-out;\r\n  margin: 10px;\r\n}\r\n\r\n.active {\r\n  .span {\r\n    color: #e02020;\r\n    font-weight: bold;\r\n  }\r\n\r\n  .order-icon {\r\n    transform: rotate(180deg);\r\n  }\r\n}\r\n\r\n.demo-tabs .custom-tabs-label span {\r\n  vertical-align: middle;\r\n  margin-left: 4px;\r\n  font-size: 20px;\r\n  color: #4c4c4c; /* 改变字体颜色 */\r\n  font-weight: 500; /* 修改字体粗细 */\r\n\r\n  &.isActive {\r\n    color: #e02020;\r\n  }\r\n\r\n  &:hover {\r\n    color: #e02020;\r\n  }\r\n}\r\n\r\n.search-container {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n  padding-right: 20px;\r\n\r\n  .search-input {\r\n    padding: 10px;\r\n    font-size: 16px;\r\n    border: 2px solid #ccc;\r\n    border-radius: 8px 0 0 8px;\r\n    outline: none;\r\n    width: 200px;\r\n    border-right: none;\r\n  }\r\n\r\n  .search-input:hover {\r\n    border-color: #e02020;\r\n  }\r\n\r\n  .search-button {\r\n    padding: 10px 20px;\r\n    background-color: #e02020;\r\n    color: white;\r\n    font-size: 16px;\r\n    border: 2px solid #e02020;\r\n    border-radius: 0 8px 8px 0;\r\n    cursor: pointer;\r\n    font-weight: bold;\r\n  }\r\n\r\n  .search-button:hover {\r\n    background-color: #c21a1a;\r\n    border-color: #c21a1a;\r\n  }\r\n}\r\n\r\n.order-item-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 10px;\r\n  font-size: 18px;\r\n  color: #4c4c4c; /* 改变字体颜色 */\r\n  font-weight: 500; /* 修改字体粗细 */\r\n}\r\n\r\n.order-list {\r\n  margin-top: 20px;\r\n\r\n  .order-items {\r\n    margin-bottom: 20px;\r\n    margin-left: 40px;\r\n    margin-right: 40px;\r\n    padding: 10px;\r\n    background-color: #e0e0e0; /* 添加背景色 */\r\n    border-radius: 8px; /* 添加圆角效果 */\r\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* 添加阴影 */\r\n\r\n    .order-item-header {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      margin-bottom: 10px;\r\n      font-size: 18px;\r\n      color: #4c4c4c; /* 改变字体颜色 */\r\n      font-weight: 500; /* 修改字体粗细 */\r\n\r\n      .ellipsis:hover {\r\n        color: #e02020;\r\n      }\r\n\r\n      @keyframes shake {\r\n        0% {\r\n          transform: translateY(0);\r\n        }\r\n        25% {\r\n          transform: translateY(-5px);\r\n        }\r\n        50% {\r\n          transform: translateY(0);\r\n        }\r\n        75% {\r\n          transform: translateY(5px);\r\n        }\r\n        100% {\r\n          transform: translateY(0);\r\n        }\r\n      }\r\n\r\n      .shake-animation {\r\n        display: inline-block; /* 保持元素的行内块布局 */\r\n        animation: shake 1s infinite; /* 动画持续1秒，无限循环 */\r\n      }\r\n    }\r\n\r\n    .order-item-body {\r\n      background-color: #f5f7fa;\r\n    }\r\n\r\n    .order-item-body-card {\r\n      padding: 5px;\r\n\r\n      img {\r\n        width: 100px;\r\n        height: 100px;\r\n        border-radius: 8px;\r\n      }\r\n    }\r\n  }\r\n\r\n  .el-button.evaluate-button {\r\n    font-size: 14px;\r\n\r\n    &:hover {\r\n      color: #e02020;\r\n    }\r\n  }\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}